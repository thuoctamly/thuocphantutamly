<!doctype html>  
<html lang="vi">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#004080">

<!-- Báº¯t buá»™c cho iPhone -->
<link rel="apple-touch-icon" href="icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">

<meta name="color-scheme" content="light">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ThÆ°á»›c pháº£n tÆ° tÃ¢m lÃ½ vÃ  khÆ¡i dáº­y nhÃ¢n tÃ­nh lÃ m ngÆ°á»i</title>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/docx@7.1.0/build/index.js"></script>
<style>
  :root{
    --bg:#f4f7fb;
    --ruler-bg:#0b63a8;
    --slider:#ffffff;
    --led-size:48px;
    --green:#2ecc71; --amber:#FFD700; --red:#e74c3c; --white:#ffffff;
  }
 body {
  font-family: system-ui,Segoe UI,Roboto,Helvetica,Arial;
  margin:0;
  padding:12px;
  background-color: #ffffff !important;
  color: #123 !important;
  color-scheme: light only;
-webkit-appearance: none;
  forced-color-adjust: none;
}
.container{max-width:420px;margin:0 auto;}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
h1{font-size:16px;margin:0}
small{color:#456}
.ruler-wrap{display:flex;gap:12px;align-items:center}
.ruler{
  width:80px; 
  height:500px; 
  background:#ffffff; 
  border-top: 40px solid #004080;
  border-right: 10px solid #004080; 
  border-bottom: 20px solid #004080;
  border-left: 10px solid #004080; 
  border-radius:10px;
  position:relative;
  box-shadow:0 4px 10px rgba(0,0,0,0.12); 
  margin:auto;
  touch-action:none;
}
.tick { 
  position: absolute; 
  left: 8px; 
  right: 8px; 
  height: 1px; 
  background: rgba(0,0,0,0.5);
}
.label{position:absolute; left:50px; transform:translateX(-100%); color:#000; font-weight:600; font-size:12px}
.slider{
  position:absolute; left:6px; right:6px; height:10px; border-radius:6px; border: 5px solid #000; background:var(--slider);
  display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(0,0,0,0.25);
  touch-action:none; user-select:none; cursor:grab;
  font-weight:600; font-size:13px;
}
.slider .knob {
  width: 17px;
  height: 17px;
  background: blue;
  border: 4px solid #000;
  border-radius: 4px;
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  pointer-events: none;
}
.slider:active{background:#eaeaea}
.led{position: absolute; top: -35px; left: 30%; width:24px; height:24px; border-radius:50%; border: 4px solid #000; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.25)}
.led.white{background:var(--white)}
.led.green{background:var(--green)}
.led.amber{background:var(--amber)}
.led.red{background:var(--red)}
.led.pulse{animation:ledPulse 1s infinite}
@keyframes ledPulse{0%{box-shadow:0 0 6px rgba(255,255,255,0.12)}50%{box-shadow:0 0 18px rgba(0,0,0,0.18)}100%{box-shadow:0 0 6px rgba(255,255,255,0.12)}}
.status{margin-top:10px; display:flex;justify-content:space-between;align-items:center}
.countdown,.total{font-weight:700}
.controls {
  margin-top: 12px;
  display: flex;
  justify-content: center;  /* cÄƒn giá»¯a theo ngang */
  gap: 12px;               /* khoáº£ng cÃ¡ch giá»¯a 2 nÃºt */
  flex-wrap: wrap;          /* xuá»‘ng dÃ²ng khi mÃ n hÃ¬nh nhá» */
}

.btn{background:#fff;border:1px solid #d0d7de;padding:8px 10px;border-radius:8px;cursor:pointer}
.btn.warn{background:#f6d7cf}
.footer{margin-top:14px;font-size:13px;color:#456}

.hidden { display: none; }

/* LED cam nháº¥p nhÃ¡y theo nhá»‹p tiáº¿ng cÃ²i (~210ms) */
.led.pulse {
  animation: pulseFlash 1s infinite;
}

@keyframes pulseFlash {
  0%   { opacity: 1; }
  50%  { opacity: 0; }
  100% { opacity: 1; }
}
/* LED Ä‘á» pulse riÃªng */
/* Hiá»‡u á»©ng riÃªng cho LED Ä‘á» â€” hoÃ n toÃ n tÃ¡ch biá»‡t */
.led-red-alert {
  animation: ledRedFlash 0.5s infinite ease-in-out;
}

@keyframes ledRedFlash {
  0%   { background: #e74c3c; box-shadow: 0 0 6px #e74c3c; }
  50%  { background: #3d0000; box-shadow: 0 0 12px #ff1a1a; }
  100% { background: #e74c3c; box-shadow: 0 0 6px #e74c3c; }
}

/* --- thÃªm mÃ u tÃ­m vÃ  xanh dÆ°Æ¡ng cho LED --- */
.led.purple { background: #8e44ad; }   /* tÃ­m nháº¹ */
.led.blue   { background: #2980b9; }   /* xanh dÆ°Æ¡ng */

.pulse-amber {
  animation: amberBlink 1.885s infinite;
}

@keyframes amberBlink {
  0% { opacity: 1; }
  50% { opacity: 0.1; }
  100% { opacity: 1; }
}

.label-left {
  position: absolute;
  left: -110px; /* cÄƒn trÃ¡i ra ngoÃ i 1 chÃºt, báº¡n chá»‰nh tÃ¹y Ã½ */
  width: 100px;
  color: #004080;
  font-weight: 600;
  font-size: 13px;
  user-select: none;
}

.label-left.top {
  top: 0px; /* gáº§n top border */
  left:-125px;
 
}

.label-left.middle {
  top: 51%; 
  left: -130px;
  transform: translateY(-50%);
}

.label-left.bottom {
  bottom: -15px; /* gáº§n bottom border */
  left:-130px;
}
.label-right{
  position: absolute;
  left: -110px; /* cÄƒn trÃ¡i ra ngoÃ i 1 chÃºt, báº¡n chá»‰nh tÃ¹y Ã½ */
  width: 100px;
  color: #004080;
  font-weight: 600;
  font-size: 13px;
  user-select: none;
}

.label-right.top {
  top: 0px; /* gáº§n top border */
  left:-118px;
 
}

.label-right.middle {
  top: 49%; 
  left: -118px;
  transform: translateY(-50%);
}

.label-right.bottom {
  bottom: 0px; /* gáº§n bottom border */
  left:-118px;
}
/* ==== NÃšT Äá»’NG Bá»˜ â€“ SANG TRá»ŒNG NHÆ¯ iOS ==== */
.btn {
  padding: 8px 14px;
  border-radius: 10px;
  background: #ffffff;
  border: 2px solid #004080;
  color: #004080;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: 0.25s ease;
  box-shadow: 0 2px 4px rgba(0,0,0,0.12);
}

.btn:hover {
  background: #004080;
  color: #ffffff;
  box-shadow: 0 3px 6px rgba(0,0,0,0.18);
}

.btn:active {
  transform: scale(0.96);
}

/* NÃºt cáº£nh bÃ¡o */
.btn.warn {
  border-color: #b00020;
  color: #b00020;
}

.btn.warn:hover {
  background: #b00020;
  color: white;
}

/* CÃ¡c nÃºt khÃ´ng cÃ³ class cÅ©ng Ä‘Æ°á»£c Ä‘á»“ng bá»™ */
#revBtn {
  padding: 9px 16px;
  border-radius: 10px;
  background: #ffffff;
  border: 2px solid #004080;
  color: #004080;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: 0.25s ease;
  box-shadow: 0 2px 4px rgba(0,0,0,0.12);
}

#revBtn:hover {
  background: #004080;
  color: #ffffff;
  box-shadow: 0 3px 6px rgba(0,0,0,0.18);
}

#revBtn:active {
  transform: scale(0.96);
}
strong {
  font-weight: 1000 !important;
}
/* ensure the container is a single flex row, left part can shrink, right part fixed */
.status{
  margin-top:10px;
  display:flex;
  justify-content:space-between; /* left - right */
  align-items:center;
  gap:12px;
}

/* trÃ¡i: cho phÃ©p co láº¡i (quan trá»ng Ä‘á»ƒ khÃ´ng Ã©p trend xuá»‘ng dÃ²ng) */
#statusLeft{
  display:flex;
  align-items:center;
  gap:12px;
  flex: 1 1 auto;    /* cho phÃ©p chiáº¿m pháº§n cÃ²n láº¡i nhÆ°ng cÃ³ thá»ƒ co láº¡i */
  min-width: 0;      /* quan trá»ng: cho phÃ©p con bÃªn trong trÃ n áº©n thay vÃ¬ Ã©p wrap */
}

/* pháº£i: khÃ´ng giÃ£n, luÃ´n bÃ¡m mÃ©p pháº£i */
#statusRight{
  display:flex;
  align-items:center;
  justify-content:flex-end;
  flex: 0 0 auto;
  margin-left: 12px;
  white-space: nowrap;  /* trÃ¡nh xuá»‘ng dÃ²ng */
}

/* avgScore khÃ´ng nÃªn lÃ  block chiáº¿m cáº£ dÃ²ng */
#avgScore {
  display: inline-flex;     /* inline, chá»‰ rá»™ng báº±ng ná»™i dung */
  align-items: center;
  gap: 8px;
  white-space: nowrap;      /* giá»¯ "Äiá»ƒm trung bÃ¬nh: 1.2" nguyÃªn 1 khá»‘i */
  position: relative;       /* náº¿u cáº§n giá»¯ position nhÆ°ng khÃ´ng báº¯t buá»™c */
}

/* trend inline â€” KHÃ”NG dÃ¹ng position:absolute; Ä‘á»ƒ nÃ³ bá»‘ trÃ­ báº±ng flex */
#avgTrendInline {
  position: static !important;
  right: auto !important;
  top: auto !important;
  transform: none !important;
  font-weight: 700;
  font-size: 15px;
  color: #004080;
  user-select: none;
  white-space: nowrap;
  margin-left: 8px;
}
/* --- CSS GIAO DIá»†N NHáº¬T KÃ CAO Cáº¤P --- */

/* Khung tá»«ng chu ká»³ */
.cycle-card {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  margin-bottom: 24px;
  overflow: hidden;
  border: 1px solid #e1e4e8;
}

/* Header cá»§a Card */
.card-header {
  padding: 12px 16px;
  background: #f8f9fa;
  border-bottom: 1px solid #eee;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.header-left strong { font-size: 16px; color: #004080; }
.header-right { font-weight: bold; font-size: 15px; }

/* MÃ u sáº¯c Ä‘iá»ƒm sá»‘ */
.score-pos { color: #27ae60; } /* Xanh lÃ¡ */
.score-neg { color: #e74c3c; } /* Äá» */
.score-neu { color: #2980b9; } /* Xanh dÆ°Æ¡ng */

/* Báº£ng dá»¯ liá»‡u thÃ´ */
.log-container {
  max-height: 220px;
  overflow-y: auto;
  border-bottom: 1px solid #eee;
  background: #ffffff;
}
.log-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}
.log-table th {
  position: sticky;
  top: 0;
  background: #004080;
  color: white;
  padding: 8px;
  font-weight: 500;
  text-align: left;
}
.log-table td {
  padding: 8px;
  border-bottom: 1px solid #f1f1f1;
  color: #333;
}
.log-table tr:nth-child(even) { background-color: #fcfcfc; }

/* Pháº§n Pháº£n tÆ° (KHKT) */
.feedback-area {
  padding: 16px;
  background-color: #fdfdfd;
}
.fb-label {
  font-weight: 700;
  color: #555;
  font-size: 13px;
  margin-top: 10px;
  display: block;
}
.fb-input {
  width: 100%;
  padding: 10px;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  margin-top: 4px;
  font-family: inherit;
  font-size: 14px;
  transition: border 0.2s;
  background: #fff;
}
.fb-input:focus {
  border-color: #004080;
  outline: none;
  box-shadow: 0 0 0 3px rgba(0,64,128,0.1);
}

/* ÄÃ¡nh giÃ¡ sao */
.rating-box {
  background: #f0f4f8;
  padding: 12px;
  border-radius: 8px;
  margin-top: 15px;
}
.star-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 6px;
  font-size: 13px;
  font-weight: 600;
  color: #444;
}
.stars { cursor: pointer; display: flex; gap: 4px; }
.star { font-size: 22px; color: #cbd5e0; transition: transform 0.1s; }
.star.active { color: #f1c40f; }
.star:hover { transform: scale(1.2); }

/* NÃºt lÆ°u */
.btn-save-research {
width: 100%;
  padding: 12px;
  background: linear-gradient(135deg, #004080 0%, #0066cc 100%);
  color: white;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  font-size: 14px;
  margin-top: 15px;
  cursor: pointer;
  box-shadow: 0 4px 6px rgba(0,64,128,0.2);
  transition: 0.2s;
}
.btn-save-research:active { transform: scale(0.98); }
/* Káº¿t quáº£ Ä‘Ã£ lÆ°u */
.saved-data {
  background: #eef9f0;
  border: 1px solid #c3e6cb;
  padding: 12px;
  border-radius: 8px;
  color: #333 !important; /* MÃ u Ä‘en/xÃ¡m Ä‘áº­m */
}
.saved-item { margin-bottom: 8px; font-size: 14px; }
.saved-label { font-weight: bold; color: #155724; display: block;}
/* --- Bá»” SUNG: MÃ€U Sáº®C Äá»’NG Bá»˜ LED (5 MÃ€U) --- */
.color-purple { color: #8e44ad !important; font-weight: bold; } /* Báº£n nÄƒng máº¡nh */
.color-red    { color: #e74c3c !important; font-weight: bold; } /* Báº£n nÄƒng vá»«a */
.color-green  { color: #2ecc71 !important; font-weight: bold; } /* CÃ¢n báº±ng */
.color-blue   { color: #2980b9 !important; font-weight: bold; } /* SiÃªu ngÃ£ vá»«a */
.color-amber  { color: #FFD700 !important; font-weight: bold; text-shadow: 0px 0px 1px #999;} /* SiÃªu ngÃ£ máº¡nh */
/* --- CSS CHO EMOJI RATING (THANG LIKERT) --- */
.emoji-section {
  margin-top: 15px;
  padding-top: 10px;
  border-top: 1px dashed #ccc;
}
.emoji-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 8px;
  font-size: 13px;
  font-weight: 600;
  color: #444;
}
.emoji-group {
  display: flex;
  gap: 10px;
}
.emoji-btn {
  font-size: 24px;
  cursor: pointer;
  filter: grayscale(100%); /* Máº·c Ä‘á»‹nh xÃ¡m */
  opacity: 0.4;
  transition: transform 0.2s, filter 0.2s, opacity 0.2s;
}
.emoji-btn:hover {
  transform: scale(1.2);
  opacity: 0.8;
  filter: grayscale(0%);
}
.emoji-btn.selected {
  transform: scale(1.3);
  opacity: 1;
  filter: grayscale(0%); /* CÃ³ mÃ u khi chá»n */
}
/* Hiá»ƒn thá»‹ káº¿t quáº£ Ä‘Ã£ lÆ°u */
.emoji-result {
  font-weight: bold;
  color: #004080;
}
/* --- Bá»” SUNG: CSS CHO HEADER Cá»¦A Báº¢NG LOG THEO KHUYNH HÆ¯á»šNG CHU Ká»² --- */

/* Báº£n nÄƒng máº¡nh (MÃ u TÃ­m) */
.cycle-card.color-purple .log-table th { 
    background: #8e44ad; 
    color: white; 
}

/* Báº£n nÄƒng vá»«a (MÃ u Äá») */
.cycle-card.color-red .log-table th { 
    background: #e74c3c; 
    color: white; 
}

/* Báº£n ngÃ£ cÃ¢n báº±ng (MÃ u Xanh LÃ¡) */
.cycle-card.color-green .log-table th { 
    background: #2ecc71; 
    color: white; 
}

/* SiÃªu ngÃ£ vá»«a (MÃ u Xanh DÆ°Æ¡ng) */
.cycle-card.color-blue .log-table th { 
    background: #2980b9; 
    color: white; 
}

/* SiÃªu ngÃ£ máº¡nh (MÃ u VÃ ng/Amber) - Cáº§n dÃ¹ng chá»¯ mÃ u tá»‘i cho dá»… Ä‘á»c */
.cycle-card.color-amber .log-table th { 
    background: #FFD700; 
    color: #333; /* Chuyá»ƒn mÃ u chá»¯ sang Ä‘en/xÃ¡m Ä‘áº­m */
}
/* --- Bá»” SUNG: CSS CHO MÃ€U CHá»® "Chu ká»³" TRONG HEADER THEO KHUYNH HÆ¯á»šNG CHU Ká»² --- */
/* --- Sá»¬A Äá»”I CSS: TÄƒng Ä‘á»™ Æ°u tiÃªn Ä‘á»ƒ loáº¡i trá»« mÃ u cho thá»i gian/ngÃ y thÃ¡ng --- */

/* Nháº¯m má»¥c tiÃªu cá»¥ thá»ƒ: tháº» cÃ³ class neutral-text náº±m trong card-header, 
   mÃ  card-header láº¡i náº±m trong cycle-card. */
.cycle-card .card-header .neutral-text { 
    color: #333 !important; /* MÃ u Ä‘en/xÃ¡m Ä‘áº­m */
    font-weight: normal !important; /* Äáº£m báº£o khÃ´ng bá»‹ in Ä‘áº­m náº¿u bá»‹ áº£nh hÆ°á»Ÿng */
}
/* --- Sá»¬A Äá»”I: Nháº¯m má»¥c tiÃªu chÃ­nh xÃ¡c vÃ o tháº» <strong> chá»©a "Chu ká»³" --- */

/* Báº£n nÄƒng máº¡nh (TÃ­m) */
.cycle-card.color-purple .card-header strong { 
    color: #8e44ad !important; 
}

/* Báº£n nÄƒng vá»«a (Äá») */
.cycle-card.color-red .card-header strong { 
    color: #e74c3c !important; 
}

/* Báº£n ngÃ£ cÃ¢n báº±ng (Xanh LÃ¡) */
.cycle-card.color-green .card-header strong { 
    color: #2ecc71 !important; 
}

/* SiÃªu ngÃ£ vá»«a (Xanh DÆ°Æ¡ng) */
.cycle-card.color-blue .card-header strong { 
    color: #2980b9 !important; 
}

/* SiÃªu ngÃ£ máº¡nh (VÃ ng/Amber) */
.cycle-card.color-amber .card-header strong { 
    color: #FFD700 !important; 
}
/* --- Sá»¬A Äá»”I CUá»I CÃ™NG: Reset mÃ u cho má»i ná»™i dung trong báº£ng log --- */



</style>
</head>
<body>
<div id="helpModal" style="display:none; position:fixed; top:50%; left:50%; transform: translate(-50%, -50%); width:90%; height:85%; background:#fff; border:2px solid #004080; padding:12px; overflow:auto; z-index:1000; box-shadow:0 4px 12px rgba(0,0,0,0.3);">
  <button id="closeHelp" style="margin-bottom:8px;">ÄÃ³ng</button>
  <pre id="helpText" style="white-space: pre-wrap; font-size:18px;"></pre>
</div>
<!-- Modal Nháº­t kÃ½ -->
<div id="reviewModal" style="
  display:none; position:fixed; top:50%; left:50%; transform: translate(-50%, -50%); width:90%; height:85%;
  background:#fff; border:2px solid #004080; padding:12px; overflow:auto;
  z-index:1000; box-shadow:0 4px 12px rgba(0,0,0,0.3);
">
  <button id="closeReview" style="margin-bottom:8px;">ÄÃ³ng</button>
<div id="reviewContent" style="font-size:16px;"></div>
 <button id="exportWordBtn" onclick="exportWord()" class="btn" style="
  margin-top:16px;
  width:100%;
  font-size:15px;
  background:#004080;
  color:white;
  border-radius:10px;
  padding:10px 0;
">ğŸ“„ Xuáº¥t file Word</button>
</div>

<div class="container">
  <header>
    <div>
      <h1>THÆ¯á»šC PHáº¢N TÆ¯ TÃ‚M LÃ VÃ€ KHÆ I Dáº¬Y NHÃ‚N TÃNH LÃ€M NGÆ¯á»œIğŸ–¤ğŸ•Šï¸</h1>
      <small><em><b>(Láº¥y cáº£m há»©ng tá»« thuyáº¿t PhÃ¢n TÃ¢m há»c cá»§a Sigmund Freud)</b></em></small>
    </div>
  </header>

  <div class="ruler-wrap">
  
    <div style="flex:1">
      <div id="ruler" class="ruler">
      <div class="label-left top" style="font-size:14px; color:rgb(255,215,0)" align="center">ğŸ˜‡<b> SIÃŠU NGÃƒ (+10000)</b></div>
<div class="label-left middle" style="font-size:14px" align="center"><svg width="24" height="24" viewBox="0 0 24 17" fill="#004080" xmlns="http://www.w3.org/2000/svg">
  <circle cx="12" cy="7" r="4"/>
  <path d="M12 14c-5 0-8 2.5-8 5v1h16v-1c0-2.5-3-5-8-5z"/>
</svg>
<b>Báº¢N <span style="color:rgb(255,215,0)">NGÃƒ</span> (0)</b></div>
<div class="label-left bottom" style="font-size:14px" align="center">ğŸ˜ˆ<b> Báº¢N NÄ‚NG (-10000)</b></div>

        <div id="led" class="led" title="LED tráº¡ng thÃ¡i"></div>
        <div id="slider" class="slider">
          &nbsp;â¬‡ï¸
          <div class="knob"></div>
        </div>
      </div>
    </div>
  </div>
<div class="status">
  <div id="statusLeft" style="display:flex; align-items:center; gap:12px;">
    <div id="countdownWrap">Thá»i gian cÃ²n láº¡i: <span id="countdown" class="countdown">--</span></div>
    <div id="avgScore" style="display:none; position:relative;">
      <div id="avgTextWrap"><strong>Äiá»ƒm TB:</strong> <span id="avg" class="total">0.0</span></div>
    </div>
  </div>

  <!-- vÃ¹ng cá»‘ Ä‘á»‹nh á»Ÿ pháº£i Ä‘á»ƒ hiá»ƒn thá»‹ trend (luÃ´n sÃ¡t mÃ©p pháº£i) -->
  <div id="statusRight" style="min-width:0; display:flex; align-items:center; justify-content:flex-end;"></div>
</div>

</div>

  <div class="controls">
    <button id="resetBtn" class="btn warn">Reset</button>
    <button id="revBtn">Há»“i vá»‹</button>
    <button id="helpBtn" class="btn">HÆ°á»›ng dáº«n</button>
    <button id="reviewBtn" class="btn">Nháº­t kÃ½</button>

  </div>

  <div class="footer">
    <strong>LÆ°u Ã½:</strong> ThÆ°á»›c chá»‰ cÃ³ tÃ¡c dá»¥ng soi chiáº¿u xu hÆ°á»›ng ná»™i tÃ¢m vÃ  giÃ¡o dá»¥c tá»± pháº£n tÆ°, khÃ´ng dÃ¹ng Ä‘á»ƒ phÃ¡n xÃ©t nhÃ¢n cÃ¡ch, khÃ´ng thá»ƒ thay tháº¿ Ä‘iá»u trá»‹ tÃ¢m lÃ½ chuyÃªn mÃ´n. HÃ£y tháº­t <strong>trung thá»±c</strong> vá»›i báº£n thÃ¢n mÃ¬nh khi gáº¡t thÆ°á»›c Ä‘á»ƒ cÃ³ káº¿t quáº£ há»£p lÃ½. Äá»c kÄ© hÆ°á»›ng dáº«n sá»­ dá»¥ng trÆ°á»›c khi dÃ¹ng.
  </div>
</div>

<script>
const CURRENT_CYCLE_KEY = 'freudRuler_current_cycle'; // KhÃ³a lÆ°u tráº¡ng thÃ¡i chu ká»³ Ä‘ang cháº¡y
const FINISHED_CYCLES_KEY = 'freudRuler_cycles_history'; // KhÃ³a lÆ°u Lá»ŠCH Sá»¬ VÄ¨NH VIá»„N

function loadFinishedCycles() {
    try {
        const cycles = localStorage.getItem(FINISHED_CYCLES_KEY);
        return cycles ? JSON.parse(cycles) : [];
    } catch (e) {
        console.error("Could not load finished cycles", e);
        return [];
    }
}

function saveFinishedCycles(cycles) {
    try {
        localStorage.setItem(FINISHED_CYCLES_KEY, JSON.stringify(cycles));
    } catch (e) {
        console.error("Could not save finished cycles", e);
    }
}

function loadCurrentCycle() {
    try {
        const current = localStorage.getItem(CURRENT_CYCLE_KEY);
        if (current) return JSON.parse(current);
    } catch (e) {
        console.error("Could not load current cycle", e);
    }
    // Tráº£ vá» state máº·c Ä‘á»‹nh náº¿u khÃ´ng cÃ³ dá»¯ liá»‡u
   return { status:'idle', startTimestamp:null, entries:[] };
}

function saveCurrentCycle() {
    try {
        const dataToSave = {
            status: state.status,
            startTimestamp: state.startTimestamp,
            entries: state.entries
        };
        localStorage.setItem(CURRENT_CYCLE_KEY, JSON.stringify(dataToSave));
    } catch (e) {
        console.error("Could not save current cycle", e);
    }
}

const STORAGE_KEY = 'freudRuler_v2';
const MS_COUNTDOWN = 7*24*60*60*1000; // 168 giá» (giá»¯ nguyÃªn nhÆ° cÅ© náº¿u báº¡n cáº§n thay Ä‘á»•i sau)
const MIN_VALUE = -10000, MAX_VALUE = 10000;
let audioEnabled = true;

const LED = document.getElementById('led');
const slider = document.getElementById('slider');
const ruler = document.getElementById('ruler');
const countdownEl = document.getElementById('countdown');
const totalEl = document.getElementById('total');
const resetBtn = document.getElementById('resetBtn');
const helpBtn = document.getElementById('helpBtn');
let state = loadCurrentCycle(); // Táº£i chu ká»³ Ä‘ang cháº¡y dá»Ÿ (náº¿u cÃ³)
state.finishedCycles = loadFinishedCycles(); // Táº£i lá»‹ch sá»­ VÄ¨NH VIá»„N
// Ã‚m thanh
// Ghi nháº­n 1 láº§n gáº¡t trong chu ká»³

// --- HÃ€M GIÃšP: Láº¤Y NHÃƒN CHO Má»¨C ÄIá»‚M ---
// Tráº£ vá» object {key,label,emoji} dÃ¹ng kháº¯p nÆ¡i
function getCategoryFromValue(v) {
    const n = Number(v || 0);
    if (n <= -6667) return { key: 'bn_manh', label: 'Báº£n nÄƒng máº¡nh', emoji: 'ğŸ˜ˆ' };
    if (n <= -3334) return { key: 'bn_vua',  label: 'Báº£n nÄƒng vá»«a',  emoji: 'ğŸ”¥' };
    if (n >= 6667)  return { key: 'sn_manh', label: 'SiÃªu ngÃ£ máº¡nh',  emoji: 'ğŸ˜‡' };
    if (n >= 3334)  return { key: 'sn_vua',  label: 'SiÃªu ngÃ£ vá»«a',   emoji: 'ğŸ•Šï¸' };
    return { key: 'ego', label: 'Báº£n ngÃ£', emoji: 'ğŸ‘¤' };
}

function logEntry(value) {
    const now = new Date();
    const cat = getCategoryFromValue(value);
    const entry = {
        value: value,
        dir: cat.label,
        time: now.toLocaleTimeString('vi-VN'),
        date: now.toLocaleDateString('vi-VN')
    };

    state.entries.push(entry);
    saveCurrentCycle();
}

function playBeep(freq=880, dur=0.12, vol=0.15){
  if(!audioEnabled) return;
  const ctx = new (window.AudioContext||window.webkitAudioContext)();
  const o = ctx.createOscillator(); const g = ctx.createGain();
  o.type='sine'; o.frequency.value=freq; g.gain.value=vol;
  o.connect(g); g.connect(ctx.destination);
  o.start(); o.stop(ctx.currentTime+dur);
}

// Chuyá»ƒn value <-> y
function getInnerH() {
  return ruler.clientHeight; 
}

function valueToY(value) {
  const innerH = ruler.clientHeight;          
  const sliderH = slider.offsetHeight || 20;  

  const top = sliderH / 2;
  const bottom = innerH - sliderH / 2;

  const ratio = (value - MIN_VALUE) / (MAX_VALUE - MIN_VALUE);
  const centerY = top + ratio * (bottom - top);
  return centerY - sliderH / 2;
}

function yToValue(centerY) {
  const innerH = ruler.clientHeight;
  const sliderH = slider.offsetHeight || 20;

  const top = sliderH / 2;
  const bottom = innerH - sliderH / 2;

  const c = Math.min(bottom, Math.max(top, centerY));
  const ratio = (c - top) / (bottom - top); // 0..1

  // FIX NGÆ¯á»¢C CHIá»€U â†’ khÃ´ng cÃ²n lá»—i 10000/-10000 sai vá»‹ trÃ­
  return Math.round(MAX_VALUE - ratio * (MAX_VALUE - MIN_VALUE));
}

function clamp(v,a,b){return Math.min(Math.max(v,a),b);}

// LED helpers
function LED_setClass(cls) {
  LED.className = 'led ' + cls;
}
function LED_clear() {
  LED.className = 'led';
  LED.style.background = '#222';
  LED.style.opacity = '1';
  // loáº¡i bá» táº¥t cáº£ class hiá»‡u á»©ng cÃ³ thá»ƒ cÃ²n sÃ³t
  LED.classList.remove('led-red-alert','pulse','pulse-amber','purple','blue','red','green','amber');
}


// Tick & label
function renderTicks() {
  ruler.querySelectorAll('.tick,.label').forEach(n => n.remove());

  const tickCount = 21;
  const innerHeight = ruler.clientHeight - 1;
  const spacing = innerHeight / (tickCount - 1);

  for (let i = 0; i < tickCount; i++) {
    const t = document.createElement('div');
    t.className = 'tick';
    t.style.top = (i * spacing) + 'px';
    ruler.appendChild(t);
  }
}



// --- Thay tháº¿: initSlider() (PHIÃŠN Báº¢N Sá»¬A) ---
let dragging = false;
let dragOffset = 0;
let moved = false;
let startY = 0;
let currentValue = null;

// Biáº¿n cá» bá»• sung (Ä‘áº·t cáº¡nh nÆ¡i báº¡n khai bÃ¡o currentValue)
let suppressNextClick = false;
let pendingConfirmTimer = null;   // <-- háº¹n ghi sau khi ngá»«ng kÃ©o
let lastConfirmAt = 0;            // <-- báº£o vá»‡ chá»‘ng double-confirm quÃ¡ nhanh

function initSlider(){
  renderTicks();
  requestAnimationFrame(()=> placeSliderAtValue(0));

  // pointerdown
  slider.addEventListener('pointerdown', e=>{
    // Náº¿u Ä‘ang cÃ³ 1 pending confirm (vá»«a háº¹n), huá»· nÃ³: ngÆ°á»i dÃ¹ng tÆ°Æ¡ng tÃ¡c láº¡i
    if (pendingConfirmTimer) {
      clearTimeout(pendingConfirmTimer);
      pendingConfirmTimer = null;
    }

    dragging = true;
    moved = false;
    slider.setPointerCapture(e.pointerId);
    slider.style.cursor = 'grabbing';

    startY = e.clientY;
    const sliderTop = parseFloat(slider.style.top) || 0;
    dragOffset = e.clientY - (ruler.getBoundingClientRect().top + sliderTop);
  });

  // pointermove
  document.addEventListener('pointermove', e=>{
    if(!dragging) return;

    // chá»‰ coi lÃ  "kÃ©o" khi di chuyá»ƒn > 10px
    if (Math.abs(e.clientY - startY) > 10) {
      moved = true;
    }

    const sliderHeight = slider.getBoundingClientRect().height;
    const rect = ruler.getBoundingClientRect();

    const minY = 0;
    const maxY = ruler.clientHeight - sliderHeight;

    let y = e.clientY - rect.top - dragOffset;
    y = clamp(y, minY, maxY);

    slider.style.top = y + 'px';

    // cáº­p nháº­t currentValue Ä‘á»ƒ lÆ°u khi pointerup hoáº·c khi háº¹n confirm
    const centerY = y + slider.offsetHeight / 2;
    currentValue = yToValue(centerY);
  });

  // pointerup
  document.addEventListener('pointerup', e=>{
    // luÃ´n reset tráº¡ng thÃ¡i kÃ©o
    dragging = false;
    slider.style.cursor = 'grab';

    // Náº¿u lÃ  KÃ‰O (moved === true) â†’ KHÃ”NG Gá»ŒI confirmEntry NGAY.
    // Thay báº±ng: háº¹n 1 láº§n confirm sau 450ms náº¿u khÃ´ng cÃ³ tÆ°Æ¡ng tÃ¡c láº¡i.
    if (moved) {
      // Ä‘áº£m báº£o currentValue cÃ³ giÃ¡ trá»‹ Ä‘Ãºng (dá»± phÃ²ng)
      if (typeof currentValue === 'undefined' || currentValue === null) {
        const y = slider.offsetTop + slider.offsetHeight/2;
        currentValue = yToValue(y);
      }

      // clear cÅ© náº¿u cÃ³
      if (pendingConfirmTimer) {
        clearTimeout(pendingConfirmTimer);
        pendingConfirmTimer = null;
      }

      // háº¹n xÃ¡c nháº­n sau 450ms (ngÆ°á»i dÃ¹ng thá»±c sá»± dá»«ng)
      pendingConfirmTimer = setTimeout(() => {
        pendingConfirmTimer = null;

        // báº£o vá»‡: trÃ¡nh confirm láº·p quÃ¡ nhanh
        const now = Date.now();
        if (now - lastConfirmAt < 300) return;

        confirmEntry();               // gá»i hÃ m ghi entry (hiá»ƒn thá»‹ + lÆ°u)
        lastConfirmAt = Date.now();

        // ngÄƒn click káº¿ tiáº¿p ghi Ä‘Ãºp (náº¿u cÃ³)
        suppressNextClick = true;
        setTimeout(()=> { suppressNextClick = false; }, 350);
      }, 450);

      // reset moved sau 600ms Ä‘á»ƒ trÃ¡nh va cháº¡m vá»›i click handler
      setTimeout(()=> { moved = false; }, 600);

    } else {
      // khÃ´ng pháº£i kÃ©o (chá»‰ nháº¥n) â†’ click handler sáº½ xá»­ lÃ½
    }
  });

  // click
  slider.addEventListener('click', e=>{
    // Náº¿u vá»«a cÃ³ pendingConfirm (sáº¯p ghi) thÃ¬ hÃ£y huá»· pending vÃ  khÃ´ng ghi á»Ÿ click,
    // hoáº·c náº¿u pending Ä‘Ã£ cháº¡y thÃ¬ suppressNextClick sáº½ cháº·n click.
    if (pendingConfirmTimer) {
      // NgÆ°á»i dÃ¹ng click ngay sau khi tháº£ â€” kháº£ nÄƒng há» muá»‘n click thay vÃ¬ ghi tá»± Ä‘á»™ng.
      // Tá»‘t nháº¥t lÃ  huá»· pending vÃ  xá»­ lÃ½ click nhÆ° 1 nháº¥n (ghi ngay láº­p tá»©c).
      clearTimeout(pendingConfirmTimer);
      pendingConfirmTimer = null;
      // tiáº¿p tá»¥c xá»­ lÃ½ tiáº¿p (khÃ´ng return) â†’ sáº½ gá»i confirmEntry() á»Ÿ dÆ°á»›i
    }

    // Náº¿u vá»«a bá»‹ suppress (vá»«a ghi á»Ÿ pending) â†’ bá» qua click
    if (suppressNextClick) {
      e.stopPropagation();
      e.preventDefault();
      return;
    }

    // Náº¿u cÃ³ kÃ©o (moved = true) â†’ KHÃ”NG tÃ­nh Ä‘iá»ƒm (kÃ©o Ä‘Ã£ lÃªn lá»‹ch xá»­ lÃ½)
    if (moved) {
      e.stopPropagation();
      return;
    }

    // KhÃ´ng kÃ©o â†’ lÃ  NHáº¤N â†’ tÃ­nh Ä‘iá»ƒm ngay
    confirmEntry();
  });
}




// Äáº·t slider theo value
function placeSliderAtValue(v){
  slider.style.top = valueToY(v) + 'px';
}

// Khi nháº¥n confirm

function confirmEntry(){
  if(state.status!=='running'){
    alert('Nháº¥n Reset Ä‘á»ƒ Ä‘Æ°a Tá»•ng Ä‘iá»ƒm vá» 0 vÃ  báº¯t Ä‘áº§u láº¡i chu kÃ¬ 1 tuáº§n tá»± pháº£n tÆ°.');
    return;
  }

  const rect = ruler.getBoundingClientRect();
  const sliderRect = slider.getBoundingClientRect();
  // centerY tÃ­nh theo khÃ´ng gian Ná»˜I Bá»˜ cá»§a ruler (client space)
  const y = slider.offsetTop + slider.offsetHeight/2;

  const v = yToValue(y);

  // ---------- HIá»†N ÄIá»‚M Tá»¨C THá»œI (show instant score) ----------
  // ---------- HIá»†N ÄIá»‚M Tá»¨C THá»œI (show instant score) ----------
  let inst = document.getElementById('instantScore');
  const statusRight = document.getElementById('statusRight'); // <--- Láº¥y container cáº§n cÄƒn pháº£i
  
  if(!inst){
    inst = document.createElement('div');
    inst.id = 'instantScore';
    // inst.style.position = 'absolute'; // ÄÃ£ bá»
    inst.style.display = 'none';
    inst.style.fontWeight = '700';
    inst.style.fontSize = '16px';
    inst.style.lineHeight = '1';
    inst.style.padding = '4px 8px';
    inst.style.borderRadius = '10px';
    inst.style.boxShadow = '0 2px 8px rgba(0,0,0,0.15)';
    inst.style.background = 'rgba(255,255,255,0.98)';
    // inst.style.pointerEvents = 'none'; // KhÃ´ng cáº§n ná»¯a
    // inst.style.zIndex = '9999'; // KhÃ´ng cáº§n ná»¯a
    inst.style.transition = 'opacity 0.25s ease';
    inst.style.color = '#004080';
    
    // Sá»¬A: ChÃ¨n vÃ o statusRight thay vÃ¬ document.body
    if (statusRight) {
      statusRight.appendChild(inst);
    } else {
      document.body.appendChild(inst); // Fallback
    }
  }

  // (Pháº§n code Ä‘Ã£ xÃ³a logic tÃ­nh toÃ¡n vá»‹ trÃ­ náº±m á»Ÿ Ä‘Ã¢y)

  // Ná»™i dung + hiá»ƒn thá»‹
  const cat = getCategoryFromValue(v);
  inst.textContent = (v > 0 ? '+' : '') + v + ' ' + cat.emoji;
  if (inst._hideTimeout) { clearTimeout(inst._hideTimeout); inst._hideTimeout = null; }
  
  inst.style.opacity = '1';
  inst.style.display = 'inline-flex'; // <--- Sá»¬A: Hiá»ƒn thá»‹ inline-flex Ä‘á»ƒ cÄƒn chá»‰nh
  
  // (Pháº§n requestAnimationFrame thá»© 2 Ä‘Ã£ bá»‹ xÃ³a)

  // áº¨n sau 700ms vá»›i fade
  inst._hideTimeout = setTimeout(()=> {
    inst.style.opacity = '0';
    setTimeout(()=> {
      inst.style.display = 'none';
      inst.style.opacity = '1'; // reset cho láº§n sau
    }, 250);
    inst._hideTimeout = null;
  }, 700);

  // ...
  // ---------- Káº¾T THÃšC PHáº¦N HIá»‚N THá»Š ÄIá»‚M Tá»¨C THá»œI ----------

  // LÆ°u entry vá»›i nhÃ£n chi tiáº¿t
  state.entries.push({
    ts: Date.now(),
    value: v,
    dir: getCategoryFromValue(v).label,
    time: new Date().toLocaleTimeString('vi-VN'),
    date: new Date().toLocaleDateString('vi-VN')
  });
  saveCurrentCycle();

  flashWhite();
  playBeep();
  slider.style.transition='top 0.25s ease';
  setTimeout(()=>slider.style.transition='',300);
}

function flashWhite() {
  LED.classList.remove('red','amber','green','pulse','led-red-alert','pulse-amber');
  LED.style.transition = 'none';
  LED.style.background = '#ffffff';

  // báº­t sÃ¡ng
  LED.style.opacity = '1';

  // táº¯t nhanh sau 120ms
  setTimeout(() => {
    LED.style.transition = 'opacity 0.15s';
    LED.style.opacity = '0.2';
  }, 120);

  // táº¯t hoÃ n toÃ n sau 250ms (trá»Ÿ vá» tráº¡ng thÃ¡i cÅ©)
  setTimeout(() => {
    LED_clear();
    LED.style.opacity = '1'; 
  }, 250);
}
// Countdown
function updateCountdown() {
  if (state.status !== 'running') {
    countdownEl.textContent = '--';
    return;
  }

  const now = Date.now();
  const rem = state.startTimestamp + MS_COUNTDOWN - now;

  // Háº¿t giá» â†’ giá»¯ nguyÃªn logic cÅ©
  if (rem <= 0) {
    finishCycle();
    return;
  }

  // --- Chuyá»ƒn Ä‘á»•i rem (ms) thÃ nh ngÃ y â€“ giá» â€“ phÃºt â€“ giÃ¢y ---
  let remaining = rem;

  const days = Math.floor(remaining / (24 * 60 * 60 * 1000));
  remaining %= 24 * 60 * 60 * 1000;

  const hours = Math.floor(remaining / (60 * 60 * 1000));
  remaining %= 60 * 60 * 1000;

  const minutes = Math.floor(remaining / (60 * 1000));
  const seconds = Math.floor((remaining % (60 * 1000)) / 1000);

  // --- Giá»¯ nguyÃªn cÃ¡ch update DOM, chá»‰ Ä‘á»•i format text ---
  countdownEl.textContent =
    `${days} ngÃ y ` +
    `${String(hours).padStart(2, '0')}:` +
    `${String(minutes).padStart(2, '0')}:` +
    `${String(seconds).padStart(2, '0')}`;
    saveCurrentCycle()
}

function finishCycle(){
    console.log("[finishCycle] start - state before finish:", state);

    state.status = 'finished';

    // TÃ­nh Ä‘iá»ƒm trung bÃ¬nh (1 chá»¯ sá»‘ tháº­p phÃ¢n)
    const entries = Array.isArray(state.entries) ? state.entries : [];
    let avgScore = 0;
    if (entries.length > 0) {
        const sum = entries.reduce((s,e) => s + (Number(e.value) || 0), 0);
        avgScore = Math.round((sum / entries.length) * 10) / 10; // 1 decimal
    } else {
        avgScore = 0.0;
    }

  // --- LED & Ã¢m thanh theo quy Ä‘á»‹nh má»›i ---
LED.className = 'led'; // reset lá»›p
LED.style.background = ''; // reset mÃ u inline
LED.style.opacity = '1';
LED.classList.remove('led-red-alert','pulse','pulse-amber','purple','blue','red','green','amber');

const sndAmber = document.getElementById('sndAmber');
const sndRed   = document.getElementById('sndRed');
const sndGreen = document.getElementById('sndGreen');
const sndBn    = document.getElementById('sndBannangnhe');   // bannangnhe.mp3
const sndSieu  = document.getElementById('sndSieunganhe');  // sieunganhe.mp3

// Quy táº¯c:
// [-10000 .. -6667] -> TIM (nháº¥p nhÃ¡y) + alert-red
// [-6666  .. -3334] -> Äá» (tÄ©nh)       + bannangnhe.mp3
// [-3333  .. 3333 ] -> XANH LÃ (tÄ©nh)  + success.mp3
// [3334   .. 6666 ] -> XANH DÆ¯Æ NG (nháº¥p nhÃ¡y) + sieunganhe.mp3
// [6667   .. 10000] -> CAM (nháº¥p nhÃ¡y) + alert-amber.mp3

if (avgScore <= -6667) {
    // tÃ­m nháº¥p nhÃ¡y + play alert-red
    LED.classList.add('purple','pulse');
    LED.style.background = '#8e44ad';
    LED.style.animationDuration = '0.4s';
    if (sndRed) { sndRed.currentTime = 0; sndRed.loop = true;sndRed.play().catch(()=>{}); }
} else if (avgScore <= -3334) {
    // Ä‘á»+ play bannangnhe
    LED.classList.add('red','pulse');
    LED.style.background = '#e74c3c';
    LED.style.animationDuration = '0.8s';
    if (sndBn) { sndBn.currentTime = 0; sndBn.loop = true;sndBn.play().catch(()=>{}); }
} else if (avgScore <= 3333) {
    // xanh lÃ¡ tÄ©nh + success
    LED.classList.add('green');
    LED.style.background = '#2ecc71';
    LED.classList.remove('pulse','led-red-alert','pulse-amber');
    if (sndGreen) { sndGreen.currentTime = 0; sndGreen.loop = true;sndGreen.play().catch(()=>{}); }
} else if (avgScore <= 6666) {
    // xanh dÆ°Æ¡ng nháº¥p nhÃ¡y + sieunganhe
    LED.classList.add('blue','pulse');
    LED.style.background = '#2980b9';
    LED.style.animationDuration = '1.6s';
    if (sndSieu) { sndSieu.currentTime = 0; sndSieu.loop = true;sndSieu.play().catch(()=>{}); }
} else {
    // >=6667 : vÃ ng nháº¥p nhÃ¡y + alert-amber
    LED.classList.add('amber','pulse-amber');
    LED.style.background = '#FFD700';
    LED.style.animationDuration = '0.8s';
    if (sndAmber) { sndAmber.currentTime = 0; sndAmber.loop = true; sndAmber.play().catch(()=>{}); }
}


    // Hiá»ƒn thá»‹ Äiá»ƒm trung bÃ¬nh (format +1 decimal)
    const avgEl = document.getElementById('avg');
    const avgBox = document.getElementById('avgScore');

    if (avgEl) {
        avgEl.classList.remove('hidden');
        avgEl.textContent = (avgScore > 0 ? '+' : '') + avgScore.toFixed(1);
    }
    if (avgBox) avgBox.style.display = 'block';

    // áº¨n vÃ¹ng "Thá»i gian cÃ²n láº¡i" (gÃ³c dÆ°á»›i trÃ¡i)
    if (countdownEl && countdownEl.parentElement) {
        countdownEl.parentElement.style.display = 'none';
    }

   // => Thay tháº¿ popup ná»•i báº±ng hiá»ƒn thá»‹ NGAY cáº¡nh "Äiá»ƒm trung bÃ¬nh"
// Thay tháº¿ IIFE showTrendInline cÅ© báº±ng Ä‘oáº¡n nÃ y
// Hiá»ƒn thá»‹ Trend: chÃ¨n vÃ o #statusRight Ä‘á»ƒ luÃ´n sÃ¡t mÃ©p pháº£i
// Hiá»ƒn thá»‹ Trend: chÃ¨n vÃ o #statusRight Ä‘á»ƒ luÃ´n sÃ¡t mÃ©p pháº£i
(function showTrendInline() {
  const trendText = interpretScore(avgScore);
  const avgBoxEl = document.getElementById('avgScore');
  const statusRight = document.getElementById('statusRight');

  // hiá»‡n avg á»Ÿ trÃ¡i (chá»‰ hiá»ƒn thá»‹ khi káº¿t thÃºc chu ká»³)
  if (avgBoxEl) {
    avgBoxEl.style.display = 'inline-flex';
    avgBoxEl.style.visibility = 'visible';
  }

  if (statusRight) {
    // dá»n sáº¡ch vÃ  chÃ¨n pháº§n tá»­ trend má»›i
    statusRight.innerHTML = '';
    const inline = document.createElement('span');
    inline.id = 'avgTrendInline';
    inline.textContent = trendText;
    // Ä‘áº£m báº£o cÄƒn giá»¯a náº¿u CSS chÆ°a Ä‘Æ°á»£c náº¡p/override
    inline.style.display = 'inline-flex';
    inline.style.alignItems = 'center';
    inline.style.lineHeight = '1';
    statusRight.appendChild(inline);
  } else {
    // fallback: chÃ¨n nháº¹ vÃ o avgBox, khÃ´ng chá»“ng lÃªn ná»™i dung
    if (avgBoxEl) {
      let inline = document.getElementById('avgTrendInline');
      if (!inline) {
        inline = document.createElement('span');
        inline.id = 'avgTrendInline';
        inline.style.display = 'inline-flex';
        inline.style.alignItems = 'center';
        inline.style.marginLeft = '8px';
        avgBoxEl.appendChild(inline);
      }
      inline.textContent = trendText;
    }
  }
})();


    // Táº¡o báº£n ghi chu ká»³ hoÃ n chá»‰nh (lÆ°u avgScore thay vÃ¬ total)
    const finishedCycle = {
        cycleId: Date.now(),
        startTime: state.startTimestamp,
        endTime: Date.now(),
        avgScore: avgScore,
        entries: entries.slice(),
        // THÃŠM ÄOáº N NÃ€Y: Khá»Ÿi táº¡o object chá»©a pháº£n tÆ°
        feedback: {
            q1: "", // Bá»‘i cáº£nh/Sá»± kiá»‡n
            q2: "", // Xung Ä‘á»™t ná»™i tÃ¢m
            q3: "", // BÃ i há»c/Insight
            r1: 0,  // Kháº£ dá»¥ng (Usability)
            r2: 0,  // Hiá»‡u quáº£ nháº­n thá»©c (Effectiveness)
            r3: 0   // TÃ¡c Ä‘á»™ng hÃ nh vi (Impact)
        }
    };

    if(!Array.isArray(state.finishedCycles)) state.finishedCycles = loadFinishedCycles() || [];
    state.finishedCycles.unshift(finishedCycle);
    saveFinishedCycles(state.finishedCycles);

    console.log("[finishCycle] saved finishedCycles length =", state.finishedCycles.length);

    // XÃ³a chu ká»³ hiá»‡n táº¡i khá»i localStorage
    localStorage.removeItem(CURRENT_CYCLE_KEY);

    // Reset current state (idle)
    state.status = 'idle';
    state.startTimestamp = null;
    state.entries = [];
    saveCurrentCycle();
}



function startCycle(){
  state = { status:'running', startTimestamp: Date.now(), entries: [] , finishedCycles: state.finishedCycles || [] };
  LED_clear();
  const avgBox = document.getElementById('avgScore');
  if(avgBox) avgBox.style.display = 'none';

  // PHá»¤C Há»’I vÃ¹ng "Thá»i gian cÃ²n láº¡i" (gÃ³c dÆ°á»›i trÃ¡i)
  if (countdownEl && countdownEl.parentElement) {
      countdownEl.parentElement.style.display = 'block';
      countdownEl.textContent = '--';
  }

  // XÃ³a pháº§n hiá»ƒn thá»‹ khuynh hÆ°á»›ng cÅ© (náº¿u cÃ³) vÃ  dá»n vÃ¹ng pháº£i
  const oldTrend = document.getElementById('avgTrendInline');
  if (oldTrend) oldTrend.remove();
  const statusRight = document.getElementById('statusRight');
  if (statusRight) statusRight.innerHTML = '';


  placeSliderAtValue(0);
  saveCurrentCycle();
}


resetBtn.onclick = () => {

  // ---- Dá»ªNG NGAY Táº¤T Cáº¢ Ã‚M THANH ----
 const audios = ['sndAmber','sndRed','sndGreen','sndBannangnhe','sndSieunganhe'];

  audios.forEach(id => {
    const a = document.getElementById(id);
    if (a) {
      a.pause();
      a.currentTime = 0;
      // reload src Ä‘á»ƒ cÃ¡c trÃ¬nh duyá»‡t cháº¯c cháº¯n dá»«ng
      a.src = a.src;
    }
  });
 document.getElementById('avgScore').style.display = 'none';
startCycle();


  // ---- RESET BÃŒNH THÆ¯á»œNG ----
  startCycle();
};

const helpContent ='<strong>ğŸ¯ Äá»ŠNH NGHÄ¨A BA Táº¦NG TÃ‚M LÃ</strong>\n<strong>1) Báº¢N NÄ‚NG (Id)  â€“ Táº¦NG NÄ‚NG LÆ¯á»¢NG NGUYÃŠN THá»¦Y ğŸ’¥- ÄÃ”I KHI LÃ€ ÃC QUá»¶ ğŸ‘¿! THÃš TÃNH ğŸº!</strong> \nBáº£n nÄƒng lÃ  pháº§n sÃ¢u nháº¥t vÃ  nguyÃªn thá»§y nháº¥t cá»§a con ngÆ°á»i:  \nChá»©a cÃ¡c nhu cáº§u sinh há»c: Äƒn, ngá»§, sinh tá»“n... ğŸ–ğŸ˜´ \nChá»©a cÃ¡c cáº£m xÃºc thÃ´: giáº­n dá»¯, háº­n thÃ¹, ham muá»‘n, chiáº¿m há»¯u, ghen tuÃ´ng... ğŸ˜¡ğŸ”¥ \nKhÃ´ng biáº¿t Ä‘Ãºng â€“ sai âš–ï¸ \nKhÃ´ng biáº¿t Ä‘áº¡o Ä‘á»©c hay phÃ¡p luáº­t \nChá»‰ muá»‘n thá»a mÃ£n ngay láº­p tá»©c â© \nHoáº¡t Ä‘á»™ng theo NguyÃªn táº¯c KhoÃ¡i cáº£m ğŸ˜‹ \nBáº£n nÄƒng lÃ  Ä‘á»™ng cÆ¡ thÃ´, máº¡nh máº½ nhÆ°ng thiáº¿u kiá»ƒm soÃ¡t. \nBáº£n nÄƒng khÃ´ng xáº¥u.\nNÃ³ lÃ  Ä‘á»™ng cÆ¡ sá»‘ng, thÃºc Ä‘áº©y sÃ¡ng táº¡o, sá»©c máº¡nh, sinh lá»±c. NhÆ°ng náº¿u khÃ´ng Ä‘Æ°á»£c Ä‘iá»u tiáº¿t, nÃ³ dá»… trá»Ÿ thÃ nh xung lá»±c máº¥t kiá»ƒm soÃ¡t.\nâ†’ Cáº§n Báº£n ngÃ£ Ä‘iá»u tiáº¿t vÃ  SiÃªu ngÃ£ Ä‘á»‹nh hÆ°á»›ng. \n\n<strong>2) Báº¢N NGÃƒ (Ego) ğŸ§ ğŸ¦°ğŸ‘¤â€“ CON NGÆ¯á»œI THá»°C Táº¾</strong> \nBáº£n ngÃ£ hÃ¬nh thÃ nh Ä‘á»ƒ giÃºp con ngÆ°á»i thÃ­ch nghi vá»›i thá»±c táº¡i: \n- ÄÃ¡nh giÃ¡ háº­u quáº£, cÃ¢n nháº¯c trÆ°á»›c khi lÃ m ğŸ’¡ \n- TÃ¬m cÃ¡ch thá»a mÃ£n Báº£n nÄƒng mÃ  khÃ´ng gÃ¢y ráº¯c rá»‘i \n- Nháº­n diá»‡n luáº­t lá»‡, giá»›i háº¡n, rá»§i ro ğŸŒ \n- Láº­p káº¿ hoáº¡ch â€“ tá»• chá»©c â€“ kiá»ƒm soÃ¡t hÃ nh vi ğŸ“…ğŸ•¹ï¸ \nBáº£n ngÃ£ váº­n hÃ nh theo NguyÃªn táº¯c Hiá»‡n thá»±c: Ä‘iá»u gÃ¬ cÃ³ thá»ƒ â€“ Ä‘iá»u gÃ¬ Ä‘Æ°á»£c phÃ©p â€“ Ä‘iá»u gÃ¬ nÃªn lÃ m.\nBáº£n ngÃ£ lÃ  bá»™ Ä‘iá»u phá»‘i trung tÃ¢m: \n- Giáº£m bá»›t yÃªu cáº§u bá»‘c Ä‘á»“ng cá»§a Báº£n nÄƒng \n- Giáº£m sá»± kháº¯t khe quÃ¡ má»©c cá»§a SiÃªu ngÃ£ \n- Giá»¯ cho cÃ¡ nhÃ¢n sá»‘ng cÃ¢n báº±ng â€“ lÃ½ trÃ­ â€“ thÃ­ch nghi vá»›i Ä‘á»i sá»‘ng thá»±c táº¿ \n\n<strong>3) SIÃŠU NGÃƒ (Superego) ğŸ•Šï¸â€“ Há»† THá»NG Äáº O Äá»¨C & LÃ TÆ¯á»NG - THIÃŠN THáº¦N ğŸ˜‡âœ¨</strong> \nSiÃªu ngÃ£ gá»“m <strong>CÃ¡i TÃ´i LÃ½ tÆ°á»Ÿng</strong> (hÃ¬nh áº£nh Ä‘áº¹p nháº¥t mÃ  báº£n thÃ¢n muá»‘n trá»Ÿ thÃ nh) vÃ  <strong>LÆ°Æ¡ng tÃ¢m</strong> (cáº£m giÃ¡c tá»™i lá»—i khi lÃ m Ä‘iá»u sai trÃ¡i, tá»± hÃ o khi lÃ m Ä‘iá»u Ä‘Ãºng).\nSiÃªu ngÃ£ Ä‘Æ°á»£c táº¡o nÃªn tá»«: giÃ¡o dá»¥c ğŸ“š, vÄƒn hÃ³a â€“ xÃ£ há»™i ğŸŒ, sá»± hÆ°á»›ng thiá»‡n â€“ mong muá»‘n trá»Ÿ nÃªn tá»‘t Ä‘áº¹p hÆ¡n ğŸ•Šï¸ğŸ˜‡. \nNÃ³ váº­n hÃ nh theo NguyÃªn táº¯c Äáº¡o Ä‘á»©c/LÃ½ tÆ°á»Ÿng: \n- Äáº·t ra tiÃªu chuáº©n Ä‘Ãºng â€“ sai âš–ï¸ \n- Táº¡o cáº£m giÃ¡c tá»™i lá»—i khi lÃ m sai ğŸ’” \n- Táº¡o cáº£m giÃ¡c tá»± hÃ o khi lÃ m Ä‘Ãºng ğŸŒˆ \n- LuÃ´n muá»‘n Ä‘áº¡t sá»± hoÃ n háº£o ğŸ† \nSiÃªu ngÃ£ lÃ  ngÆ°á»i giÃ¡m sÃ¡t ná»™i tÃ¢m: \nâ†’ Khuyáº¿n khÃ­ch Ä‘iá»u tá»‘t \nâ†’ NgÄƒn hÃ nh vi sai \nâ†’ NhÆ°ng Ä‘Ã´i khi khiáº¿n báº¡n nghiÃªm kháº¯c quÃ¡ má»©c vá»›i báº£n thÃ¢n \n\n<strong>ğŸ“ 3 NGUYÃŠN Táº®C Äá»‚ Gáº T THÆ¯á»šC ÄÃšNG</strong> \n<strong>1) Äá»˜NG CÆ  ğŸš€</strong> \nMá»¥c Ä‘Ã­ch tháº­t sá»± cá»§a báº¡n...? \nPhá»¥c vá»¥ báº£n thÃ¢n hay ngÆ°á»i khÃ¡c...? \nXuáº¥t phÃ¡t tá»« cáº£m xÃºc, lÃ½ trÃ­ hay Ä‘áº¡o Ä‘á»©c...? \n\n<strong>2) Báº¢N CHáº¤T KHÃCH QUAN ğŸ§</strong> \nTheo phÃ¡p luáº­t â€“ vÄƒn hÃ³a â€“ Ä‘áº¡o Ä‘á»©c - xÃ£ há»™i hiá»‡n táº¡i nÆ¡i báº¡n sá»‘ng, hÃ nh vi Ä‘Ã³ gÃ¢y háº¡i hay gÃ¢y lá»£i...? \nHáº­u quáº£ náº·ng hay nháº¹...? LÃ¢u dÃ i hay nháº¥t thá»iâ€¦?\nNgÆ°á»i bÃ¬nh thÆ°á»ng sáº½ Ä‘Ã¡nh giÃ¡ tháº¿ nÃ o?\n\n<strong>3) Äá»’NG Cáº¢M ğŸ¤</strong>\nTheo suy nghÄ© cá»§a báº¡n: NgÆ°á»i Ä‘á»‘i diá»‡n sáº½ cáº£m tháº¥y gÃ¬ khi báº¡n lÃ m nhÆ° váº­y (háº¡nh phÃºc, bÃ¬nh an, vui váº», Ä‘Æ°á»£c lá»£i, Ä‘au khá»•, báº¥t háº¡nh, tá»•n thÆ°Æ¡ngâ€¦)? \nTÃ¡c Ä‘á»™ng nháº¥t thá»i hay dÃ i háº¡n...? \n\nâ¡ï¸ Vá»›i má»—i nguyÃªn táº¯c, náº¿u hÃ nh vi khuynh hÆ°á»›ng bÃªn nÃ o thÃ¬ gáº¡t vá» bÃªn Ä‘Ã³ má»™t Ä‘oáº¡n. Vá»‹ trÃ­ cuá»‘i cÃ¹ng cá»§a thanh gáº¡t = káº¿t quáº£ sau khi gáº¡t dá»“n vÆ°á»£t qua 3 nguyÃªn táº¯c. Hoáº·c cÃ³ thá»ƒ nhÃ¬n nháº­n chung 3 nguyÃªn táº¯c rá»“i gáº¡t thÆ°á»›c 1 láº§n sau Ä‘Ã³ cho phÃ¹ há»£p.\n\nâ“ Náº¾U KHÃ”NG XÃC Äá»ŠNH ÄÆ¯á»¢C 1 NGUYÃŠN Táº®C? \nVÃ­ dá»¥: ChÆ°a rÃµ Ä‘á»™ng cÆ¡, khÃ´ng biáº¿t luáº­t, khÃ´ng nghÄ© Ä‘Æ°á»£c Ä‘áº¿n cáº£m xÃºc ngÆ°á»i khÃ¡c... \nâ¡ï¸ KhÃ´ng gáº¡t nguyÃªn táº¯c Ä‘Ã³ \n\n<strong>ğŸ§­ KHI NÃ€O NÃŠN DÃ™NG â€“ KHI NÃ€O KHÃ”NG NÃŠN DÃ™NG</strong> \n<strong>âœ… DÃ™NG KHI hÃ nh vi cÃ³:</strong> Cáº£m xÃºc, nháº­n thá»©c, Ã½ thá»©c rÃµ rÃ ng, liÃªn quan Ä‘áº¿n Ä‘áº¡o Ä‘á»©c, cÃ³ lá»±a chá»n, tÃ¡c Ä‘á»™ng Ä‘áº¿n ngÆ°á»i khÃ¡c, cÃ³ xung Ä‘á»™t ná»™i tÃ¢m, Ä‘áº¥u tranh giá»¯a báº£n nÄƒng - lÃ½ trÃ­ vÃ  Ä‘áº¡o Ä‘á»©c... \nVÃ­ dá»¥: Quyáº¿t Ä‘á»‹nh nÃ³i tháº­t hay nÃ³i dá»‘i, tha thá»© hay tráº£ Ä‘Å©a, chia sáº» hay giá»¯ lá»£i Ã­ch cho mÃ¬nh, nÃ³i lá»i tá»­ táº¿ hay lá»i lÃ m tá»•n thÆ°Æ¡ngâ€¦ \n\n<strong>âŒ KHÃ”NG DÃ™NG KHI:</strong>\n1) Pháº£n xáº¡ sinh há»c: giáº­t mÃ¬nh, nÃ© váº­t, co tay khi nÃ³ng... \n2) CÃ´ng viá»‡c ká»¹ thuáº­t â€“ logic thuáº§n tÃºy: giáº£i toÃ¡n, viáº¿t code, nghiÃªn cá»©u khoa há»c \n3) ThÃ³i quen vÃ´ thá»©c: Ä‘Ã¡nh rÄƒng, táº¯m, lÆ°á»›t máº¡ng xÃ£ há»™i theo pháº£n xáº¡... \n4) HÃ nh vi táº­p thá»ƒ â€“ xÃ£ há»™i há»c: nghi lá»… tÃ´n giÃ¡o, biá»ƒu tÃ¬nh, báº§u cá»­, máº·c Ä‘á»“ng phá»¥c... \n5) HÃ nh vi siÃªu thá»©c / ngoÃ i thá»i gian â€“ khÃ´ng gian: thiá»n sÃ¢u, sÃ¡ng táº¡o Ä‘áº¿n quÃªn mÃ¬nh, giÃ¡c ngá»™, cáº­n tá»­... \n6) NgÆ°á»i máº¥t kháº£ nÄƒng tá»± chá»§: loáº¡n tháº§n, hoang tÆ°á»Ÿng, say rÆ°á»£u áº£o giÃ¡c, Ä‘á»™ng kinh, bá»‹ cÆ°á»¡ng bá»©c - Ã©p buá»™c - hoÃ n cáº£nh chi phá»‘i máº¡nh... \n\n<strong>ğŸ” Lá»°A CHá»ŒN Gáº T TRÆ¯á»šC HAY SAU HÃ€NH VI</strong> \nGáº¡t trÆ°á»›c khi lÃ m: \nâ†’ GiÃºp báº¡n cÃ¢n nháº¯c ká»¹ háº­u quáº£ \nâ†’ Giáº£m hÃ nh vi bá»‘c Ä‘á»“ng \nGáº¡t sau khi lÃ m: \nâ†’ GiÃºp báº¡n hiá»ƒu mÃ¬nh hÆ¡n \nâ†’ TÄƒng kháº£ nÄƒng tá»± Ä‘Ã¡nh giÃ¡ \n\n<strong>âš™ï¸ Cáº¤U HÃŒNH BAN Äáº¦U (KHI RESET)</strong> \nThanh gáº¡t Ä‘áº·t á»Ÿ chÃ­nh giá»¯a â†’ tÆ°á»£ng trÆ°ng cho Báº£n ngÃ£ â€“ tráº¡ng thÃ¡i cÃ¢n báº±ng âš–ï¸ \nÄiá»ƒm trung bÃ¬nh = 0 ğŸ¯ \nÄÃ¨n vÃ  Ã¢m thanh táº¯t ğŸ”• \n\n<strong>â³ CHU Ká»² PHáº¢N TÆ¯ 168 GIá»œ (7 NGÃ€Y)</strong> \nSau khi nháº¥n <strong>Reset</strong> â†’ Ä‘á»“ng há»“ báº¯t Ä‘áº§u Ä‘áº¿m 168 giá» \nTrong 7 ngÃ y: \nGáº¡t thÆ°á»›c khÃ´ng giá»›i háº¡n sá»‘ láº§n \nMá»—i láº§n nháº¥n â†’ Ä‘iá»ƒm Ä‘Æ°á»£c dÃ¹ng vÃ o viá»‡c tÃ­nh Äiá»ƒm trung bÃ¬nh ğŸ“Š \n\n<strong>ğŸšï¸ CÃCH THá»¨C GHI NHáº¬N XU HÆ¯á»šNG TÃ‚M LÃ</strong> \nGáº¡t vá» phÃ­a Báº£n nÄƒng (Id) â†’ Äiá»ƒm Ã¢m ğŸ’” \nâ†’ HÃ nh vi thiÃªn vá» cáº£m xÃºc thÃ´ â€“ thiáº¿u cÃ¢n nháº¯c \nGáº¡t vá» phÃ­a SiÃªu ngÃ£ (Superego) â†’ Äiá»ƒm dÆ°Æ¡ng â¤ï¸ \nâ†’ HÃ nh vi thiÃªn vá» Ä‘áº¡o Ä‘á»©c â€“ chuáº©n má»±c â€“ trÃ¡ch nhiá»‡m \nCÃ ng sÃ¡t hai cá»±c â†’ má»©c Ä‘á»™ cÃ ng máº¡nh \n\n<strong>ğŸ§  XÃC NHáº¬N ÄIá»‚M</strong> \nKhi áº¥n xuá»‘ng trÃªn thanh gáº¡t: \nHá»‡ thá»‘ng lÆ°u láº¡i Ä‘iá»ƒm ğŸ—ƒï¸ \nÄÃ¨n sÃ¡ng tráº¯ng ğŸ¤ \nPhÃ¡t tiáº¿ng bÃ­p nháº¹ ğŸ”Š \nâ†’ BÃ¡o hiá»‡u: ghi Ä‘iá»ƒm thÃ nh cÃ´ng ğŸ‰, Ä‘iá»ƒm sáº½ Ä‘Æ°á»£c tÃ­nh trong Ä‘iá»ƒm trung bÃ¬nh xuáº¥t hiá»‡n sau 168 giá». \nSau khi gáº¡t vÃ  tÃ­ch Ä‘iá»ƒm xong má»™t láº§n, nháº¥n nÃºt <strong>Há»“i vá»‹</strong> Ä‘á»ƒ Ä‘Æ°a thanh gáº¡t vá» vá»‹ trÃ­ gá»‘c chÃ­nh giá»¯a ban Ä‘áº§u, chuáº©n bá»‹ cho láº§n gáº¡t tiáº¿p theo. \n\n<strong>ğŸ“£ BÃO CÃO Tá»”NG Káº¾T TÃ‚M LÃ SAU 168 GIá»œ - 7 NGÃ€Y - 1 TUáº¦N</strong>\nâœ¨ Má»—i má»©c Ä‘iá»ƒm trung bÃ¬nh lÃ  má»™t â€œtráº¡ng thÃ¡i ná»™i tÃ¢m chá»§ Ä‘áº¡oâ€ kÃ¨m hiá»ƒn thá»‹ Ä‘Ã¨n â€“ Ã¢m thanh â€“ khuynh hÆ°á»›ng tÃ¢m lÃ½ âœ¨\n<strong>ğŸŸ£ [-10000 â†’ -6667] â€“ Báº¢N NÄ‚NG Máº NH ğŸ˜ˆğŸºğŸ’¥</strong>\nÄÃ¨n LED: ğŸŸ£ MÃ u tÃ­m nháº¥p nhÃ¡y liÃªn tá»¥c\nÃ‚m thanh: ğŸš¨ Cáº£nh bÃ¡o náº·ng \nBáº£n nÄƒng máº¡nhğŸº: lÃ  tráº¡ng thÃ¡i mÃ  con ngÆ°á»i hÃ nh Ä‘á»™ng chá»§ yáº¿u dá»±a trÃªn nhá»¯ng xung lá»±c nguyÃªn sÆ¡ vÃ  nhu cáº§u sinh há»c: Äƒn, ngá»§, thoáº£ mÃ£n khoÃ¡i cáº£m, sá»Ÿ há»¯u, thá»‘ng trá»‹, trÃ¡nh Ä‘au Ä‘á»›n. á» má»©c nÃ y, lÃ½ trÃ­ chÆ°a Ä‘á»§ sá»©c can thiá»‡p Ä‘á»ƒ Ä‘iá»u chá»‰nh, cÃ²n chuáº©n má»±c Ä‘áº¡o Ä‘á»©c thÃ¬ bá»‹ Ä‘áº©y lÃ¹i vá» phÃ­a sau. Con ngÆ°á»i dá»… bá»‹ cuá»‘n theo ham muá»‘n tá»©c thá»i vÃ  pháº£n á»©ng bá»‘c Ä‘á»“ng, nhiá»u khi báº¥t cháº¥p háº­u quáº£. Nhá»¯ng cáº£m xÃºc nhÆ° giáº­n dá»¯, tham lam, ghen tá»‹, hay nhu cáº§u chiáº¿m há»¯u Ä‘Æ°á»£c phÃ³ng Ä‘áº¡i, khiáº¿n hÃ nh vi trá»Ÿ nÃªn báº£n nÄƒng, thÃ´ rÃ¡p vÃ  nhiá»u khi mÃ¢u thuáº«n vá»›i xÃ£ há»™i. Báº£n nÄƒng máº¡nh mang sá»©c sá»‘ng mÃ£nh liá»‡t, nhÆ°ng náº¿u khÃ´ng Ä‘Æ°á»£c Ä‘á»‹nh hÆ°á»›ng, nÃ³ cÃ³ thá»ƒ gÃ¢y nÃªn nhá»¯ng xung Ä‘á»™t ná»™i tÃ¢m hoáº·c hÃ nh vi thiáº¿u kiá»ƒm soÃ¡t.\nLá»i khuyÃªn: há»c cÃ¡ch dá»«ng láº¡i 5 giÃ¢y trÆ°á»›c khi pháº£n á»©ng; ghi nháº­n cáº£m xÃºc thay vÃ¬ hÃ nh Ä‘á»™ng ngay theo nÃ³; táº­p thá»ƒ dá»¥c, thiá»n hoáº·c viáº¿t nháº­t kÃ½ Ä‘á»ƒ xáº£ nÄƒng lÆ°á»£ng thÃ´.\n\n<strong>ğŸ”´ [-6666 â†’ -3334] â€“ Báº¢N NÄ‚NG Vá»ªA</strong>âš¡ï¸ğŸ˜ ğŸ˜‹ \nÄÃ¨n LED: ğŸ”´ Äá» nháº¥p nhÃ¡y ká»‹ch tÃ­nh\nÃ‚m thanh: ğŸµ ká»‹ch tÃ­nh, báº¥t á»•n\ná» má»©c báº£n nÄƒng vá»«a, con ngÆ°á»i váº«n cÃ²n váº­n hÃ nh theo nhu cáº§u vÃ  ham muá»‘n, nhÆ°ng cÃ¡c xung lá»±c nÃ y Ä‘Ã£ Ä‘Æ°á»£c Ä‘iá»u chá»‰nh má»™t pháº§n nhá» tráº£i nghiá»‡m vÃ  sá»± nháº­n biáº¿t vá» háº­u quáº£. NgÆ°á»i cÃ³ má»©c báº£n nÄƒng nÃ y khÃ´ng hoÃ n toÃ n tuÃ¢n theo cáº£m xÃºc bá»™c phÃ¡t mÃ  biáº¿t cÃ¢n nháº¯c sÆ¡ bá»™ giá»¯a cÃ¡i muá»‘n vÃ  cÃ¡i nÃªn. Nhá»¯ng thÃ´i thÃºc cÃ¡ nhÃ¢n váº«n cÃ²n máº¡nh nhÆ°ng khÃ´ng Ã¡p Ä‘áº£o toÃ n bá»™ suy nghÄ©. Há» cho phÃ©p mÃ¬nh theo Ä‘uá»•i khoÃ¡i cáº£m vÃ  nhu cáº§u tá»± nhiÃªn, nhÆ°ng Ä‘Ã£ hÃ¬nh thÃ nh nhá»¯ng giá»›i háº¡n tÆ°Æ¡ng Ä‘á»‘i rÃµ rÃ ng, vÃ­ dá»¥: biáº¿t kiá»m láº¡i cÆ¡n giáº­n, biáº¿t chá» Ä‘á»£i, hoáº·c biáº¿t cÃ¢n nháº¯c trÆ°á»›c khi hÃ nh Ä‘á»™ng. ÄÃ¢y lÃ  má»©c Ä‘á»™ báº£n nÄƒng hÃ i hÃ²a hÆ¡n, táº¡o ná»n táº£ng cho sá»± váº­n hÃ nh cá»§a báº£n ngÃ£.\nLá»i khuyÃªn: tiáº¿p tá»¥c rÃ¨n luyá»‡n kháº£ nÄƒng tá»± kiá»m cháº¿ báº±ng cÃ¡ch Ä‘áº·t â€œváº¡ch dá»«ngâ€ cho báº£n thÃ¢n; láº­p má»¥c tiÃªu ngáº¯n háº¡n Ä‘á»ƒ hÆ°á»›ng báº£n nÄƒng vÃ o viá»‡c cÃ³ Ã­ch; phÃ¢n tÃ­ch háº­u quáº£ trÆ°á»›c má»—i quyáº¿t Ä‘á»‹nh lá»›n.\n\n<strong>ğŸŸ¢ [-3333 â†’ +3333] â€“ Báº¢N NGÃƒ CÃ‚N Báº°NG</strong> ğŸ‘¤ğŸŒˆâš–ï¸ğŸ§ \nÄÃ¨n LED: ğŸŸ¢ Xanh lÃ¡ tÄ©nh â€“ Ãªm dá»‹u, á»•n Ä‘á»‹nh\nÃ‚m thanh: ğŸ‰ Nháº¡c chÃºc má»«ng vui tÆ°Æ¡i\nBáº£n ngÃ£ lÃ  trung tÃ¢m Ä‘iá»u phá»‘i cá»§a tÃ¢m lÃ½, nÆ¡i con ngÆ°á»i há»c cÃ¡ch cÃ¢n báº±ng giá»¯a nhu cáº§u ná»™i táº¡i vÃ  yÃªu cáº§u cá»§a xÃ£ há»™i. á» má»©c nÃ y, lÃ½ trÃ­ phÃ¡t huy vai trÃ²: phÃ¢n tÃ­ch, Ä‘Ã¡nh giÃ¡, dá»± Ä‘oÃ¡n, lá»±a chá»n hÃ nh vi phÃ¹ há»£p theo hoÃ n cáº£nh. Báº£n ngÃ£ khÃ´ng phá»§ nháº­n báº£n nÄƒng nhÆ°ng biáº¿t Ä‘á»‹nh hÆ°á»›ng nÃ³ má»™t cÃ¡ch hiá»‡u quáº£, thá»±c táº¿ vÃ  trÆ°á»Ÿng thÃ nh hÆ¡n. Con ngÆ°á»i cÃ³ báº£n ngÃ£ máº¡nh thÆ°á»ng hiá»ƒu rÃµ giá»›i háº¡n cá»§a báº£n thÃ¢n, biáº¿t kiá»ƒm soÃ¡t hÃ nh vi, biáº¿t thoáº£ hiá»‡p khi cáº§n vÃ  hÃ nh Ä‘á»™ng dá»±a trÃªn má»¥c tiÃªu dÃ i háº¡n. ÄÃ¢y lÃ  má»©c Ä‘á»™ á»•n Ä‘á»‹nh, giÃºp cÃ¡ nhÃ¢n sá»‘ng thá»±c táº¿, tá»± chá»§, ra quyáº¿t Ä‘á»‹nh dá»±a trÃªn lÃ½ trÃ­ mÃ  váº«n giá»¯ Ä‘Æ°á»£c báº£n cháº¥t con ngÆ°á»i.\nLá»i khuyÃªn: luÃ´n kiá»ƒm tra má»¥c tiÃªu dÃ i háº¡n trÆ°á»›c cÃ¡c hÃ nh Ä‘á»™ng ngáº¯n háº¡n, giá»¯ sá»± linh hoáº¡t â€“ báº£n ngÃ£ máº¡nh khÃ´ng cá»©ng nháº¯c mÃ  biáº¿t thÃ­ch nghi, rÃ¨n ká»¹ nÄƒng ra quyáº¿t Ä‘á»‹nh: viáº¿t ra, phÃ¢n tÃ­ch, chá»n phÆ°Æ¡ng Ã¡n tá»‘i Æ°u.\nThÃ´ng Ä‘iá»‡p: ÄÃ¢y chÃ­nh lÃ  má»¥c tiÃªu tá»‘i thÆ°á»£ng â€“ nhÃ¢n vÄƒn mÃ  há»‡ thá»‘ng Ä‘o lÆ°á»ng nÃ y hÆ°á»›ng Ä‘áº¿n: giÃºp báº¡n sá»‘ng hÃ i hÃ²a vá»›i chÃ­nh mÃ¬nh vÃ  tháº¿ giá»›i.\n\n<strong>ğŸ”µ [3334 â†’ 6666] â€“ SIÃŠU NGÃƒ Vá»ªA ï¸âœ¨ğŸ’–ğŸ•Šï¸</strong>\nÄÃ¨n LED: ğŸ”µ Xanh dÆ°Æ¡ng nháº¥p nhÃ¡y nháº¹ â€“ tinh khiáº¿t\nÃ‚m thanh: ğŸ‘¼ Ã‚m thanh thiÃªn tháº§n trong tráº»o\nSiÃªu ngÃ£ vá»«a thá»ƒ hiá»‡n sá»± hiá»‡n diá»‡n rÃµ rÃ ng cá»§a nhá»¯ng chuáº©n má»±c Ä‘áº¡o Ä‘á»©c, lÃ½ tÆ°á»Ÿng vÃ  giÃ¡ trá»‹ xÃ£ há»™i trong cÃ¡ch con ngÆ°á»i suy nghÄ© vÃ  hÃ nh Ä‘á»™ng. á» má»©c nÃ y, cÃ¡ nhÃ¢n biáº¿t tá»± Ä‘iá»u chá»‰nh báº£n thÃ¢n dá»±a vÃ o lÆ°Æ¡ng tÃ¢m, biáº¿t phÃ¢n biá»‡t Ä‘Ãºng â€“ sai, vÃ  cÃ³ xu hÆ°á»›ng hÆ°á»›ng thiá»‡n nhÆ°ng váº«n giá»¯ Ä‘Æ°á»£c sá»± linh hoáº¡t. Há» khÃ´ng quÃ¡ kháº¯t khe vá»›i chÃ­nh mÃ¬nh hay ngÆ°á»i khÃ¡c, mÃ  biáº¿t cÃ¢n báº±ng giá»¯a nguyÃªn táº¯c vÃ  thá»±c táº¿. SiÃªu ngÃ£ vá»«a giÃºp con ngÆ°á»i trá»Ÿ nÃªn cÃ³ trÃ¡ch nhiá»‡m, tháº¥u cáº£m vÃ  Ä‘Ã¡ng tin cáº­y mÃ  khÃ´ng rÆ¡i vÃ o cá»±c Ä‘oan Ä‘áº¡o Ä‘á»©c hay Ã¡p Ä‘áº·t. ÄÃ¢y lÃ  má»©c phÃ¡t triá»ƒn cho tháº¥y sá»± trÆ°á»Ÿng thÃ nh vá» máº·t nhÃ¢n cÃ¡ch vÃ  giÃ¡ trá»‹ sá»‘ng.\nLá»i khuyÃªn: tiáº¿p tá»¥c duy trÃ¬ lÃ²ng nhÃ¢n Ã¡i nhÆ°ng nhá»› tÃ´n trá»ng ranh giá»›i cÃ¡ nhÃ¢n, trÃ¡nh cá»‘ gáº¯ng â€œcá»©uâ€ táº¥t cáº£ má»i ngÆ°á»i â€“ hÃ£y chá»n Ä‘Ãºng nÆ¡i Ä‘á»ƒ giÃºp, há»c cÃ¡ch cháº¥p nháº­n ráº±ng khÃ´ng pháº£i lÃºc nÃ o cÅ©ng hoÃ n háº£o.\n\n<strong>ğŸŸ¡ [6667 â†’ 10000] â€“ SIÃŠU NGÃƒ Máº NH  ğŸ¤ğŸ˜‡ğŸŒŸ</strong>\nÄÃ¨n LED: ğŸŸ¡ VÃ ng nháº¥p nhÃ¡y máº¡nh â€“ ná»•i báº­t\nÃ‚m thanh: âš ï¸ Cáº£nh bÃ¡o\nSiÃªu ngÃ£ máº¡nh ğŸŒŸ: lÃ  khi nhá»¯ng chuáº©n má»±c Ä‘áº¡o Ä‘á»©c vÃ  lÃ½ tÆ°á»Ÿng trá»Ÿ thÃ nh trung tÃ¢m Ä‘á»‹nh hÆ°á»›ng má»i hÃ nh vi, Ä‘Ã´i khi á»Ÿ má»©c nghiÃªm kháº¯c Ä‘áº¿n Ä‘á»™ vÆ°á»£t qua nhu cáº§u cÃ¡ nhÃ¢n. Con ngÆ°á»i á»Ÿ má»©c nÃ y sá»‘ng theo nhá»¯ng nguyÃªn táº¯c rÃµ rá»‡t, Ä‘á» cao nghÄ©a vá»¥, Ä‘áº¡o Ä‘á»©c vÃ  cÃ´ng báº±ng, nhÆ°ng cÅ©ng dá»… rÆ¡i vÃ o tá»± phÃª bÃ¬nh quÃ¡ má»©c, cáº£m giÃ¡c tá»™i lá»—i hoáº·c kháº¯t khe vá»›i báº£n thÃ¢n vÃ  ngÆ°á»i khÃ¡c. Há» Ä‘áº·t lÃ½ tÆ°á»Ÿng lÃªn trÃªn lá»£i Ã­ch cÃ¡ nhÃ¢n, Ä‘Ã´i khi hy sinh nhu cáº§u tá»± nhiÃªn Ä‘á»ƒ giá»¯ vá»¯ng Ä‘iá»u há» cho lÃ  Ä‘Ãºng. ÄÃ¢y lÃ  má»©c Ä‘á»™ thá»ƒ hiá»‡n sá»± trong sÃ¡ng vÃ  chuáº©n má»±c cao, nhÆ°ng náº¿u khÃ´ng Ä‘Æ°á»£c cÃ¢n báº±ng báº±ng báº£n ngÃ£, nÃ³ cÃ³ thá»ƒ dáº«n Ä‘áº¿n cá»©ng nháº¯c hoáº·c Ã¡p lá»±c ná»™i tÃ¢m.\nLá»i khuyÃªn: hÃ£y nháº¹ nhÃ ng vá»›i chÃ­nh mÃ¬nh hÆ¡n â€“ sá»± hoÃ n háº£o khÃ´ng tá»“n táº¡i, táº­p cháº¥p nháº­n lá»—i sai nhÆ° má»™t pháº§n tá»± nhiÃªn cá»§a con ngÆ°á»i, táº¡o thá»i gian cho nhu cáº§u cÃ¡ nhÃ¢n: nghá»‰ ngÆ¡i, thÆ° giÃ£n, vui chÆ¡i.\nKhuyáº¿n nghá»‹: HÃ£y cho phÃ©p báº£n thÃ¢n Ä‘Æ°á»£c má»m máº¡i vÃ  Æ°u tiÃªn chÃ­nh mÃ¬nh nhiá»u hÆ¡n.\n______________________________________\nMá»—i con sá»‘ pháº£n Ã¡nh sá»± dá»‹ch chuyá»ƒn nÄƒng lÆ°á»£ng tÃ¢m lÃ½ giá»¯a Báº£n nÄƒng â€“ Báº£n ngÃ£ â€“ SiÃªu NgÃ£.\nDÃ¹ báº¡n náº±m á»Ÿ vÃ¹ng nÃ o, há»‡ thá»‘ng khÃ´ng phÃ¡n xÃ©t, mÃ  chá»‰ soi chiáº¿u tháº¿ giá»›i ná»™i tÃ¢m Ä‘á»ƒ báº¡n hiá»ƒu, Ä‘iá»u chá»‰nh vÃ  phÃ¡t triá»ƒn tá»‘t hÆ¡n.\n\n<strong>ğŸ“…â¡ï¸ğŸ§  THEO DÃ•I LÃ‚U DÃ€I & PHÃT TRIá»‚N NHÃ‚N CÃCH</strong>\nHá»‡ thá»‘ng Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ khÃ´ng chá»‰ Ä‘o lÆ°á»ng tá»©c thá»i mÃ  cÃ²n lÆ°u trá»¯ <strong>Nháº­t kÃ½ TÃ¢m lÃ½</strong> qua tá»«ng chu ká»³ 7 ngÃ y, giÃºp ngÆ°á»i dÃ¹ng vÃ  nhÃ  nghiÃªn cá»©u quan sÃ¡t sá»± biáº¿n chuyá»ƒn cá»§a ná»™i tÃ¢m theo thá»i gian:\n\n<strong>1. Quan sÃ¡t dá»¯ liá»‡u Ä‘á»‹nh lÆ°á»£ng (Sá»‘ liá»‡u & Xu hÆ°á»›ng):</strong>\nThÃ´ng qua <strong>Nháº­t kÃ½</strong>, ngÆ°á»i dÃ¹ng xem láº¡i Ä‘Æ°á»£c cÃ¡c chu ká»³ Ä‘Ã£ hoÃ n thÃ nh vá»›i cÃ¡c chá»‰ sá»‘ cá»¥ thá»ƒ:\n<strong>Äiá»ƒm trung bÃ¬nh:</strong> Con sá»‘ tá»•ng káº¿t chÃ­nh xÃ¡c nháº¥t xu hÆ°á»›ng tÃ¢m lÃ½ chá»§ Ä‘áº¡o cá»§a báº¡n trong suá»‘t 1 tuáº§n.\n\n<strong>MÃ u sáº¯c tÃ¢m lÃ½ (5 vÃ¹ng mÃ u):</strong> Nháº­n diá»‡n rÃµ rÃ ng báº£n thÃ¢n Ä‘ang thiÃªn vá» vÃ¹ng nÃ o:\nğŸŸ£ğŸ”´ Báº£n nÄƒng (TÃ­m/Äá» - NÄƒng lÆ°á»£ng thÃ´/Xung Ä‘á»™t)\nğŸŸ¢ CÃ¢n báº±ng (Xanh lÃ¡ - á»”n Ä‘á»‹nh/LÃ½ trÃ­)\nğŸ”µğŸŸ¡ SiÃªu ngÃ£ (Xanh dÆ°Æ¡ng/VÃ ng - Äáº¡o Ä‘á»©c/LÃ½ tÆ°á»Ÿng)\n\n<strong>Sá»± dá»‹ch chuyá»ƒn:</strong> So sÃ¡nh giá»¯a cÃ¡c chu ká»³ Ä‘á»ƒ tháº¥y sá»± tiáº¿n bá»™ (VÃ­ dá»¥: Tá»« mÃ u Äá» nÃ³ng náº£y chuyá»ƒn sang mÃ u Xanh lÃ¡ cÃ¢n báº±ng).\n\n<strong>2. Thá»±c hÃ nh pháº£n tÆ° sÃ¢u (Dá»¯ liá»‡u Ä‘á»‹nh tÃ­nh):</strong>\nSau má»—i chu ká»³, há»‡ thá»‘ng yÃªu cáº§u ngÆ°á»i dÃ¹ng Ä‘iá»n vÃ o phiáº¿u pháº£n tÆ° tÃ¢m lÃ½ gá»“m 3 cÃ¢u há»i cá»‘t lÃµi:\n<strong>Sá»± kiá»‡n:</strong> Äiá»u gÃ¬ Ä‘Ã¡ng nhá»› nháº¥t trong tuáº§n Ä‘Ã£ kÃ­ch hoáº¡t cáº£m xÃºc cá»§a báº¡n?\n<strong>Xung Ä‘á»™t ná»™i tÃ¢m:</strong> Cuá»™c Ä‘áº¥u tranh giá»¯a cÃ¡i "TÃ´i muá»‘n" (Báº£n nÄƒng) vÃ  cÃ¡i "TÃ´i nÃªn" (SiÃªu ngÃ£) diá»…n ra nhÆ° tháº¿ nÃ o vá»›i Ä‘iá»u Ä‘Ã³?\n<strong>BÃ i há»c:</strong> RÃºt ra kinh nghiá»‡m tá»« Ä‘iá»u Ä‘Ã³ Ä‘á»ƒ Ä‘iá»u chá»‰nh hÃ nh vi cho tuáº§n tiáº¿p theo.\n\n<strong>3. ÄÃ¡nh giÃ¡ hiá»‡u quáº£ cÃ´ng cá»¥:</strong>\nÄá»ƒ phá»¥c vá»¥ má»¥c Ä‘Ã­ch nghiÃªn cá»©u khoa há»c, ngÆ°á»i dÃ¹ng thá»±c hiá»‡n Ä‘Ã¡nh giÃ¡ khÃ¡ch quan cuá»‘i má»—i chu ká»³:\n<strong>Cháº¥m Ä‘iá»ƒm Sao (â­ï¸):</strong>ÄÃ¡nh giÃ¡ má»©c Ä‘á»™ hiá»‡u quáº£ cá»§a thÆ°á»›c trong viá»‡c giÃºp báº¡n: Hiá»ƒu báº£n thÃ¢n, Thay Ä‘á»•i hÃ nh vi vÃ  TÃ­nh dá»… sá»­ dá»¥ng.\n<strong>Biá»ƒu tÆ°á»£ng cáº£m xÃºc (Emoji):</strong> Äo lÆ°á»ng má»©c Ä‘á»™ hÃ i lÃ²ng vá» cáº£m xÃºc sau khi sá»­ dá»¥ng.\n\n<strong>4. Xuáº¥t bÃ¡o cÃ¡o dá»¯ liá»‡u:</strong>\nNgÆ°á»i dÃ¹ng cÃ³ thá»ƒ nháº¥n nÃºt <strong>"ğŸ“„ Xuáº¥t file Word"</strong> Ä‘á»ƒ táº£i vá» toÃ n bá»™ há»“ sÆ¡ tÃ¢m lÃ½.\nFile bÃ¡o cÃ¡o bao gá»“m: Nháº­t kÃ½ hÃ nh vi chi tiáº¿t + Äiá»ƒm trung bÃ¬nh + Ná»™i dung pháº£n tÆ° + Dá»¯ liá»‡u Ä‘Ã¡nh giÃ¡ theo 5 má»©c.\n\n<em><strong>ğŸ“ LÆ°u Ã½ quan trá»ng:</strong> ÄÃ¢y lÃ  nguá»“n cá»© liá»‡u thá»±c táº¿ quan trá»ng nháº¥t Ä‘á»ƒ tÃ¡c giáº£ Ä‘Æ°a vÃ o bÃ i bÃ¡o cÃ¡o nghiÃªn cá»©u tham gia cuá»™c thi KHKT cáº¥p ThÃ nh phá»‘, minh chá»©ng cho tÃ­nh hiá»‡u quáº£ vÃ  thá»±c tiá»…n cá»§a sáº£n pháº©m.</em>\n\n<strong>âš ï¸ Cáº¢NH BÃO & LÆ¯U Ã QUAN TRá»ŒNG</strong>\n<strong>1. KhÃ´ng pháº£i cÃ´ng cá»¥ cháº©n Ä‘oÃ¡n y táº¿ / tÃ¢m lÃ½ ğŸ§ªğŸš«</strong> \nThÆ°á»›c Ä‘Æ°á»£c thiáº¿t káº¿ dá»±a trÃªn thuyáº¿t PhÃ¢n tÃ¢m há»c - vá»‘n mang tÃ­nh triáº¿t há»c nhiá»u hÆ¡n khoa há»c hiá»‡n Ä‘áº¡i (chÆ°a Ä‘Æ°á»£c kiá»ƒm chá»©ng, thiáº¿u cÆ¡ sá»Ÿ khoa há»c, mang tÃ­nh chá»§ quan cao, thiáº¿u tÃ­nh phá»• quÃ¡t), chá»‰ Ä‘Ã³ng vai trÃ² lÃ  cÃ´ng cá»¥ giÃ¡o dá»¥c tá»± pháº£n tÆ° báº£n thÃ¢n vá» nhá»¯ng xung Ä‘á»™t trong váº¥n Ä‘á» lá»£i Ã­ch, khÃ´ng pháº£i thiáº¿t bá»‹ cháº©n Ä‘oÃ¡n chÃ­nh xÃ¡c tuyá»‡t Ä‘á»‘i tÃ¢m lÃ½ con ngÆ°á»i. TÃ¢m lÃ½ con ngÆ°á»i vÃ´ cÃ¹ng phá»©c táº¡p: má»—i cÃ¡ thá»ƒ lÃ  duy nháº¥t, vÃ  khÃ´ng cÃ³ phÃ¢n loáº¡i â€œtá»‘tâ€ hay â€œxáº¥uâ€ má»™t cÃ¡ch tuyá»‡t Ä‘á»‘i. TÃ¢m lÃ½ chá»‹u áº£nh hÆ°á»Ÿng Ä‘á»“ng thá»i tá»« di truyá»n, cÃ¡c cháº¥t hoÃ¡ há»c vÃ  cháº¥t dáº«n truyá»n tháº§n kinh trong nÃ£o, mÃ´i trÆ°á»ng sá»‘ng, giÃ¡o dá»¥c, chuáº©n má»±c xÃ£ há»™i, má»©c Ä‘á»™ tá»± chá»§, xung Ä‘á»™t ná»™i tÃ¢m, cÆ¡ cháº¿ phÃ²ng vá»‡, trÆ°á»Ÿng thÃ nh tÃ¢m lÃ½, bá»‘i cáº£nh xÃ£ há»™i, lá»‹ch sá»­ cÃ¡ nhÃ¢n,... chá»© khÃ´ng chá»‰ Ä‘Æ¡n giáº£n lÃ  Báº£n nÄƒng, Báº£n ngÃ£ vÃ  SiÃªu ngÃ£.\n\nKhÃ´ng dÃ¹ng káº¿t quáº£ Ä‘á»ƒ thay tháº¿ cháº©n Ä‘oÃ¡n, tÆ° váº¥n hay trá»‹ liá»‡u chuyÃªn mÃ´n (bÃ¡c sÄ©, nhÃ  tÃ¢m lÃ½, bÃ¡c sÄ© tÃ¢m tháº§n). \n\nNáº¿u báº¡n hoáº·c ngÆ°á»i thÃ¢n cÃ³ dáº¥u hiá»‡u nghiÃªm trá»ng (tá»± háº¡i, Ã½ Ä‘á»‹nh gÃ¢y háº¡i ngÆ°á»i khÃ¡c, hoang tÆ°á»Ÿng, máº¥t liÃªn há»‡ vá»›i thá»±c táº¡i), ngay láº­p tá»©c dá»«ng sá»­ dá»¥ng thÆ°á»›c vÃ  tÃ¬m trá»£ giÃºp chuyÃªn nghiá»‡p. \n\n<strong>2. Trung thá»±c khi sá»­ dá»¥ng â€” yáº¿u tá»‘ then chá»‘t ğŸ”ğŸ§­</strong> \nKáº¿t quáº£ mang tÃ­nh chá»§ quan cao, phá»¥ thuá»™c hoÃ n toÃ n vÃ o cÃ¡ch báº¡n kÃ©o gáº¡t vÃ  cÃ¡ch báº¡n tá»± Ä‘Ã¡nh giÃ¡ theo 3 nguyÃªn táº¯c. \nTrung thá»±c tuyá»‡t Ä‘á»‘i vá»›i chÃ­nh mÃ¬nh khi tráº£ lá»i (Ä‘á»™ng cÆ¡, khÃ¡ch quan, Ä‘á»“ng cáº£m) lÃ  Ä‘iá»u cáº§n thiáº¿t. \nNáº¿u cá»‘ tÃ¬nh thao tÃ¡c khÃ´ng tháº­t (Ä‘á»ƒ "Ä‘Æ°á»£c Ä‘iá»ƒm" hoáº·c Ä‘á»ƒ kiá»ƒm tra thiáº¿t bá»‹), káº¿t quáº£ sáº½ máº¥t Ã½ nghÄ©a vÃ  cÃ³ thá»ƒ dáº«n Ä‘áº¿n hiá»ƒu sai vá» báº£n thÃ¢n. \n\n<strong>3. Äiá»ƒm sá»‘ khÃ´ng báº±ng nhÃ¢n cÃ¡ch con ngÆ°á»i ğŸ«¶ </strong>\nMá»™t hay nhiá»u láº§n Ä‘iá»ƒm Ã¢m/dÆ°Æ¡ng khÃ´ng biáº¿n báº¡n thÃ nh â€œxáº¥uâ€ hay â€œthÃ¡nh thiá»‡nâ€. \nÄiá»ƒm chá»‰ nÃ³i lÃªn xu hÆ°á»›ng má»™t cÃ¡ch tÆ°Æ¡ng Ä‘á»‘i sau 7 ngÃ y tá»•ng káº¿t, khÃ´ng Ä‘Ã¡nh giÃ¡ giÃ¡ trá»‹ con ngÆ°á»i. \nHÃ£y Ä‘á»c Ä‘iá»ƒm nhÆ° chá»‰ sá»‘ tham kháº£o â€” báº¯t Ä‘áº§u cuá»™c Ä‘á»‘i thoáº¡i vá»›i chÃ­nh mÃ¬nh, khÃ´ng tá»± buá»™c tá»™i. \n\n<strong>4. KhÃ´ng dÃ¹ng thÆ°á»›c Ä‘á»ƒ phÃ¡n xÃ©t ngÆ°á»i khÃ¡c hoáº·c lÃ m báº±ng chá»©ng phÃ¡p lÃ½ âš–ï¸âœ‹</strong> \nTuyá»‡t Ä‘á»‘i khÃ´ng dÃ¹ng thÆ°á»›c lÃ m cÃ´ng cá»¥ Ä‘Ã¡nh giÃ¡, káº¿t luáº­n, xÃºc pháº¡m hoáº·c xá»­ lÃ½ ngÆ°á»i khÃ¡c (gia Ä‘Ã¬nh, Ä‘á»“ng nghiá»‡p, há»c sinhâ€¦). \nKhÃ´ng dÃ¹ng káº¿t quáº£ lÃ m báº±ng chá»©ng trong cÃ¡c tranh cháº¥p, tá»‘ tá»¥ng, quyáº¿t Ä‘á»‹nh tuyá»ƒn chá»n, sa tháº£i, ká»· luáº­t hoáº·c cÃ¡c váº¥n Ä‘á» phÃ¡p lÃ½. \n\n<strong>5. TrÃ¡nh dÃ¹ng trong tráº¡ng thÃ¡i cáº£m xÃºc cá»±c Ä‘á»™ hoáº·c máº¥t kiá»ƒm soÃ¡t ğŸŒ€</strong> \nKhÃ´ng dÃ¹ng khi: say rÆ°á»£u, bá»‹ kÃ­ch Ä‘á»™ng máº¡nh, hoáº£ng loáº¡n, Ä‘ang trong cÆ¡n khá»§ng hoáº£ng, máº¥t ngá»§ náº·ng, dÃ¹ng cháº¥t kÃ­ch thÃ­ch... \nNhá»¯ng tráº¡ng thÃ¡i nÃ y lÃ m mÃ©o mÃ³ nháº­n thá»©c â†’ káº¿t quáº£ sai lá»‡ch, Ä‘Ã´i khi gÃ¢y háº­u quáº£ cáº£m xÃºc xáº¥u cho báº¡n. \n\n<strong>6. NhÃ³m ngÆ°á»i khÃ´ng phÃ¹ há»£p hoáº·c cáº§n tháº­n trá»ng Ä‘áº·c biá»‡t âš ï¸</strong> \nNgÆ°á»i cÃ³ rá»‘i loáº¡n tháº§n kinh náº·ng, rá»‘i loáº¡n nhÃ¢n cÃ¡ch náº·ng, rá»‘i loáº¡n tÃ¢m tháº§n, áº£o giÃ¡c, Ä‘á»™ng kinh cáº§n khÃ´ng dÃ¹ng thÆ°á»›c Ä‘á»ƒ tá»± Ä‘Ã¡nh giÃ¡. \nTráº» em dÆ°á»›i Ä‘á»™ tuá»•i trÆ°á»Ÿng thÃ nh: chá»‰ dÃ¹ng dÆ°á»›i sá»± giÃ¡m sÃ¡t vÃ  giáº£i thÃ­ch cá»§a ngÆ°á»i lá»›n/giÃ¡o viÃªn/chuyÃªn gia. \nNgÆ°á»i Ä‘ang trong quÃ¡ trÃ¬nh Ä‘iá»u trá»‹ tÃ¢m lÃ½/thuá»‘c cáº§n há»i Ã½ kiáº¿n chuyÃªn gia trÆ°á»›c khi dÃ¹ng. \n\n<strong>7. Nguy cÆ¡ lá»‡ thuá»™c & tá»± phÃ¡n xÃ©t â€” dÃ¹ng thÆ°á»›c cÃ³ trÃ¡ch nhiá»‡m ğŸ§­ </strong>\nKhÃ´ng nÃªn dÃ¹ng thÆ°á»›c lÃ m bÃ¡o cÃ¡o giÃ¡ trá»‹ báº£n thÃ¢n hÃ ng ngÃ y; náº¿u láº¡m dá»¥ng sáº½ táº¡o thÃ³i quen so sÃ¡nh vÃ  lá»‡ thuá»™c vÃ o chá»‰ sá»‘. \nTrÃ¡nh chuyá»ƒn viá»‡c â€œlÃ m tá»‘t/khÃ´ng tá»‘tâ€ thÃ nh Ã¡p lá»±c: con ngÆ°á»i phÃ¡t triá»ƒn báº±ng táº­p luyá»‡n & bá»‘i cáº£nh, khÃ´ng pháº£i chá»‰ sá»‘. \n\n<strong>8. Quyá»n riÃªng tÆ° & dá»¯ liá»‡u cÃ¡ nhÃ¢n ğŸ”</strong> \nCáº§n minh báº¡ch vá» viá»‡c lÆ°u trá»¯, ai cÃ³ thá»ƒ truy cáº­p, thá»i gian lÆ°u vÃ  xÃ³a dá»¯ liá»‡u qua file Word. \nKhÃ´ng chia sáº» káº¿t quáº£ vá»›i ngÆ°á»i khÃ¡c náº¿u báº¡n chÆ°a sáºµn sÃ ng hoáº·c chÆ°a thÃ´ng bÃ¡o rÃµ má»¥c Ä‘Ã­ch. \n\n<strong>9. CÃ¡ch pháº£n á»©ng khi káº¿t quáº£ cáº£nh bÃ¡o (Ä‘á»/cam) </strong>ğŸš¨ \nÄá»«ng hoáº£ng loáº¡n â€” coi Ä‘Ã³ lÃ  tÃ­n hiá»‡u Ä‘á»ƒ dá»«ng, suy nghÄ© vÃ  hÃ nh Ä‘á»™ng cÃ³ trÃ¡ch nhiá»‡m. \nLÃ m ngay: dá»«ng hÃ nh Ä‘á»™ng, hÃ­t thá»Ÿ, ghi nháº­t kÃ½ ngáº¯n, tÃ¬m ngÆ°á»i tin cáº­y Ä‘á»ƒ trÃ² chuyá»‡n. \nNáº¿u káº¿t quáº£ láº·p láº¡i liÃªn tá»¥c vÃ  báº¡n cáº£m tháº¥y khÃ³ kiá»ƒm soÃ¡t hÃ nh vi â†’ tÃ¬m chuyÃªn gia tÃ¢m lÃ½ Ä‘á»ƒ Ä‘Æ°á»£c há»— trá»£. \n\n<strong>10. LÆ°u Ã½ vÄƒn hÃ³a & bá»‘i cáº£nh xÃ£ há»™i ğŸŒ </strong>\nHÃ nh vi Ä‘Æ°á»£c Ä‘Ã¡nh giÃ¡ khÃ¡c nhau theo vÄƒn hÃ³a, luáº­t phÃ¡p vÃ  bá»‘i cáº£nh. \nKhi di chuyá»ƒn giá»¯a ná»n vÄƒn hÃ³a hoáº·c sá»‘ng á»Ÿ nÆ°á»›c khÃ¡c, khÃ´ng dÃ¹ng thÆ°á»›c nhÆ° má»™t tiÃªu chuáº©n tuyá»‡t Ä‘á»‘i mÃ  cáº§n tham kháº£o vÄƒn hoÃ¡/luáº­t Ä‘á»‹a phÆ°Æ¡ng. \n\n<strong>11. Khi nÃ o cáº§n tÃ¬m giÃºp Ä‘á»¡ chuyÃªn nghiá»‡p â˜ï¸</strong> \nBáº¡n cÃ³ xu hÆ°á»›ng tá»± lÃ m háº¡i hoáº·c nghÄ© ngÆ°á»i khÃ¡c sáº½ bá»‹ tá»•n thÆ°Æ¡ng. \nKáº¿t quáº£ thÆ°á»›c gÃ¢y cáº£m xÃºc tiÃªu cá»±c kÃ©o dÃ i (suy sá»¥p, tráº§m cáº£m). \nMáº¥t kháº£ nÄƒng lÃ m viá»‡c, há»c táº­p hoáº·c duy trÃ¬ cÃ¡c má»‘i quan há»‡ vÃ¬ hÃ nh vi. \nâ†’ LiÃªn há»‡ bÃ¡c sÄ© tÃ¢m tháº§n / nhÃ  trá»‹ liá»‡u / Ä‘Æ°á»ng dÃ¢y nÃ³ng kháº©n cáº¥p. \n\n<strong>ğŸ’¬ Lá»œI NHáº®C CUá»I</strong> \n> â€œThÆ°á»›c khÃ´ng dÃ¹ng Ä‘á»ƒ phÃ¡n xÃ©t â€“ mÃ  Ä‘á»ƒ pháº£n tÆ°.â€ \nHÃ£y dÃ¹ng nÃ³ nhÆ° gÆ°Æ¡ng soi ná»™i tÃ¢m Ä‘á»ƒ sá»‘ng tá»‰nh thá»©c hÆ¡n má»—i ngÃ y.'
;

helpBtn.onclick = () => {
  document.getElementById('helpText').innerHTML = helpContent;
  document.getElementById('helpModal').style.display = 'block';
};


document.getElementById('closeHelp').onclick = () => {
  document.getElementById('helpModal').style.display = 'none';
};

initSlider();
setInterval(updateCountdown,200);
updateCountdown();


function revertSlider() {
  placeSliderAtValue(0);
}
document.getElementById('revBtn').onclick = revertSlider;
function formatFullTime(ts) {
  const d = new Date(ts);
  return d.toLocaleString('vi-VN', { hour12: false }); 
}

// DIá»„N GIáº¢I NHANH CHO Má»¨C Tá»ªNG GIÃ TRá»Š (dÃ¹ng á»Ÿ má»™t sá»‘ chá»— hiá»ƒn thá»‹)
function interpretLevel(v) {
  const cat = getCategoryFromValue(v);
  return "â†’ " + cat.label + " " + cat.emoji;
}

function formatDateTime(ts) {
    const d = new Date(ts);
    const date = d.toLocaleDateString('vi-VN');
    const time = d.toLocaleTimeString('vi-VN', { hour12: false });
    return { date, time };
}

// Diá»…n giáº£i Ä‘iá»ƒm trung bÃ¬nh (5 má»©c)
function interpretScore(avg) {
    if (avg <= -6667) return "âš ï¸Báº£n nÄƒng máº¡nh ğŸ˜ˆğŸ’¥";
    if (avg <= -3334) return "Báº£n nÄƒng vá»«a ğŸ˜‹ğŸ˜¤ğŸ”¥";
    if (avg >= 6667)  return "âš ï¸SiÃªu ngÃ£ máº¡nh ğŸ˜‡ğŸ¤";
    if (avg >= 3334)  return "SiÃªu ngÃ£ vá»«a âœ¨ğŸ‘¼ğŸ•Šï¸";
    return "Báº£n ngÃ£ cÃ¢n báº±ng âš–ï¸ğŸ‘¤âœ…";
}

// --- HELPER: Render Sao (Widget) ---
function renderStarWidget(idx, type, val) {
    let h = `<div class="stars" id="stars-${idx}-${type}">`;
    for(let i=1; i<=5; i++) {
        let cls = i <= val ? 'active' : '';
        h += `<span class="star ${cls}" onclick="setRating(${idx}, '${type}', ${i})">â˜…</span>`;
    }
    h += `</div>`;
    return h;
}

// ============================================================
// KHU Vá»°C Xá»¬ LÃ NHáº¬T KÃ & LÆ¯U TRá»® (ÄÃƒ Sá»¬A Lá»–I & Tá»I Æ¯U)
// ============================================================

// 1. KHAI BÃO BIáº¾N TOÃ€N Cá»¤C (Äá»ƒ trÃ¡nh lá»—i khÃ´ng tÃ¬m tháº¥y biáº¿n)
window.tempRatings = {}; 
window.tempEmojis = {};

// 2. HÃ€M SET RATING (SAO)
window.setRating = function(cIdx, type, val) {
    if(!window.tempRatings[cIdx]) window.tempRatings[cIdx] = {};
    window.tempRatings[cIdx][type] = val;
    
    // Update UI ngay láº­p tá»©c
    const box = document.getElementById(`stars-${cIdx}-${type}`);
    if(box) {
        const stars = box.querySelectorAll('.star');
        stars.forEach((s, i) => {
            if(i < val) s.classList.add('active');
            else s.classList.remove('active');
        });
    }
};

// 3. HÃ€M SET EMOJI
window.setEmoji = function(cIdx, type, val) {
    if (!window.tempEmojis[cIdx]) window.tempEmojis[cIdx] = {};
    window.tempEmojis[cIdx][type] = val;

    // Cáº­p nháº­t giao diá»‡n
    const container = document.getElementById(`emoji-${cIdx}-${type}`);
    if (container) {
        const btns = container.querySelectorAll('.emoji-btn');
        btns.forEach((btn, i) => {
            if (i + 1 === val) btn.classList.add('selected');
            else btn.classList.remove('selected');
        });
    }
};

// --- HELPER: Render Sao (Widget) ---
function renderStarWidget(idx, type, val) {
    let h = `<div class="stars" id="stars-${idx}-${type}">`;
    for(let i=1; i<=5; i++) {
        let cls = i <= val ? 'active' : '';
        h += `<span class="star ${cls}" onclick="window.setRating(${idx}, '${type}', ${i})">â˜…</span>`;
    }
    h += `</div>`;
    return h;
}

// --- HELPER: Render Sao (Káº¿t quáº£ tÄ©nh) ---
function renderStarStatic(val) {
    let s = "";
    for(let i=1; i<=5; i++) s += (i<=val ? "â˜…" : "â˜†");
    return `<span style="color:#f1c40f; font-size:16px;">${s}</span> <small>(${val}/5)</small>`;
}

// --- HELPER: Render Emoji Widget ---
const EMOJI_SCALE = ['ğŸ˜¡', 'â˜¹ï¸', 'ğŸ˜', 'ğŸ™‚', 'ğŸ˜'];
const EMOJI_LABELS = ['Ráº¥t khÃ´ng hÃ i lÃ²ng', 'KhÃ´ng hÃ i lÃ²ng', 'BÃ¬nh thÆ°á»ng', 'HÃ i lÃ²ng', 'Ráº¥t hÃ i lÃ²ng'];

function renderEmojiWidget(idx, type, currentVal) {
    let html = `<div class="emoji-group" id="emoji-${idx}-${type}">`;
    EMOJI_SCALE.forEach((icon, i) => {
        const val = i + 1;
        const isSelected = val === currentVal ? 'selected' : '';
        html += `<span class="emoji-btn ${isSelected}" title="${EMOJI_LABELS[i]}" onclick="window.setEmoji(${idx}, '${type}', ${val})">${icon}</span>`;
    });
    html += `</div>`;
    return html;
}

function renderEmojiResult(val) {
    if (!val || val < 1) return "ChÆ°a Ä‘Ã¡nh giÃ¡";
    const icon = EMOJI_SCALE[val - 1];
    const text = EMOJI_LABELS[val - 1];
    return `<span class="emoji-result">${icon} ${text}</span>`;
}


// 4. HÃ€M LÆ¯U Dá»® LIá»†U (QUAN TRá»ŒNG: CÃ“ TRY-CATCH Äá»‚ BÃO Lá»–I)
window.saveFeedback = function(index) {
    console.log("Äang cá»‘ gáº¯ng lÆ°u dá»¯ liá»‡u cho index:", index); // Debug

    try {
        // Láº¥y cÃ¡c pháº§n tá»­ DOM
        const q1El = document.getElementById(`q1-${index}`);
        const q2El = document.getElementById(`q2-${index}`);
        const q3El = document.getElementById(`q3-${index}`);

        // Kiá»ƒm tra xem pháº§n tá»­ cÃ³ tá»“n táº¡i khÃ´ng (TrÃ¡nh lá»—i null)
        if (!q1El || !q2El || !q3El) {
            alert(`Lá»—i há»‡ thá»‘ng: KhÃ´ng tÃ¬m tháº¥y Ã´ nháº­p liá»‡u (ID: q1-${index}). Vui lÃ²ng Ä‘Ã³ng Nháº­t kÃ½ vÃ  má»Ÿ láº¡i.`);
            return;
        }

        const q1 = q1El.value.trim();
        const q2 = q2El.value.trim();
        const q3 = q3El.value.trim();
        
        // Láº¥y dá»¯ liá»‡u Ä‘iá»ƒm Ä‘Ã¡nh giÃ¡ tá»« biáº¿n táº¡m
        const rt = window.tempRatings[index] || {};
        const em = window.tempEmojis[index] || {};

        // --- VALIDATION (KIá»‚M TRA Dá»® LIá»†U) ---
        if(!rt.r1 || !rt.r2 || !rt.r3) {
            alert("âš ï¸ Vui lÃ²ng cháº¥m Ä‘iá»ƒm SAO (â­) cho cáº£ 3 tiÃªu chÃ­ Ä‘Ã¡nh giÃ¡.");
            return;
        }

        if(!em.satResult || !em.satTool) {
            alert("âš ï¸ Vui lÃ²ng chá»n biá»ƒu tÆ°á»£ng cáº£m xÃºc (Emoji) Ä‘á»ƒ Ä‘Ã¡nh giÃ¡ má»©c Ä‘á»™ hÃ i lÃ²ng.");
            return;
        }
        
        if(!q1 || !q2 || !q3) {
            alert("âš ï¸ Vui lÃ²ng viáº¿t Ä‘áº§y Ä‘á»§ ná»™i dung cho cáº£ 3 cÃ¢u há»i pháº£n tÆ°.");
            return;
        }

        // --- LÆ¯U VÃ€O STATE ---
        // Äáº£m báº£o máº£ng finishedCycles tá»“n táº¡i
        if (!state.finishedCycles || !state.finishedCycles[index]) {
            alert("Lá»—i dá»¯ liá»‡u: Chu ká»³ khÃ´ng tá»“n táº¡i trong bá»™ nhá»›.");
            return;
        }

        state.finishedCycles[index].feedback = {
            q1, q2, q3,
            r1: rt.r1, r2: rt.r2, r3: rt.r3,
            satResult: em.satResult, 
            satTool: em.satTool      
        };
        
        // LÆ°u xuá»‘ng LocalStorage
        saveFinishedCycles(state.finishedCycles);
        
        // PhÃ¡t Ã¢m thanh thÃ nh cÃ´ng (náº¿u cÃ³)
        if(document.getElementById('sndGreen')) {
            document.getElementById('sndGreen').play().catch(()=>{});
        }

        alert("âœ… ÄÃ£ lÆ°u thÃ nh cÃ´ng vÃ o Nháº­t kÃ½!");
        
        // Táº£i láº¡i giao diá»‡n Ä‘á»ƒ hiá»ƒn thá»‹ tráº¡ng thÃ¡i "ÄÃ£ lÆ°u"
        showReview(); 

    } catch (e) {
        console.error("Lá»—i khi lÆ°u:", e);
        alert("âŒ CÃ³ lá»—i xáº£y ra khi lÆ°u: " + e.message);
    }
};

// ==========================================================
// HÃ€M HIá»‚N THá»Š REVIEW (ÄÃƒ Sá»¬A Lá»–I INDEX Lá»†CH PHA)
// ==========================================================
window.showReview = function() {
    state.finishedCycles = loadFinishedCycles() || [];
    
    // Reset biáº¿n táº¡m má»—i láº§n má»Ÿ
    window.tempRatings = {}; 
    window.tempEmojis = {};
    
    const box = document.getElementById('reviewContent');
    document.getElementById('reviewModal').style.display = 'block';

    let html = '';

    // 1. HEADER: CHU Ká»² ÄANG CHáº Y (Giá»¯ nguyÃªn)
    if (state.status === 'running') {
        const entries = state.entries || [];
        const count = entries.length;
        const sum = entries.reduce((a,b)=>a+(Number(b.value)||0),0);
        const currentCycleNumber = (state.finishedCycles || []).length + 1;

        html += `<div style="background:#e3f2fd; padding:12px; border-radius:8px; margin-bottom:20px; border:1px dashed #2196f3; color:#0d47a1;">
            <h3 style="margin:0 0 5px 0;">â³ Chu ká»³ ${currentCycleNumber} Äang diá»…n ra</h3>
            <div style="font-size:14px;">
                Báº¯t Ä‘áº§u: <b>${state.startTimestamp ? formatDateTime(state.startTimestamp).time + ' ' + formatDateTime(state.startTimestamp).date : 'N/A'}</b><br>
                Tá»•ng Ä‘iá»ƒm hiá»‡n táº¡i: <b>${sum>0?'+':''}${sum}</b> | Sá»‘ láº§n gáº¡t hiá»‡n táº¡i: <b>${count}</b> 
            </div>
        </div>`;
    }

    html += `<h3 style="color:#004080; border-bottom:2px solid #eee; padding-bottom:8px;">ğŸ“œ Nháº­t kÃ½ TÃ¢m lÃ½</h3>`;

    if (!state.finishedCycles || state.finishedCycles.length === 0) {
        if (state.status !== 'running') {
            html += `<p style='text-align:center; color:#777; padding: 20px 0;'>ChÆ°a cÃ³ dá»¯ liá»‡u nÃ o.</p>`;
        }
        box.innerHTML = html;
        return;
    }

    // 2. Báº¢NG Tá»”NG Káº¾T (SUMMARY TABLE)
    // Sá»­a láº¡i logic duyá»‡t máº£ng Ä‘á»ƒ Ä‘á»“ng bá»™ vá»›i pháº§n dÆ°á»›i
    let summaryHtml = `
        <div style="display:flex; align-items:center; gap:10px; margin-bottom:15px; padding-left: 5px;">
            <h4 style="color:#4a148c; margin:0; font-size: 16px; font-weight: 700; letter-spacing: 0.5px; text-transform: uppercase; border-left: 4px solid #7b1fa2; padding-left: 10px;">ğŸ““ Tá»”NG Káº¾T Lá»ŠCH Sá»¬</h4>
        </div>
        <div style="overflow-x:auto; box-shadow: 0 8px 20px rgba(123, 31, 162, 0.15); background: #ffffff; border: 1px solid #e1bee7;">
        <table style="width:100%; min-width:600px; border-collapse:collapse; font-family: system-ui, -apple-system, sans-serif;">
            <thead>
                <tr style="background: linear-gradient(135deg, #4a148c 0%, #7b1fa2 100%); color:#ffffff;">
                    <th style="padding:14px 10px; text-align:center; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">Chu ká»³</th>
                    <th style="padding:14px 10px; text-align:center; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">Äiá»ƒm TB</th>
                    <th style="padding:14px 10px; text-align:center; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">Tá»•ng Ä‘iá»ƒm</th>
		    <th style="padding:14px 10px; text-align:center; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">Sá»‘ láº§n gáº¡t</th>
                    <th style="padding:14px 10px; text-align:center; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">Thá»i gian</th>
                </tr>
            </thead>
            <tbody>
    `;

    // Táº¡o cÃ¡c dÃ²ng cho báº£ng (Map -> Reverse -> Join) Ä‘á»ƒ Ä‘áº£m báº£o thá»© tá»± cÅ© nháº¥t á»Ÿ dÆ°á»›i cÃ¹ng hoáº·c trÃªn cÃ¹ng tuá»³ Ã½
    // á» Ä‘Ã¢y ta muá»‘n hiá»ƒn thá»‹ danh sÃ¡ch: Chu ká»³ 1 (CÅ©) -> Chu ká»³ N (Má»›i) trong báº£ng
    const tableRows = state.finishedCycles.map((cycle, realIndex) => {
        // realIndex chÃ­nh lÃ  chá»‰ má»¥c thá»±c trong máº£ng state.finishedCycles
        // VÃ¬ unshift (má»›i nháº¥t index 0), nÃªn sá»‘ thá»© tá»± Chu ká»³ = Tá»•ng sá»‘ - Index hiá»‡n táº¡i
        const cycleNum = state.finishedCycles.length - realIndex; 
        
        const avgScore = cycle.avgScore;
        const totalScore = cycle.totalScore || cycle.entries.reduce((a,b)=>a+(Number(b.value)||0),0);
        const startObj = formatDateTime(cycle.startTime);

        let scoreColor = '#2ecc71'; 
        let icon = 'ğŸ‘¤';
        if (avgScore <= -6667) { scoreColor = '#8e44ad'; icon = 'ğŸ˜ˆ'; }
        else if (avgScore <= -3334) { scoreColor = '#e74c3c'; icon = 'ğŸ”¥'; }
        else if (avgScore >= 6667) { scoreColor = '#FFD700'; icon = 'ğŸ˜‡'; }
        else if (avgScore >= 3334) { scoreColor = '#2980b9'; icon = 'ğŸ•Šï¸'; }

        return `
            <tr style="background-color:${cycleNum % 2 === 0 ? '#f9f9f9' : '#ffffff'};">
                <td style="padding:8px; border:1px solid #ddd; text-align:center; font-weight:bold;">${cycleNum}</td>
                <td style="padding:8px; border:1px solid #ddd; text-align:center; font-weight:bold; color:${scoreColor};">
                    ${icon} ${avgScore > 0 ? '+' : ''}${avgScore.toFixed(1)}
                </td>
                <td style="padding:8px; border:1px solid #ddd; text-align:center;">${totalScore > 0 ? '+' : ''}${totalScore}</td>
		<td style="padding:8px; border:1px solid #ddd; text-align:center;">${cycle.entries.length}</td>
                <td style="padding:8px; border:1px solid #ddd; text-align:center; font-size:12px;">${startObj.time} ${startObj.date}</td>
            </tr>
        `;
    });

    // Äáº£o ngÆ°á»£c máº£ng rows Ä‘á»ƒ hiá»ƒn thá»‹ Chu ká»³ 1 lÃªn Ä‘áº§u báº£ng (hoáº·c bá» .reverse() náº¿u muá»‘n má»›i nháº¥t lÃªn Ä‘áº§u)
    summaryHtml += tableRows.reverse().join(''); 
    
    summaryHtml += `</tbody></table></div><hr style="border:0; border-top:1px dashed #ccc; margin:20px 0;">`;
    html += summaryHtml;

    // 3. DANH SÃCH CHI TIáº¾T (QUAN TRá»ŒNG: Sá»¬A Lá»–I LOGIC á» ÄÃ‚Y)
    // Thay vÃ¬ dÃ¹ng .reverse().forEach vÃ  tÃ­nh toÃ¡n index phá»©c táº¡p, ta dÃ¹ng .map() trá»±c tiáº¿p
    // realIndex sáº½ luÃ´n luÃ´n Ä‘Ãºng vá»›i vá»‹ trÃ­ trong máº£ng state.finishedCycles
    
    const cardHtmlList = state.finishedCycles.map((cycle, realIndex) => {
        const cycleNum = state.finishedCycles.length - realIndex;
        const startObj = formatDateTime(cycle.startTime);
        const fb = cycle.feedback || {};
        const isDone = (fb.r1 > 0); 

        // Logic mÃ u sáº¯c
        const v = cycle.avgScore;
        let scoreClass = 'color-green';
        let iconTrend = 'ğŸ‘¤';
        if (v <= -6667) { scoreClass = 'color-purple'; iconTrend = 'ğŸ˜ˆ'; }
        else if (v <= -3334) { scoreClass = 'color-red'; iconTrend = 'ğŸ”¥'; }
        else if (v >= 6667) { scoreClass = 'color-amber'; iconTrend = 'ğŸ˜‡'; }
        else if (v >= 3334) { scoreClass = 'color-blue'; iconTrend = 'ğŸ•Šï¸'; }

        let card = `<div class="cycle-card ${scoreClass}">`;
        
        // Header Card
        card += `<div class="card-header">
            <div class="header-left">
                <strong>Chu ká»³ ${cycleNum}</strong> <span style="font-size:13px; color:#777;"><span class="neutral-text">(tá»« ${startObj.time} ${startObj.date})</span></span>
            </div>
            <div class="header-right ${scoreClass}">
                ${iconTrend} ${cycle.avgScore > 0 ? '+' : ''}${cycle.avgScore.toFixed(1)}
            </div>
           </div>`;

        // Table Logs
        card += `<div class="log-container"><table class="log-table">
                    <thead><tr><th>Thá»i gian</th><th>Äiá»ƒm</th><th>Khuynh hÆ°á»›ng</th></tr></thead>
                    <tbody>`;
        
        const entries = cycle.entries || [];
        if(entries.length === 0) {
            card += `<tr><td colspan="3" style="text-align:center; padding:10px;">KhÃ´ng cÃ³ dá»¯ liá»‡u</td></tr>`;
        } else {
            entries.forEach(e => {
               const val = Number(e.value||0);
               const info = getCategoryFromValue(val);
               let pColor = '#2ecc71';
               if (val <= -6667) pColor = '#8e44ad';
               else if (val <= -3334) pColor = '#e74c3c';
               else if (val >= 6667) pColor = '#FFD700';
               else if (val >= 3334) pColor = '#2980b9';

               const tStr = e.time || (e.ts ? formatDateTime(e.ts).time : '');
               const dStr = e.date || (e.ts ? formatDateTime(e.ts).date : '');

               card += `<tr>
                    <td><strong>${tStr}</strong><br><span style="font-size:11px; color:#888;">${dStr}</span></td>
                    <td style="font-weight:bold; color:${pColor}">${val>0?'+':''}${val}</td>
                    <td>${info.emoji} ${info.label}</td>
                </tr>`;
            });
        }
        card += `</tbody></table></div>`;

        // Pháº§n Pháº£n tÆ°
        card += `<div class="feedback-area">`;
        if (isDone) {
            // ÄÃƒ LÆ¯U
            card += `<div class="saved-data">
                <div style="margin-bottom:8px; border-bottom:1px solid #c3e6cb; padding-bottom:5px;">âœ… <b>Dá»¯ liá»‡u Ä‘Ã£ lÆ°u</b></div>
                <div class="saved-item"><span class="saved-label">ğŸ“ Sá»± kiá»‡n Ä‘Ã¡ng nhá»› nháº¥t:</span> ${fb.q1}</div>
                <div class="saved-item"><span class="saved-label">âš”ï¸ Xung Ä‘á»™t ná»™i tÃ¢m:</span> ${fb.q2}</div>
                <div class="saved-item"><span class="saved-label">ğŸ’¡ BÃ i há»c:</span> ${fb.q3}</div>
                <hr style="border-top:1px dashed #abc; margin:10px 0;">
                <div class="saved-item">ğŸ“± Giao diá»‡n dá»… dÃ¹ng: ${renderStarStatic(fb.r1)}</div>
                <div class="saved-item">ğŸ§  GiÃºp hiá»ƒu báº£n thÃ¢n: ${renderStarStatic(fb.r2)}</div>
                <div class="saved-item">ğŸ¦‹ GiÃºp thay Ä‘á»•i hÃ nh vi: ${renderStarStatic(fb.r3)}</div>
                <div style="margin-top:6px; padding-top:6px; border-top:1px dotted #c3e6cb">
                    <div class="saved-item">ğŸ˜Š HÃ i lÃ²ng káº¿t quáº£: ${renderEmojiResult(fb.satResult)}</div>
                    <div class="saved-item">ğŸ“ HÃ i lÃ²ng cÃ¢y thÆ°á»›c: ${renderEmojiResult(fb.satTool)}</div>
                </div>
            </div>`;
        } else {
            // CHÆ¯A LÆ¯U -> HIá»†N FORM Vá»šI ID CHUáº¨N XÃC
            card += `<div style="margin-bottom:10px; color:#004080; font-weight:bold; display:flex; align-items:center; gap:6px;">
                        <span style="font-size:18px;">âœï¸</span> Viáº¿t Nháº­t kÃ½ 
                    </div>
                    <p style='text-align: center; color: #0d47a1; background: #f4f7fb; padding: 8px; border-radius: 4px; font-size: 13px; border-left: 5px solid #2196f3; line-height: 1.4;'>
                        <em>ğŸ”¬ HÃ£y tháº­t trung thá»±c. Dá»¯ liá»‡u chÃ­nh xÃ¡c lÃ  chÃ¬a khÃ³a cho káº¿t quáº£ nghiÃªn cá»©u Khoa há»c KÄ© thuáº­t.</em>
                    </p>
            
            <label class="fb-label">1. Sá»± kiá»‡n gÃ¬ Ä‘Ã¡ng nhá»› nháº¥t Ä‘Ã£ xáº£y ra trong tuáº§n nÃ y?</label>
            <textarea id="q1-${realIndex}" class="fb-input" rows="2" placeholder='VÃ­ dá»¥: CÃ£i nhau vá»›i báº¡n bÃ¨...'></textarea>
            
            <label class="fb-label">2. Äáº¥u tranh ná»™i tÃ¢m (Báº£n nÄƒng vs SiÃªu ngÃ£)?</label>
            <textarea id="q2-${realIndex}" class="fb-input" rows="2" placeholder='VÃ­ dá»¥: Muá»‘n máº¯ng chá»­i cho háº£ giáº­n nhÆ°ng lÆ°Æ¡ng tÃ¢m cáº¯n rá»©t...'></textarea>

            <label class="fb-label">3. BÃ i há»c rÃºt ra?</label>
            <textarea id="q3-${realIndex}" class="fb-input" rows="2" placeholder='VÃ­ dá»¥: Cáº§n kiá»m cháº¿ cáº£m xÃºc hÆ¡n...'></textarea>
            
            <div class="rating-box">
                <div style="font-size:12px; margin-bottom:5px; color:#666; font-style:italic;">ÄÃ¡nh giÃ¡ hiá»‡u quáº£:</div>
                <div class="star-row"><span>ğŸ“± Giao diá»‡n dá»… dÃ¹ng</span> ${renderStarWidget(realIndex, 'r1', 0)}</div>
                <div class="star-row"><span>ğŸ§  GiÃºp hiá»ƒu báº£n thÃ¢n</span> ${renderStarWidget(realIndex, 'r2', 0)}</div>
                <div class="star-row"><span>ğŸ¦‹ GiÃºp thay Ä‘á»•i hÃ nh vi</span> ${renderStarWidget(realIndex, 'r3', 0)}</div>

                <div class="emoji-section">
                    <div style="font-size:12px; margin-bottom:5px; color:#666; font-style:italic;">Má»©c Ä‘á»™ hÃ i lÃ²ng vá»›i:</div>
                    <div class="emoji-row"><span>ğŸ“Š Káº¿t quáº£</span> ${renderEmojiWidget(realIndex, 'satResult', 0)}</div>
                    <div class="emoji-row"><span>ğŸ“ ThÆ°á»›c</span> ${renderEmojiWidget(realIndex, 'satTool', 0)}</div>
                </div>
            </div>
            <button class="btn-save-research" onclick="window.saveFeedback(${realIndex})">ğŸ’¾ LÆ¯U Dá»® LIá»†U VÃ€O NHáº¬T KÃ</button>`;
        }
        
        card += `</div></div>`; // End feedback area & card
        return card;
    });

    // Äáº£o ngÆ°á»£c danh sÃ¡ch tháº» HTML Ä‘á»ƒ Chu ká»³ 1 (CÅ© nháº¥t) hiá»ƒn thá»‹ trÃªn cÃ¹ng (hoáº·c bá» reverse náº¿u muá»‘n ngÆ°á»£c láº¡i)
    // DÃ¹ng join('') Ä‘á»ƒ gá»™p thÃ nh chuá»—i HTML
    html += cardHtmlList.reverse().join('');

    box.innerHTML = html;
};
// Äáº£m báº£o gáº¯n sá»± kiá»‡n má»Ÿ nÃºt
document.getElementById('reviewBtn').onclick = window.showReview;
// HÃ m lÆ°u (Giá»¯ nguyÃªn logic cÅ© nhÆ°ng cáº­p nháº­t láº¡i ID)
window.saveFeedback = function(index) {
    const q1 = document.getElementById(`q1-${index}`).value;
    const q2 = document.getElementById(`q2-${index}`).value;
    const q3 = document.getElementById(`q3-${index}`).value;
    
    // Láº¥y Sao
    const rt = tempRatings[index] || {};
    // Láº¥y Emoji (ThÃªm má»›i)
    const em = tempEmojis[index] || {};

    // Kiá»ƒm tra dá»¯ liá»‡u
    if(!rt.r1 || !rt.r2 || !rt.r3) {
        alert("âš ï¸ Vui lÃ²ng cháº¥m Ä‘iá»ƒm SAO cho cáº£ 3 tiÃªu chÃ­ KHKT.");
        return;
    }
    if(!em.satResult || !em.satTool) {
        alert("âš ï¸ Vui lÃ²ng chá»n biá»ƒu tÆ°á»£ng cáº£m xÃºc (EMOJI) Ä‘Ã¡nh giÃ¡ má»©c Ä‘á»™ hÃ i lÃ²ng.");
        return;
    }
    if(!q1 || !q2 || !q3) {
        alert("âš ï¸ Vui lÃ²ng viáº¿t Ä‘á»§ nháº­t kÃ½.");
        return;
    }

    // LÆ°u táº¥t cáº£ vÃ o cáº¥u trÃºc feedback
    state.finishedCycles[index].feedback = {
        q1, q2, q3,
        r1: rt.r1, r2: rt.r2, r3: rt.r3,
        satResult: em.satResult, // LÆ°u Ä‘iá»ƒm hÃ i lÃ²ng káº¿t quáº£ (1-5)
        satTool: em.satTool      // LÆ°u Ä‘iá»ƒm hÃ i lÃ²ng cÃ´ng cá»¥ (1-5)
    };
    
    saveFinishedCycles(state.finishedCycles);
    alert("âœ… ÄÃ£ lÆ°u thÃ nh cÃ´ng!");
    showReview(); 
}
window.setRating = setRating;

document.getElementById('closeReview').onclick = () => {
  document.getElementById('reviewModal').style.display = 'none';
};

document.getElementById('reviewBtn').onclick = showReview;
// Ã‚m click nÃºt
const btnClickSound = new Audio("click.mp3");
btnClickSound.volume = 0.35; // chá»‰nh Ä‘á»™ lá»›n táº¡i Ä‘Ã¢y

function playBtnSound() {
    // reset vá» Ä‘áº§u, trÃ¡nh bá»‹ delay
    btnClickSound.currentTime = 0;
    btnClickSound.play().catch(()=>{});
}
// HÃ€M Má» KHÃ“A Ã‚M THANH CHO THIáº¾T Bá»Š DI Äá»˜NG
let audioUnlocked = false;

function unlockAudio() {
    if (audioUnlocked) return;
    
    // Danh sÃ¡ch táº¥t cáº£ cÃ¡c Ä‘á»‘i tÆ°á»£ng Audio
  const audios = [
    document.getElementById('sndAmber'),
    document.getElementById('sndRed'),
    document.getElementById('sndGreen'),
    document.getElementById('sndBannangnhe'),
    document.getElementById('sndSieunganhe'),
    btnClickSound // Ä‘á»‘i tÆ°á»£ng Ä‘Ã£ Ä‘Æ°á»£c khai bÃ¡o
];

    // Cá»‘ gáº¯ng phÃ¡t vÃ  dá»«ng ngay láº­p tá»©c táº¥t cáº£ cÃ¡c Ã¢m thanh
    audios.forEach(audio => {
        if (audio) {
            // DÃ¹ng play().catch() Ä‘á»ƒ trÃ¡nh lá»—i Uncaught Promise
            audio.play().then(() => {
                audio.pause();
                audio.currentTime = 0;
            }).catch(() => {});
        }
    });

    audioUnlocked = true;
    
    // XÃ³a listener sau khi Ä‘Ã£ má»Ÿ khÃ³a thÃ nh cÃ´ng
    document.removeEventListener('touchstart', unlockAudio);
    document.removeEventListener('click', unlockAudio);
}

// Gáº¯n sá»± kiá»‡n má»Ÿ khÃ³a vÃ o tÆ°Æ¡ng tÃ¡c Ä‘áº§u tiÃªn cá»§a ngÆ°á»i dÃ¹ng
document.addEventListener('touchstart', unlockAudio, {once: true});
document.addEventListener('click', unlockAudio, {once: true});
// Gáº¯n vÃ o táº¥t cáº£ cÃ¡c nÃºt
document.addEventListener("DOMContentLoaded", () => {
    const btns = [
        document.getElementById("resetBtn"),
        document.getElementById("revBtn"),
        document.getElementById("helpBtn"),
        document.getElementById("reviewBtn"),
        document.getElementById("closeHelp"),
        document.getElementById("closeReview")
    ];

    btns.forEach(btn => {
        if (btn) {
            btn.addEventListener("click", playBtnSound);
        }
    });
});

</script>
<audio id="sndAmber" src="alert-amber.mp3" preload="auto"></audio>
<audio id="sndRed"   src="alert-red.mp3" preload="auto"></audio>
<audio id="sndGreen" src="success.mp3" preload="auto"></audio>

<!-- Má»šI: hai Ã¢m thanh bá»• sung -->
<audio id="sndBannangnhe" src="bannangnhe.mp3" preload="auto"></audio>
<audio id="sndSieunganhe" src="sieunganhe.mp3" preload="auto"></audio>

<script>
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js")
    .then(() => console.log("SW registered"))
    .catch(err => console.error("SW failed", err));
}
</script>
<script>
const COLORS = {
    PURPLE_DARK: "4A148C",
    PURPLE_MEDIUM: "7B1FA2",
    PURPLE_LIGHT: "D1C4E9",
    GREEN: "2ecc71",
    AMBER: "FFD700",
    RED: "E74C3C",
    GRAY: "999999",
    BLACK: "000000",
    WHITE: "FFFFFF"
};

// Khai bÃ¡o láº¡i thÆ° viá»‡n docx vÃ  saveAs Ä‘á»ƒ Ä‘áº£m báº£o khÃ´ng bá»‹ lá»—i undefined
const docx = window.docx;
const saveAs = window.saveAs;


// --- HÃ€M Há»– TRá»¢ CHUYá»‚N Äá»”I SANG TEXT (Giáº£i quyáº¿t váº¥n Ä‘á» Icon Word) ---

/**
 * Tráº£ vá» mÃ´ táº£ text cho Ä‘iá»ƒm Sao (Rating 1-5).
 * @param {number} val - GiÃ¡ trá»‹ Ä‘iá»ƒm Sao (1-5).
 * @returns {string} MÃ´ táº£ báº±ng chá»¯.
 */
function getStarRatingText(val) {
    const v = Number(val);
    const starIcon = "â˜…";
    const emptyStarIcon = "â˜†";
    const stars = starIcon.repeat(v) + emptyStarIcon.repeat(5 - v);

    if (v === 1) return `${stars} (Ráº¥t kÃ©m)`;
    if (v === 2) return `${stars} (KÃ©m)`;
    if (v === 3) return `${stars} (Trung bÃ¬nh)`;
    if (v === 4) return `${stars} (Tá»‘t)`;
    if (v === 5) return `${stars} (Ráº¥t tá»‘t)`;
    return "ChÆ°a Ä‘Ã¡nh giÃ¡";
}

/**
 * Tráº£ vá» mÃ´ táº£ text cho Ä‘Ã¡nh giÃ¡ Emoji (1-5).
 * @param {number} val - GiÃ¡ trá»‹ Ä‘iá»ƒm Emoji (1-5).
 * @returns {string} MÃ´ táº£ báº±ng chá»¯.
 */
function getEmojiResultText(val) {
    const index = Number(val) - 1;
    if (index >= 0 && index < EMOJI_LABELS.length) {
        return EMOJI_LABELS[index];
    }
    return "ChÆ°a Ä‘Ã¡nh giÃ¡";
}

/**
 * Tráº£ vá» mÃ´ táº£ text cho xu hÆ°á»›ng tÃ¢m lÃ½.
 * @param {number} v - GiÃ¡ trá»‹ gáº¡t thÆ°á»›c.
 * @returns {string} MÃ´ táº£ báº±ng chá»¯.
 */
function getCategoryLabel(v) {
    const n = Number(v || 0);
    let label = '';
    let icon = 'ğŸ‘¤'; // Icon máº·c Ä‘á»‹nh (EGO)

    if (n <= -6667) {
        label = 'Báº£n nÄƒng máº¡nh (ID)';
        icon = 'ğŸ˜ˆ'; // Icon cho ID Máº¡nh
    } else if (n <= -3334) {
        label = 'Báº£n nÄƒng vá»«a';
        icon = 'ğŸ”¥'; // Icon cho ID Vá»«a
    } else if (n >= 6667) {
        label = 'SiÃªu ngÃ£ máº¡nh (Superego)';
        icon = 'ğŸ˜‡'; // Icon cho Superego Máº¡nh
    } else if (n >= 3334) {
        label = 'SiÃªu ngÃ£ vá»«a';
        icon = 'ğŸ•Šï¸'; // Icon cho Superego Vá»«a
    } else {
        label = 'Báº£n ngÃ£ cÃ¢n báº±ng (Ego)';
        icon = 'ğŸ‘¤'; // Icon cho EGO CÃ¢n báº±ng
    }
    
    // Tráº£ vá» cáº£ Icon vÃ  nhÃ£n Ä‘Ã£ viáº¿t hoa chá»¯ cÃ¡i Ä‘áº§u
    return `${icon} ${label}`;
}
function loadFinishedCycles() {
    try {
        // Giáº£ Ä‘á»‹nh key lÆ°u trá»¯ lÃ  'freudRuler_cycles_history'
        const cycles = localStorage.getItem('freudRuler_cycles_history');
        return cycles ? JSON.parse(cycles) : [];
    } catch (e) {
        console.error("Could not load finished cycles", e);
        return [];
    }
}

function loadState() {
    return {
        finishedCycles: loadFinishedCycles(),
        // Giáº£ Ä‘á»‹nh key lÆ°u trá»¯ lÃ  'currentStatus', 'currentStartTime', 'currentEntries'
        status: localStorage.getItem('currentStatus') || 'idle', 
        startTimestamp: localStorage.getItem('currentStartTime') || null,
        entries: JSON.parse(localStorage.getItem('currentEntries') || '[]'),
    };
}


// ==========================================================
// HÃ€M XUáº¤T FILE WORD CHÃNH (exportWord) - ÄÃƒ Cáº¢I TIáº¾N
// ==========================================================
async function exportWord() {
    try {
        // Kiá»ƒm tra docx Ä‘Ã£ táº£i chÆ°a
        if (typeof docx === 'undefined' || typeof saveAs === 'undefined') {
            alert("Lá»—i: KhÃ´ng tÃ¬m tháº¥y thÆ° viá»‡n docx hoáº·c file-saver. Vui lÃ²ng kiá»ƒm tra link CDN.");
            return;
        }

        const {
            Document, Packer, Paragraph, TextRun, Table, TableRow, TableCell,
            WidthType, AlignmentType, BorderStyle
        } = docx;

        // 1. YÃŠU Cáº¦U THÃ”NG TIN CÃ NHÃ‚N
        let fullName = prompt("1. Nháº­p Há» & tÃªn (Báº®T BUá»˜C):", "") || "";
        if (fullName.trim() === "") {
            alert("âŒ Há» & tÃªn lÃ  trÆ°á»ng báº¯t buá»™c.");
            return;
        }

        let genderYob = prompt("2. Nháº­p Giá»›i tÃ­nh vÃ  NÄƒm sinh (Báº®T BUá»˜C, VÃ­ dá»¥: Nam, 2005):", "") || "";
        if (genderYob.trim() === "") {
            alert("âŒ Giá»›i tÃ­nh vÃ  NÄƒm sinh lÃ  trÆ°á»ng báº¯t buá»™c.");
            return;
        }

        let classSchool = prompt("3. Nháº­p TÃªn lá»›p vÃ  TÃªn trÆ°á»ng (dÃ nh cho há»c sinh, ngÆ°á»i dÃ¢n cÃ³ thá»ƒ bá» qua):", "ChÆ°a nháº­p");
        let phoneAddress = prompt("4. Nháº­p SÄT vÃ  Äá»‹a chá»‰ thÆ°á»ng trÃº (dÃ nh cho ngÆ°á»i dÃ¢n, há»c sinh cÃ³ thá»ƒ bá» qua):", "ChÆ°a nháº­p");


        const state = loadState();
        const children = [];

        // 2. Äá»ŠNH NGHÄ¨A STYLES CHO WORD
        // Cá»¡ chá»¯ 14pt tÆ°Æ¡ng Ä‘Æ°Æ¡ng size 28 trong docx.js (24 lÃ  12pt)
        const styles = {
            paragraphStyles: [
                { id: "Heading1", name: "Heading 1", basedOn: "Normal", next: "Normal", run: { size: 48, bold: true, color: COLORS.PURPLE_DARK }, paragraph: { spacing: { before: 200, after: 200 }, alignment: AlignmentType.CENTER } }, // Ráº¥t lá»›n: 24pt
                { id: "Heading2", name: "Heading 2", basedOn: "Normal", next: "Normal", run: { size: 36, bold: true, color: COLORS.PURPLE_MEDIUM }, paragraph: { spacing: { before: 150, after: 100 } } }, // Lá»›n: 18pt
                { id: "Heading3", name: "Heading 3", basedOn: "Normal", next: "Normal", run: { size: 32, bold: true, color: COLORS.BLACK }, paragraph: { spacing: { before: 100, after: 80 } } }, // Trung bÃ¬nh: 16pt
                { id: "Normal", name: "Normal", run: { size: 28 } }, // Cá»¡ chá»¯ thÆ°á»ng: 14pt
            ],
        };
        const RUN_BOLD_14 = { size: 28, bold: true };
        const RUN_NORMAL_14 = { size: 28 };


        // --- PHáº¦N 1: THÃ”NG TIN CHUNG VÃ€ CÃ NHÃ‚N ---
        children.push(new Paragraph({
            text: "Dá»® LIá»†U THá»°C NGHIá»†M CÃ NHÃ‚N THÆ¯á»šC PHáº¢N TÆ¯ TÃ‚M LÃ VÃ€ KHÆ I Dáº¬Y NHÃ‚N TÃNH LÃ€M NGÆ¯á»œI",
            style: "Heading1"
        }));
        children.push(new Paragraph({ text: `NgÆ°á»i tham gia: ${fullName.toUpperCase()}`, alignment: AlignmentType.CENTER, run: { bold: true, size: 32, color: COLORS.PURPLE_MEDIUM } }));
        children.push(new Paragraph({ text: `NgÃ y xuáº¥t bÃ¡o cÃ¡o: ${new Date().toLocaleDateString('vi-VN')}`, alignment: AlignmentType.CENTER, run: RUN_NORMAL_14 }));
        children.push(new Paragraph({ text: "" }));

        children.push(new Paragraph({ text: "ğŸ“ THÃ”NG TIN CÃ NHÃ‚N NGÆ¯á»œI DÃ™NG", style: "Heading2" }));

        // Báº£ng thÃ´ng tin cÃ¡ nhÃ¢n
        const infoTableRows = [
            new TableRow({ children: [
                new TableCell({ children: [new Paragraph({ text: "Há» & TÃªn", run: RUN_BOLD_14 })], width: { size: 30, type: WidthType.PERCENTAGE } }),
                new TableCell({ children: [new Paragraph({ text: fullName, run: RUN_NORMAL_14 })] }),
            ]}),
            new TableRow({ children: [
                new TableCell({ children: [new Paragraph({ text: "Giá»›i tÃ­nh & NÄƒm sinh", run: RUN_BOLD_14 })] }),
                new TableCell({ children: [new Paragraph({ text: genderYob, run: RUN_NORMAL_14 })] }),
            ]}),
            new TableRow({ children: [
                new TableCell({ children: [new Paragraph({ text: "Lá»›p & TrÆ°á»ng", run: RUN_BOLD_14 })] }),
                new TableCell({ children: [new Paragraph({ text: classSchool, run: RUN_NORMAL_14 })] }),
            ]}),
            new TableRow({ children: [
                new TableCell({ children: [new Paragraph({ text: "SÄT & Äá»‹a chá»‰", run: RUN_BOLD_14 })] }),
                new TableCell({ children: [new Paragraph({ text: phoneAddress, run: RUN_NORMAL_14 })] }),
            ]}),
        ];

        children.push(new Table({
            rows: infoTableRows,
            width: { size: 100, type: WidthType.PERCENTAGE },
            borders: {
                top: { style: BorderStyle.SINGLE, size: 3, color: COLORS.PURPLE_LIGHT },
                bottom: { style: BorderStyle.SINGLE, size: 3, color: COLORS.PURPLE_LIGHT },
                insideHorizontal: { style: BorderStyle.SINGLE, size: 1, color: COLORS.PURPLE_LIGHT },
            },
        }));

        children.push(new Paragraph({ text: "", spacing: { after: 300 } }));
// --- PHáº¦N 2: Tá»”NG Káº¾T CÃC CHU Ká»² (Báº£ng) ---
children.push(new Paragraph({
    text: "ğŸ“‹ Tá»”NG Káº¾T CÃC CHU Ká»² ÄÃƒ HOÃ€N THÃ€NH",
    style: "Heading2",
    alignment: AlignmentType.LEFT
}));

const cycles = state.finishedCycles || [];
if (cycles.length > 0) {
    // Táº¡o báº£ng tá»•ng káº¿t
    const createHeaderCell = (text) => new TableCell({
        children: [new Paragraph({ text, alignment: AlignmentType.CENTER, run: { color: COLORS.WHITE, bold: true, size: 28 } })],
        shading: { fill: COLORS.PURPLE_MEDIUM },
        verticalAlign: "center",
    });

    const headerRow = new TableRow({
        children: [
            createHeaderCell("Chu ká»³"),
            createHeaderCell("Äiá»ƒm TB"),
            createHeaderCell("Xu hÆ°á»›ng tÃ¢m lÃ½"),
            createHeaderCell("Tá»•ng Ä‘iá»ƒm"), // <--- BÆ¯á»šC 1: THÃŠM Cá»˜T Tá»”NG ÄIá»‚M
            createHeaderCell("Sá»‘ láº§n gáº¡t"),
            createHeaderCell("Thá»i gian báº¯t Ä‘áº§u"),
        ],
        tableHeader: true,
        cantSplit: true,
    });

    const tableRows = [headerRow];

    [...cycles].reverse().forEach((cycle, displayIndex) => {
        const cycleNum = displayIndex + 1;
        const avgScore = cycle.avgScore;
        const entryCount = cycle.entries.length;
        
        // BÆ¯á»šC 2: TÃNH TOÃN Tá»”NG ÄIá»‚M
        const totalScore = (cycle.entries || []).reduce((sum, entry) => sum + (Number(entry.value) || 0), 0);
        
        const startStr = cycle.startTime ? new Date(cycle.startTime).toLocaleString('vi-VN') : "N/A";
        const interpretation = interpretScore(avgScore);

        const scoreColor = (avgScore <= -3334 || avgScore >= 3334) ? COLORS.PURPLE_DARK : COLORS.BLACK;
        const rowFill = displayIndex % 2 === 0 ? "FFFFFF" : "F3E5F5";

        tableRows.push(new TableRow({
            children: [
                new TableCell({ children: [new Paragraph({ text: `#${cycleNum}`, alignment: AlignmentType.CENTER, run: { bold: true, color: COLORS.PURPLE_DARK, size: 28 } })], verticalAlign: "center", shading: { fill: rowFill } }),
                new TableCell({ children: [new Paragraph({ text: `${avgScore > 0 ? '+' : ''}${avgScore.toFixed(1)}`, alignment: AlignmentType.CENTER, run: { bold: true, color: scoreColor, size: 28 } })], verticalAlign: "center", shading: { fill: rowFill } }),
                new TableCell({ children: [new Paragraph({ text: interpretation, alignment: AlignmentType.CENTER, run: RUN_BOLD_14 })], verticalAlign: "center", shading: { fill: rowFill } }),
                
                // BÆ¯á»šC 3: THÃŠM CELL Tá»”NG ÄIá»‚M (TrÆ°á»›c Sá»‘ láº§n gáº¡t)
                new TableCell({ children: [new Paragraph({ 
                    text: `${totalScore > 0 ? '+' : ''}${totalScore}`, 
                    alignment: AlignmentType.CENTER, 
                    run: { bold: true, color: COLORS.BLACK, size: 28 } 
                })], verticalAlign: "center", shading: { fill: rowFill } }),
                
                new TableCell({ children: [new Paragraph({ text: `${entryCount}`, alignment: AlignmentType.CENTER, run: RUN_NORMAL_14 })], verticalAlign: "center", shading: { fill: rowFill } }),
                new TableCell({ children: [new Paragraph({ text: startStr, alignment: AlignmentType.CENTER, run: RUN_NORMAL_14 })], verticalAlign: "center", shading: { fill: rowFill } }),
            ],
            cantSplit: true,
        }));
    });

    children.push(new Table({
        rows: tableRows,
        width: { size: 100, type: WidthType.PERCENTAGE },
        // BÆ¯á»šC 4: Cáº¬P NHáº¬T Äá»˜ Rá»˜NG (ThÃªm 10% cho cá»™t Tá»•ng Ä‘iá»ƒm)
        // [Chu ká»³ 10, Äiá»ƒm TB 15, Xu hÆ°á»›ng 30, Tá»•ng Ä‘iá»ƒm 10, Sá»‘ láº§n gáº¡t 15, Thá»i gian 20]
        columnWidths: [10, 15, 25, 10, 10, 30], 
        borders: {
            top: { style: BorderStyle.SINGLE, size: 6, color: COLORS.PURPLE_DARK },
            bottom: { style: BorderStyle.SINGLE, size: 6, color: COLORS.PURPLE_DARK },
            insideHorizontal: { style: BorderStyle.SINGLE, size: 3, color: COLORS.PURPLE_LIGHT },
        },
    }));
} else {
    children.push(new Paragraph({ text: "ChÆ°a cÃ³ chu ká»³ nÃ o Ä‘Æ°á»£c hoÃ n thÃ nh vÃ  lÆ°u dá»¯ liá»‡u.", italics: true, color: COLORS.GRAY, run: RUN_NORMAL_14 }));
}

        children.push(new Paragraph({ text: "", spacing: { after: 300 } }));

        // --- PHáº¦N 3: NHáº¬T KÃ CHI TIáº¾T VÃ€ PHáº¢N TÆ¯ (Äá»’NG Bá»˜ 100%) ---
        children.push(new Paragraph({
            text: "ğŸ“ NHáº¬T KÃ CHI TIáº¾T Tá»ªNG CHU Ká»²",
            style: "Heading2",
            alignment: AlignmentType.LEFT
        }));

        if (cycles.length > 0) {
            [...cycles].reverse().forEach((cycle, displayIndex) => {
                const cycleNum = displayIndex + 1;
                const fb = cycle.feedback || {};
                const startStr = cycle.startTime ? new Date(cycle.startTime).toLocaleString('vi-VN') : "N/A";
                const isDone = (fb.r1 > 0);

                // HEADER CHU Ká»²
                children.push(new Paragraph({
                    text: `CHU Ká»² ${cycleNum}: [${startStr}] - Äiá»ƒm TB: ${cycle.avgScore.toFixed(1)} (${cycle.entries.length} láº§n gáº¡t)`,
                    style: "Heading3"
                }));


                // ==========================================================
                // 3.1. Báº¢NG NHáº¬T KÃ CHI TIáº¾T Tá»ªNG Láº¦N Gáº T (Äá»’NG Bá»˜)
                // ==========================================================
                children.push(new Paragraph({ text: "Chi tiáº¿t cÃ¡c láº§n gáº¡t thÆ°á»›c:", run: RUN_BOLD_14 }));

// --- Báº®T Äáº¦U ÄOáº N CODE Sá»¬A ---
                
                // 1. Táº¡o Header báº£ng (ÄÃ£ bá» cá»™t "NgÃ y" riÃªng, chá»‰ giá»¯ "Thá»i gian")
                const createEntryHeader = (text) => new TableCell({
                    children: [new Paragraph({ text, alignment: AlignmentType.CENTER, run: { color: COLORS.WHITE, bold: true, size: 24 } })],
                    shading: { fill: COLORS.GRAY }, verticalAlign: "center",
                });
                
                const entryHeaderRow = new TableRow({
                    children: [
                        createEntryHeader("STT"), 
                        createEntryHeader("Thá»i gian"), // <--- Äá»•i tÃªn cá»™t
                        // ÄÃ£ xÃ³a dÃ²ng createEntryHeader("NgÃ y") á»Ÿ Ä‘Ã¢y
                        createEntryHeader("GiÃ¡ trá»‹"), 
                        createEntryHeader("Xu hÆ°á»›ng")
                    ],
                    tableHeader: true, cantSplit: true,
                });

                const entryRows = [entryHeaderRow];
                
                // 2. VÃ²ng láº·p dá»¯ liá»‡u (Gá»™p e.time vÃ  e.date)
                (cycle.entries || []).forEach((e, i) => {
                    const rowFill = i % 2 === 0 ? "FFFFFF" : "F9F9F9";
                    
                    // Gá»™p chuá»—i thá»i gian vÃ  ngÃ y
                    const combinedTime = `${e.time || ""} ${e.date || ""}`;

                    entryRows.push(new TableRow({
                        children: [
                            new TableCell({ children:[new Paragraph((i+1).toString())], shading:{fill:rowFill} }),
                            
                            // Ã” Thá»i gian Ä‘Ã£ gá»™p:
                            new TableCell({ children:[new Paragraph(combinedTime)], shading:{fill:rowFill} }),
                            
                            // ÄÃ£ xÃ³a Ã´ Date cÅ© á»Ÿ Ä‘Ã¢y
                            
                            new TableCell({ children:[new Paragraph(e.value.toString())], shading:{fill:rowFill} }),
                            new TableCell({ children:[new Paragraph(getCategoryLabel(e.value))], shading:{fill:rowFill} }),
                        ]
                    }));
                });

                // 3. Táº¡o báº£ng (Cáº­p nháº­t tá»· lá»‡ Ä‘á»™ rá»™ng cá»™t cho Ä‘áº¹p)
                children.push(new Table({ 
                    rows: entryRows, 
                    width: { size: 100, type: WidthType.PERCENTAGE },
                    // STT: 10%, Thá»i gian: 35%, GiÃ¡ trá»‹: 15%, Xu hÆ°á»›ng: 40%
                    columnWidths: [10, 35, 15, 40] 
                }));

                // --- Káº¾T THÃšC ÄOáº N CODE Sá»¬A ---
                children.push(new Paragraph({ text: "", spacing: { after: 200 } }));


                // ==========================================================
                // 3.2. PHáº¢N TÆ¯ (FEEDBACK)
                // ==========================================================
                children.push(new Paragraph({ text: "âœï¸ PHáº¢N TÆ¯ VÃ€ ÄÃNH GIÃ", style: "Heading3" }));

                if (isDone) {
                    children.push(new Paragraph({ text: "ğŸŒŸ Dá»¯ liá»‡u Pháº£n tÆ°:", run: { bold: true, color: COLORS.PURPLE_MEDIUM, size: 28 } }));

                    children.push(new Paragraph({ children: [new TextRun({ text: "ğŸ“ Sá»± kiá»‡n Ä‘Ã¡ng nhá»› nháº¥t trong tuáº§n: ", ...RUN_BOLD_14 }), new TextRun({ text: fb.q1 || "N/A", ...RUN_NORMAL_14 })] }));
                    children.push(new Paragraph({ children: [new TextRun({ text: "âš”ï¸ Xung Ä‘á»™t ná»™i tÃ¢m, Ä‘áº¥u tranh giá»¯a Báº£n nÄƒng vÃ  SiÃªu ngÃ£: ", ...RUN_BOLD_14 }), new TextRun({ text: fb.q2 || "N/A", ...RUN_NORMAL_14 })] }));
                    children.push(new Paragraph({ children: [new TextRun({ text: "ğŸ’¡ BÃ i há»c rÃºt ra: ", ...RUN_BOLD_14 }), new TextRun({ text: fb.q3 || "N/A", ...RUN_NORMAL_14 })] }));

                    children.push(new Paragraph({ text: "" }));

                    // Báº£ng ÄÃ¡nh giÃ¡ Sao & Emoji (ÄÃ£ chuyá»ƒn sang TEXT)
                    children.push(new Paragraph({
                        text: "ğŸ“Š ÄÃ¡nh giÃ¡ Chi tiáº¿t",
                        run: { bold: true, color: COLORS.PURPLE_MEDIUM, size: 28 }
                    }));

                    const starTableRows = [
                        new TableRow({ children: [
                            new TableCell({ children: [new Paragraph({ text: "TiÃªu chÃ­", run: RUN_BOLD_14 })], shading: { fill: COLORS.PURPLE_LIGHT } }),
                            new TableCell({ children: [new Paragraph({ text: "Äiá»ƒm Sao (5 má»©c)", run: RUN_BOLD_14 })], shading: { fill: COLORS.PURPLE_LIGHT } }),
                            new TableCell({ children: [new Paragraph({ text: "Má»©c Ä‘á»™ HÃ i lÃ²ng", run: RUN_BOLD_14 })], shading: { fill: COLORS.PURPLE_LIGHT } })
                        ]}),
                        new TableRow({ children: [
                            new TableCell({ children: [new Paragraph({ text: "1. TÃ­nh dá»… sá»­ dá»¥ng", run: RUN_NORMAL_14 })] }),
                            new TableCell({ children: [new Paragraph({ text: getStarRatingText(fb.r1), run: { color: COLORS.AMBER, size: 28 } })] }),
                            new TableCell({ children: [new Paragraph({ text: `HÃ i lÃ²ng vá» Káº¿t quáº£: ${getEmojiResultText(fb.satResult)}`, run: RUN_NORMAL_14 })] }),
                        ]}),
                        new TableRow({ children: [
                            new TableCell({ children: [new Paragraph({ text: "2. GiÃºp hiá»ƒu báº£n thÃ¢n", run: RUN_NORMAL_14 })] }),
                            new TableCell({ children: [new Paragraph({ text: getStarRatingText(fb.r2), run: { color: COLORS.AMBER, size: 28 } })] }),
                            new TableCell({ children: [new Paragraph({ text: `HÃ i lÃ²ng vá» CÃ´ng cá»¥: ${getEmojiResultText(fb.satTool)}`, run: RUN_NORMAL_14 })] }),
                        ]}),
                        new TableRow({ children: [
                            new TableCell({ children: [new Paragraph({ text: "3. GiÃºp thay Ä‘á»•i hÃ nh vi", run: RUN_NORMAL_14 })] }),
                            new TableCell({ children: [new Paragraph({ text: getStarRatingText(fb.r3), run: { color: COLORS.AMBER, size: 28 } })] }),
                            new TableCell({ children: [new Paragraph({ text: "" })] }),
                        ]}),
                    ];

                    children.push(new Table({
                        rows: starTableRows, width: { size: 100, type: WidthType.PERCENTAGE },
                        columnWidths: [30, 35, 35],
                        borders: {
                            top: { style: BorderStyle.SINGLE, size: 3, color: COLORS.BLACK },
                            bottom: { style: BorderStyle.SINGLE, size: 3, color: COLORS.BLACK },
                            insideHorizontal: { style: BorderStyle.SINGLE, size: 1, color: COLORS.GRAY },
                        }
                    }));

                } else {
                    children.push(new Paragraph({
                        text: "NgÆ°á»i dÃ¹ng chÆ°a thá»±c hiá»‡n pháº£n tÆ° cho chu ká»³ nÃ y.",
                        italics: true,
                        color: COLORS.RED,
                        run: RUN_NORMAL_14
                    }));
                }

                children.push(new Paragraph({ text: "", spacing: { after: 300 } }));
            });
        }

        // --- CHU Ká»² HIá»†N Táº I (Náº¾U CÃ“) --
        if (state.status === 'running') {
            children.push(new Paragraph({
                text: "CHU Ká»² HIá»†N Táº I (ÄANG DIá»„N RA - CHÆ¯A Tá»”NG Káº¾T)",
                style: "Heading2",
                alignment: AlignmentType.LEFT,
                spacing: { before: 400 },
                border: { top: { style: BorderStyle.DASHED, size: 6, color: COLORS.GRAY } }
            }));

            const currentEntries = state.entries || [];
            children.push(new Paragraph({ text: `â€¢ Thá»i gian báº¯t Ä‘áº§u: ${state.startTimestamp ? new Date(state.startTimestamp).toLocaleString('vi-VN') : "N/A"}`, run: RUN_NORMAL_14 }));
            children.push(new Paragraph({ text: `â€¢ Sá»‘ láº§n gáº¡t táº¡m tÃ­nh: ${currentEntries.length}`, run: RUN_NORMAL_14 }));
            children.push(new Paragraph({
                text: "LÆ°u Ã½: Dá»¯ liá»‡u nÃ y chÆ°a hoÃ n thiá»‡n. HÃ£y nháº¥n nÃºt 'Reset' trÃªn á»©ng dá»¥ng Ä‘á»ƒ káº¿t thÃºc chu ká»³ vÃ  Ä‘iá»n pháº£n tÆ° trÆ°á»›c khi xuáº¥t bÃ¡o cÃ¡o Ä‘áº§y Ä‘á»§.",
                italics: true,
                color: COLORS.RED,
                run: RUN_NORMAL_14
            }));
        }

        // 4. Táº O VÃ€ XUáº¤T FILE
        const doc = new Document({
            sections: [{ children }],
            styles: styles,
        });

        const blob = await Packer.toBlob(doc);
        const safeName = fullName.replace(/[^a-z0-9]/gi, '_');
        const fileName = `${fullName.trim()}.docx`;

        // Sá»­ dá»¥ng FileSaver.js Ä‘á»ƒ xuáº¥t file
        saveAs(blob, fileName);

        alert(`âœ… ÄÃ£ xuáº¥t file Word thÃ nh cÃ´ng cho: ${fullName}.`);
    } catch (err) {
        console.error("Lá»—i khi táº¡o hoáº·c xuáº¥t file DOCX:", err);
        alert("Lá»—i: KhÃ´ng thá»ƒ xuáº¥t file Word. Vui lÃ²ng kiá»ƒm tra console Ä‘á»ƒ biáº¿t chi tiáº¿t.");
    }
}

</script>
</body>
</html>