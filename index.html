<!doctype html>  
<html lang="vi">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#004080">

<!-- B·∫Øt bu·ªôc cho iPhone -->
<link rel="apple-touch-icon" href="icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">

<meta name="color-scheme" content="light">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<title>Th∆∞·ªõc ph·∫£n t∆∞ t√¢m l√Ω v√† kh∆°i d·∫≠y nh√¢n t√≠nh l√†m ng∆∞·ªùi</title>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/docx@7.1.0/build/index.js"></script>
<style>
  :root{
    --bg:#f4f7fb;
    --ruler-bg:#0b63a8;
    --slider:#ffffff;
    --led-size:48px;
    --green:#2ecc71; --amber:#FFD700; --red:#e74c3c; --white:#ffffff;
  }
 body {
  font-family: system-ui,Segoe UI,Roboto,Helvetica,Arial;
  margin:0;
  padding:12px;
  background-color: #ffffff !important;
  color: #123 !important;
  color-scheme: light only;
-webkit-appearance: none;
  forced-color-adjust: none;
}
.container{max-width:420px;margin:0 auto;}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
h1{font-size:16px;margin:0}
small{color:#456}
.ruler-wrap{display:flex;gap:12px;align-items:center}
.ruler{
  width:80px; 
  height:500px; 
  background:#ffffff; 
  border-top: 40px solid #004080;
  border-right: 10px solid #004080; 
  border-bottom: 20px solid #004080;
  border-left: 10px solid #004080; 
  border-radius:10px;
  position:relative;
  box-shadow:0 4px 10px rgba(0,0,0,0.12); 
  margin:auto;
  touch-action:none;
}
.tick { 
  position: absolute; 
  left: 8px; 
  right: 8px; 
  height: 1px; 
  background: rgba(0,0,0,0.5);
}
.label{position:absolute; left:50px; transform:translateX(-100%); color:#000; font-weight:600; font-size:12px}
.slider{
  position:absolute; left:6px; right:6px; height:10px; border-radius:6px; border: 5px solid #000; background:var(--slider);
  display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(0,0,0,0.25);
  touch-action:none; user-select:none; cursor:grab;
  font-weight:600; font-size:13px;
}
.slider .knob {
  width: 17px;
  height: 17px;
  background: blue;
  border: 4px solid #000;
  border-radius: 4px;
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  pointer-events: none;
}
.slider:active{background:#eaeaea}
.led{position: absolute; top: -35px; left: 30%; width:24px; height:24px; border-radius:50%; border: 4px solid #000; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.25)}
.led.white{background:var(--white)}
.led.green{background:var(--green)}
.led.amber{background:var(--amber)}
.led.red{background:var(--red)}
.led.pulse{animation:ledPulse 1s infinite}
@keyframes ledPulse{0%{box-shadow:0 0 6px rgba(255,255,255,0.12)}50%{box-shadow:0 0 18px rgba(0,0,0,0.18)}100%{box-shadow:0 0 6px rgba(255,255,255,0.12)}}
.status{margin-top:10px; display:flex;justify-content:space-between;align-items:center}
.countdown,.total{font-weight:700}
.controls {
  margin-top: 12px;
  display: flex;
  justify-content: center;  /* cƒÉn gi·ªØa theo ngang */
  gap: 12px;               /* kho·∫£ng c√°ch gi·ªØa 2 n√∫t */
  flex-wrap: wrap;          /* xu·ªëng d√≤ng khi m√†n h√¨nh nh·ªè */
}

.btn{background:#fff;border:1px solid #d0d7de;padding:8px 10px;border-radius:8px;cursor:pointer}
.btn.warn{background:#f6d7cf}
.footer{margin-top:14px;font-size:13px;color:#456}

.hidden { display: none; }

/* LED cam nh·∫•p nh√°y theo nh·ªãp ti·∫øng c√≤i (~210ms) */
.led.pulse {
  animation: pulseFlash 1s infinite;
}

@keyframes pulseFlash {
  0%   { opacity: 1; }
  50%  { opacity: 0; }
  100% { opacity: 1; }
}
/* LED ƒë·ªè pulse ri√™ng */
/* Hi·ªáu ·ª©ng ri√™ng cho LED ƒë·ªè ‚Äî ho√†n to√†n t√°ch bi·ªát */
.led-red-alert {
  animation: ledRedFlash 0.5s infinite ease-in-out;
}

@keyframes ledRedFlash {
  0%   { background: #e74c3c; box-shadow: 0 0 6px #e74c3c; }
  50%  { background: #3d0000; box-shadow: 0 0 12px #ff1a1a; }
  100% { background: #e74c3c; box-shadow: 0 0 6px #e74c3c; }
}

/* --- th√™m m√†u t√≠m v√† xanh d∆∞∆°ng cho LED --- */
.led.purple { background: #8e44ad; }   /* t√≠m nh·∫π */
.led.blue   { background: #2980b9; }   /* xanh d∆∞∆°ng */

.pulse-amber {
  animation: amberBlink 1.885s infinite;
}

@keyframes amberBlink {
  0% { opacity: 1; }
  50% { opacity: 0.1; }
  100% { opacity: 1; }
}

.label-left {
  position: absolute;
  left: -110px; /* cƒÉn tr√°i ra ngo√†i 1 ch√∫t, b·∫°n ch·ªânh t√πy √Ω */
  width: 100px;
  color: #004080;
  font-weight: 600;
  font-size: 13px;
  user-select: none;
}

.label-left.top {
  top: 0px; /* g·∫ßn top border */
  left:-125px;
 
}

.label-left.middle {
  top: 51%; 
  left: -130px;
  transform: translateY(-50%);
}

.label-left.bottom {
  bottom: -15px; /* g·∫ßn bottom border */
  left:-130px;
}
.label-right{
  position: absolute;
  left: -110px; /* cƒÉn tr√°i ra ngo√†i 1 ch√∫t, b·∫°n ch·ªânh t√πy √Ω */
  width: 100px;
  color: #004080;
  font-weight: 600;
  font-size: 13px;
  user-select: none;
}

.label-right.top {
  top: 0px; /* g·∫ßn top border */
  left:-118px;
 
}

.label-right.middle {
  top: 49%; 
  left: -118px;
  transform: translateY(-50%);
}

.label-right.bottom {
  bottom: 0px; /* g·∫ßn bottom border */
  left:-118px;
}
/* ==== N√öT ƒê·ªíNG B·ªò ‚Äì SANG TR·ªåNG NH∆Ø iOS ==== */
.btn {
  padding: 8px 14px;
  border-radius: 10px;
  background: #ffffff;
  border: 2px solid #004080;
  color: #004080;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: 0.25s ease;
  box-shadow: 0 2px 4px rgba(0,0,0,0.12);
}

.btn:hover {
  background: #004080;
  color: #ffffff;
  box-shadow: 0 3px 6px rgba(0,0,0,0.18);
}

.btn:active {
  transform: scale(0.96);
}

/* N√∫t c·∫£nh b√°o */
.btn.warn {
  border-color: #b00020;
  color: #b00020;
}

.btn.warn:hover {
  background: #b00020;
  color: white;
}

/* C√°c n√∫t kh√¥ng c√≥ class c≈©ng ƒë∆∞·ª£c ƒë·ªìng b·ªô */
#revBtn {
  padding: 9px 16px;
  border-radius: 10px;
  background: #ffffff;
  border: 2px solid #004080;
  color: #004080;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: 0.25s ease;
  box-shadow: 0 2px 4px rgba(0,0,0,0.12);
}

#revBtn:hover {
  background: #004080;
  color: #ffffff;
  box-shadow: 0 3px 6px rgba(0,0,0,0.18);
}

#revBtn:active {
  transform: scale(0.96);
}
strong {
  font-weight: 1000 !important;
}
/* ensure the container is a single flex row, left part can shrink, right part fixed */
.status{
  margin-top:10px;
  display:flex;
  justify-content:space-between; /* left - right */
  align-items:center;
  gap:12px;
}

/* tr√°i: cho ph√©p co l·∫°i (quan tr·ªçng ƒë·ªÉ kh√¥ng √©p trend xu·ªëng d√≤ng) */
#statusLeft{
  display:flex;
  align-items:center;
  gap:12px;
  flex: 1 1 auto;    /* cho ph√©p chi·∫øm ph·∫ßn c√≤n l·∫°i nh∆∞ng c√≥ th·ªÉ co l·∫°i */
  min-width: 0;      /* quan tr·ªçng: cho ph√©p con b√™n trong tr√†n ·∫©n thay v√¨ √©p wrap */
}

/* ph·∫£i: kh√¥ng gi√£n, lu√¥n b√°m m√©p ph·∫£i */
#statusRight{
  display:flex;
  align-items:center;
  justify-content:flex-end;
  flex: 0 0 auto;
  margin-left: 12px;
  white-space: nowrap;  /* tr√°nh xu·ªëng d√≤ng */
}

/* avgScore kh√¥ng n√™n l√† block chi·∫øm c·∫£ d√≤ng */
#avgScore {
  display: inline-flex;     /* inline, ch·ªâ r·ªông b·∫±ng n·ªôi dung */
  align-items: center;
  gap: 8px;
  white-space: nowrap;      /* gi·ªØ "ƒêi·ªÉm trung b√¨nh: 1.2" nguy√™n 1 kh·ªëi */
  position: relative;       /* n·∫øu c·∫ßn gi·ªØ position nh∆∞ng kh√¥ng b·∫Øt bu·ªôc */
}

/* trend inline ‚Äî KH√îNG d√πng position:absolute; ƒë·ªÉ n√≥ b·ªë tr√≠ b·∫±ng flex */
#avgTrendInline {
  position: static !important;
  right: auto !important;
  top: auto !important;
  transform: none !important;
  font-weight: 700;
  font-size: 15px;
  color: #004080;
  user-select: none;
  white-space: nowrap;
  margin-left: 8px;
}
/* --- CSS GIAO DI·ªÜN NH·∫¨T K√ù CAO C·∫§P --- */

/* Khung t·ª´ng chu k·ª≥ */
.cycle-card {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  margin-bottom: 24px;
  overflow: hidden;
  border: 1px solid #e1e4e8;
}

/* Header c·ªßa Card */
.card-header {
  padding: 12px 16px;
  background: #f8f9fa;
  border-bottom: 1px solid #eee;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.header-left strong { font-size: 16px; color: #004080; }
.header-right { font-weight: bold; font-size: 15px; }

/* M√†u s·∫Øc ƒëi·ªÉm s·ªë */
.score-pos { color: #27ae60; } /* Xanh l√° */
.score-neg { color: #e74c3c; } /* ƒê·ªè */
.score-neu { color: #2980b9; } /* Xanh d∆∞∆°ng */

/* B·∫£ng d·ªØ li·ªáu th√¥ */
.log-container {
  max-height: 220px;
  overflow-y: auto;
  border-bottom: 1px solid #eee;
  background: #ffffff;
}
.log-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}
.log-table th {
  position: sticky;
  top: 0;
  background: #004080;
  color: white;
  padding: 8px;
  font-weight: 500;
  text-align: left;
}
.log-table td {
  padding: 8px;
  border-bottom: 1px solid #f1f1f1;
  color: #333;
}
.log-table tr:nth-child(even) { background-color: #fcfcfc; }

/* Ph·∫ßn Ph·∫£n t∆∞ (KHKT) */
.feedback-area {
  padding: 16px;
  background-color: #fdfdfd;
}
.fb-label {
  font-weight: 700;
  color: #555;
  font-size: 13px;
  margin-top: 10px;
  display: block;
}
.fb-input {
  width: 100%;
  padding: 10px;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  margin-top: 4px;
  font-family: inherit;
  font-size: 14px;
  transition: border 0.2s;
  background: #fff;
}
.fb-input:focus {
  border-color: #004080;
  outline: none;
  box-shadow: 0 0 0 3px rgba(0,64,128,0.1);
}

/* ƒê√°nh gi√° sao */
.rating-box {
  background: #f0f4f8;
  padding: 12px;
  border-radius: 8px;
  margin-top: 15px;
}
.star-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 6px;
  font-size: 13px;
  font-weight: 600;
  color: #444;
}
.stars { cursor: pointer; display: flex; gap: 4px; }
.star { font-size: 22px; color: #cbd5e0; transition: transform 0.1s; }
.star.active { color: #f1c40f; }
.star:hover { transform: scale(1.2); }

/* N√∫t l∆∞u */
.btn-save-research {
width: 100%;
  padding: 12px;
  background: linear-gradient(135deg, #004080 0%, #0066cc 100%);
  color: white;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  font-size: 14px;
  margin-top: 15px;
  cursor: pointer;
  box-shadow: 0 4px 6px rgba(0,64,128,0.2);
  transition: 0.2s;
}
.btn-save-research:active { transform: scale(0.98); }
/* K·∫øt qu·∫£ ƒë√£ l∆∞u */
.saved-data {
  background: #eef9f0;
  border: 1px solid #c3e6cb;
  padding: 12px;
  border-radius: 8px;
  color: #333 !important; /* M√†u ƒëen/x√°m ƒë·∫≠m */
}
.saved-item { margin-bottom: 8px; font-size: 14px; }
.saved-label { font-weight: bold; color: #155724; display: block;}
/* --- B·ªî SUNG: M√ÄU S·∫ÆC ƒê·ªíNG B·ªò LED (5 M√ÄU) --- */
.color-purple { color: #8e44ad !important; font-weight: bold; } /* B·∫£n nƒÉng m·∫°nh */
.color-red    { color: #e74c3c !important; font-weight: bold; } /* B·∫£n nƒÉng v·ª´a */
.color-green  { color: #2ecc71 !important; font-weight: bold; } /* C√¢n b·∫±ng */
.color-blue   { color: #2980b9 !important; font-weight: bold; } /* Si√™u ng√£ v·ª´a */
.color-amber  { color: #FFD700 !important; font-weight: bold; text-shadow: 0px 0px 1px #999;} /* Si√™u ng√£ m·∫°nh */
/* --- CSS CHO EMOJI RATING (THANG LIKERT) --- */
.emoji-section {
  margin-top: 15px;
  padding-top: 10px;
  border-top: 1px dashed #ccc;
}
.emoji-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 8px;
  font-size: 13px;
  font-weight: 600;
  color: #444;
}
.emoji-group {
  display: flex;
  gap: 10px;
}
.emoji-btn {
  font-size: 24px;
  cursor: pointer;
  filter: grayscale(100%); /* M·∫∑c ƒë·ªãnh x√°m */
  opacity: 0.4;
  transition: transform 0.2s, filter 0.2s, opacity 0.2s;
}
.emoji-btn:hover {
  transform: scale(1.2);
  opacity: 0.8;
  filter: grayscale(0%);
}
.emoji-btn.selected {
  transform: scale(1.3);
  opacity: 1;
  filter: grayscale(0%); /* C√≥ m√†u khi ch·ªçn */
}
/* Hi·ªÉn th·ªã k·∫øt qu·∫£ ƒë√£ l∆∞u */
.emoji-result {
  font-weight: bold;
  color: #004080;
}
/* --- B·ªî SUNG: CSS CHO HEADER C·ª¶A B·∫¢NG LOG THEO KHUYNH H∆Ø·ªöNG CHU K·ª≤ --- */

/* B·∫£n nƒÉng m·∫°nh (M√†u T√≠m) */
.cycle-card.color-purple .log-table th { 
    background: #8e44ad; 
    color: white; 
}

/* B·∫£n nƒÉng v·ª´a (M√†u ƒê·ªè) */
.cycle-card.color-red .log-table th { 
    background: #e74c3c; 
    color: white; 
}

/* B·∫£n ng√£ c√¢n b·∫±ng (M√†u Xanh L√°) */
.cycle-card.color-green .log-table th { 
    background: #2ecc71; 
    color: white; 
}

/* Si√™u ng√£ v·ª´a (M√†u Xanh D∆∞∆°ng) */
.cycle-card.color-blue .log-table th { 
    background: #2980b9; 
    color: white; 
}

/* Si√™u ng√£ m·∫°nh (M√†u V√†ng/Amber) - C·∫ßn d√πng ch·ªØ m√†u t·ªëi cho d·ªÖ ƒë·ªçc */
.cycle-card.color-amber .log-table th { 
    background: #FFD700; 
    color: #333; /* Chuy·ªÉn m√†u ch·ªØ sang ƒëen/x√°m ƒë·∫≠m */
}
/* --- B·ªî SUNG: CSS CHO M√ÄU CH·ªÆ "Chu k·ª≥" TRONG HEADER THEO KHUYNH H∆Ø·ªöNG CHU K·ª≤ --- */
/* --- S·ª¨A ƒê·ªîI CSS: TƒÉng ƒë·ªô ∆∞u ti√™n ƒë·ªÉ lo·∫°i tr·ª´ m√†u cho th·ªùi gian/ng√†y th√°ng --- */

/* Nh·∫Øm m·ª•c ti√™u c·ª• th·ªÉ: th·∫ª c√≥ class neutral-text n·∫±m trong card-header, 
   m√† card-header l·∫°i n·∫±m trong cycle-card. */
.cycle-card .card-header .neutral-text { 
    color: #333 !important; /* M√†u ƒëen/x√°m ƒë·∫≠m */
    font-weight: normal !important; /* ƒê·∫£m b·∫£o kh√¥ng b·ªã in ƒë·∫≠m n·∫øu b·ªã ·∫£nh h∆∞·ªüng */
}
/* --- S·ª¨A ƒê·ªîI: Nh·∫Øm m·ª•c ti√™u ch√≠nh x√°c v√†o th·∫ª <strong> ch·ª©a "Chu k·ª≥" --- */

/* B·∫£n nƒÉng m·∫°nh (T√≠m) */
.cycle-card.color-purple .card-header strong { 
    color: #8e44ad !important; 
}

/* B·∫£n nƒÉng v·ª´a (ƒê·ªè) */
.cycle-card.color-red .card-header strong { 
    color: #e74c3c !important; 
}

/* B·∫£n ng√£ c√¢n b·∫±ng (Xanh L√°) */
.cycle-card.color-green .card-header strong { 
    color: #2ecc71 !important; 
}

/* Si√™u ng√£ v·ª´a (Xanh D∆∞∆°ng) */
.cycle-card.color-blue .card-header strong { 
    color: #2980b9 !important; 
}

/* Si√™u ng√£ m·∫°nh (V√†ng/Amber) */
.cycle-card.color-amber .card-header strong { 
    color: #FFD700 !important; 
}
/* --- S·ª¨A ƒê·ªîI CU·ªêI C√ôNG: Reset m√†u cho m·ªçi n·ªôi dung trong b·∫£ng log --- */

/* ·∫®n n√∫t Reset v√¨ Admin ƒë√£ qu·∫£n l√Ω */
#resetBtn { display: none !important; }

</style>
</head>
<body>
<div id="helpModal" style="display:none; position:fixed; top:50%; left:50%; transform: translate(-50%, -50%); width:90%; height:85%; background:#fff; border:2px solid #004080; padding:12px; overflow:auto; z-index:1000; box-shadow:0 4px 12px rgba(0,0,0,0.3);">
  <button id="closeHelp" style="margin-bottom:8px;">ƒê√≥ng</button>
  <pre id="helpText" style="white-space: pre-wrap; font-size:18px;"></pre>
</div>
<!-- Modal Nh·∫≠t k√Ω -->
<div id="reviewModal" style="
  display:none; position:fixed; top:50%; left:50%; transform: translate(-50%, -50%); width:90%; height:85%;
  background:#fff; border:2px solid #004080; padding:12px; overflow:auto;
  z-index:1000; box-shadow:0 4px 12px rgba(0,0,0,0.3);
">
<div id="loginModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:9999; align-items:center; justify-content:center;">
  <div style="background:#fff; padding:25px; border-radius:12px; width:90%; max-width:400px; text-align:center; border: 2px solid #004080; max-height: 90vh; overflow-y: auto;">
    <h3 style="color:#004080; margin-top:0;">üîê TH√îNG TIN NG∆Ø·ªúI D√ôNG TH∆Ø·ªöC (ƒë∆∞·ª£c anh ƒê·∫°t b·∫£o m·∫≠t tuy·ªát ƒë·ªëi) </h3>
    <p style="font-size:13px; color:#555;">Nh·∫≠p th√¥ng tin ƒë·ªÉ ph·ª•c v·ª• vi·ªác thu th·∫≠p d·ªØ li·ªáu cho nghi√™n c·ª©u Khoa h·ªçc K·ªπ thu·∫≠t.</p>
    
    <div style="margin-bottom:10px; text-align:left;">
        <label style="font-size:12px; font-weight:bold;">B·∫°n l√†:</label>
        <select id="inpUserType" onchange="toggleUserFields()" style="width:100%; padding:8px; border:1px solid #ccc; border-radius:5px;">
            <option value="student">H·ªçc sinh</option>
            <option value="resident">Ng∆∞·ªùi d√¢n</option>
        </select>
    </div>

    <input type="text" id="inpName" placeholder="H·ªç v√† T√™n (VD: Nguy·ªÖn VƒÉn A)" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ccc; border-radius:5px;">
    
    <select id="inpGender" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ccc; border-radius:5px;">
        <option value="">-- Ch·ªçn Gi·ªõi t√≠nh --</option>
        <option value="Nam">Nam</option>
        <option value="N·ªØ">N·ªØ</option>
    </select>

    <div id="studentFields">
        <input type="text" id="inpClass" placeholder="L·ªõp (VD: 12/2)" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ccc; border-radius:5px;">
        <input type="text" id="inpSchool" placeholder="Tr∆∞·ªùng (VD: THPT Nguy·ªÖn D·ª•c...)" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ccc; border-radius:5px;">
    </div>

    <div id="residentFields" style="display:none;">
        <input type="text" id="inpPhone" placeholder="S·ªë ƒëi·ªán tho·∫°i" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ccc; border-radius:5px;">
        <input type="text" id="inpAddress" placeholder="ƒê·ªãa ch·ªâ n∆°i ·ªü" style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ccc; border-radius:5px;">
    </div>
    
    <button id="btnLogin" class="btn" style="background:#004080; color:white; width:100%; padding:12px; font-weight:bold; margin-top:10px;">X√ÅC NH·∫¨N V√Ä G·ª¨I TH√îNG TIN</button>
</div>
</div>
  <button id="closeReview" style="margin-bottom:8px;">ƒê√≥ng</button>
<div id="reviewContent" style="font-size:16px;"></div>
</div>

<div class="container">
  <header>
    <div>
      <h1>TH∆Ø·ªöC PH·∫¢N T∆Ø T√ÇM L√ù V√Ä KH∆†I D·∫¨Y NH√ÇN T√çNH L√ÄM NG∆Ø·ªúIüñ§üïäÔ∏è</h1>
      <small><em><b>(L·∫•y c·∫£m h·ª©ng t·ª´ thuy·∫øt Ph√¢n T√¢m h·ªçc c·ªßa Sigmund Freud)</b></em></small>
    </div>
  </header>

  <div class="ruler-wrap">
  
    <div style="flex:1">
      <div id="ruler" class="ruler">
      <div class="label-left top" style="font-size:14px; color:rgb(255,215,0)" align="center">üòá<b> SI√äU NG√É (+10000)</b></div>
<div class="label-left middle" style="font-size:14px" align="center"><svg width="24" height="24" viewBox="0 0 24 17" fill="#004080" xmlns="http://www.w3.org/2000/svg">
  <circle cx="12" cy="7" r="4"/>
  <path d="M12 14c-5 0-8 2.5-8 5v1h16v-1c0-2.5-3-5-8-5z"/>
</svg>
<b>B·∫¢N <span style="color:rgb(255,215,0)">NG√É</span> (0)</b></div>
<div class="label-left bottom" style="font-size:14px" align="center">üòà<b> B·∫¢N NƒÇNG (-10000)</b></div>

        <div id="led" class="led" title="LED tr·∫°ng th√°i"></div>
        <div id="slider" class="slider">
          &nbsp;‚¨áÔ∏é
          <div class="knob"></div>
        </div>
      </div>
    </div>
  </div>
<div class="status">
  <div id="statusLeft" style="display:flex; align-items:center; gap:12px;">
    <div id="countdownWrap">Th·ªùi gian c√≤n l·∫°i: <span id="countdown" class="countdown">--</span></div>
    <div id="avgScore" style="display:none; position:relative;">
      <div id="avgTextWrap"><strong>ƒêi·ªÉm TB:</strong> <span id="avg" class="total">0.0</span></div>
    </div>
  </div>

  <!-- v√πng c·ªë ƒë·ªãnh ·ªü ph·∫£i ƒë·ªÉ hi·ªÉn th·ªã trend (lu√¥n s√°t m√©p ph·∫£i) -->
  <div id="statusRight" style="min-width:0; display:flex; align-items:center; justify-content:flex-end;"></div>
</div>

</div>

  <div class="controls">
    <button id="resetBtn" class="btn warn">Reset</button>
    <button id="revBtn">H·ªìi v·ªã</button>
    <button id="helpBtn" class="btn">H∆∞·ªõng d·∫´n</button>
    <button id="reviewBtn" class="btn">Nh·∫≠t k√Ω</button>

  </div>

  <div class="footer">
    <strong>L∆∞u √Ω:</strong> Th∆∞·ªõc ch·ªâ c√≥ t√°c d·ª•ng soi chi·∫øu xu h∆∞·ªõng n·ªôi t√¢m v√† gi√°o d·ª•c t·ª± ph·∫£n t∆∞, kh√¥ng d√πng ƒë·ªÉ ph√°n x√©t nh√¢n c√°ch, kh√¥ng th·ªÉ thay th·∫ø ƒëi·ªÅu tr·ªã t√¢m l√Ω chuy√™n m√¥n. H√£y th·∫≠t <strong>trung th·ª±c</strong> v·ªõi b·∫£n th√¢n m√¨nh khi g·∫°t th∆∞·ªõc ƒë·ªÉ c√≥ k·∫øt qu·∫£ h·ª£p l√Ω. ƒê·ªçc kƒ© h∆∞·ªõng d·∫´n s·ª≠ d·ª•ng tr∆∞·ªõc khi d√πng.
  </div>
</div>

<script>
const firebaseConfig = { 
  apiKey : "AIzaSyBvSBloHwRCvWNzt37ThhxuPqVqgQfohlo" , 
  authDomain : "freudruler.firebaseapp.com" , 
  databaseURL : "https://freudruler-default-rtdb.asia-southeast1.firebasedatabase.app" , 
  projectId : "freudruler" , 
  storageBucket : "freudruler.firebasestorage.app" , 
  messagingSenderId : "907969291678" , 
  appId : "1:907969291678:web:e0e99eb6550a31bd42a28f" , 
  measurementId : "G-69JD3RTJQH" 
};

// Kh·ªüi t·∫°o Firebase
let db;
try {
    firebase.initializeApp(firebaseConfig);
    db = firebase.database();
} catch(e) { console.error("Firebase Init Error", e); }
// --- L·∫ÆNG NGHE C·∫§U H√åNH T·ª™ ADMIN (QUAN TR·ªåNG) ---
const sysConfigRef = db.ref('system_config');

sysConfigRef.on('value', (snap) => {
    const conf = snap.val();
    if (!conf) return;

    const adminStart = conf.startTime; // Timestamp Admin ch·ªçn
    const adminDur = conf.durationMs;  // Th·ªùi l∆∞·ª£ng Admin ch·ªçn

    // C·∫≠p nh·∫≠t bi·∫øn to√†n c·ª•c
    MS_COUNTDOWN = adminDur;
    
    // KI·ªÇM TRA: N·∫øu th·ªùi gian b·∫Øt ƒë·∫ßu c·ªßa Admin KH√ÅC v·ªõi th·ªùi gian hi·ªán t·∫°i c·ªßa User
    // => Nghƒ©a l√† Admin ƒë√£ ph√°t ƒë·ªông m·ªôt chu k·ª≥ m·ªõi
    if (state.startTimestamp !== adminStart) {
        console.log("Ph√°t hi·ªán chu k·ª≥ m·ªõi t·ª´ Admin. ƒêang ƒë·ªìng b·ªô...");
        
        // 1. N·∫øu chu k·ª≥ c≈© ƒëang ch·∫°y ho·∫∑c ƒë√£ xong, h√£y ƒë·∫£m b·∫£o d·ªØ li·ªáu c≈© an to√†n
        // (L∆∞u √Ω: Logic finishCycle c·ªßa b·∫°n ƒë√£ t·ª± l∆∞u v√†o finishedCycles r·ªìi)
        
        // 2. Reset tr·∫°ng th√°i v·ªÅ 'running' v·ªõi m·ªëc th·ªùi gian M·ªöI
        state.status = 'running';
        state.startTimestamp = adminStart;
        state.entries = []; // X√≥a nh·∫≠t k√Ω c≈© ƒë·ªÉ b·∫Øt ƒë·∫ßu m·ªõi
        
        // 3. Reset giao di·ªán
        LED_clear();
        placeSliderAtValue(0);
        document.getElementById('avgScore').style.display = 'none';
        
        // 4. L∆∞u l·∫°i tr·∫°ng th√°i m·ªõi
        saveCurrentCycle();
        
        alert("üîî TH√îNG B√ÅO: H·ªá th·ªëng ƒë√£ b·∫Øt ƒë·∫ßu m·ªôt chu k·ª≥ ph·∫£n t∆∞ m·ªõi!");
    }
    
    // C·∫≠p nh·∫≠t l·∫°i countdown ngay l·∫≠p t·ª©c
    updateCountdown();
});

// Bi·∫øn l∆∞u ID ng∆∞·ªùi d√πng
let USER_ID = localStorage.getItem('FREUD_USER_ID') || null;
let USER_INFO = JSON.parse(localStorage.getItem('FREUD_USER_INFO') || 'null');
const CURRENT_CYCLE_KEY = 'freudRuler_current_cycle'; // Kh√≥a l∆∞u tr·∫°ng th√°i chu k·ª≥ ƒëang ch·∫°y
const FINISHED_CYCLES_KEY = 'freudRuler_cycles_history'; // Kh√≥a l∆∞u L·ªäCH S·ª¨ Vƒ®NH VI·ªÑN

function loadFinishedCycles() {
    try {
        const cycles = localStorage.getItem(FINISHED_CYCLES_KEY);
        return cycles ? JSON.parse(cycles) : [];
    } catch (e) {
        console.error("Could not load finished cycles", e);
        return [];
    }
}

function saveFinishedCycles(cycles) {
    try {
        localStorage.setItem(FINISHED_CYCLES_KEY, JSON.stringify(cycles));
        if(typeof syncDataToServer === 'function') syncDataToServer();
    } catch (e) {
        console.error("Could not save finished cycles", e);
    }
}

function loadCurrentCycle() {
    try {
        const current = localStorage.getItem(CURRENT_CYCLE_KEY);
        if (current) return JSON.parse(current);
    } catch (e) {
        console.error("Could not load current cycle", e);
    }
    // Tr·∫£ v·ªÅ state m·∫∑c ƒë·ªãnh n·∫øu kh√¥ng c√≥ d·ªØ li·ªáu
   return { status:'idle', startTimestamp:null, entries:[] };
}

function saveCurrentCycle() {
    try {
        const dataToSave = {
            status: state.status,
            startTimestamp: state.startTimestamp,
            entries: state.entries
        };
        localStorage.setItem(CURRENT_CYCLE_KEY, JSON.stringify(dataToSave));
    } catch (e) {
        console.error("Could not save current cycle", e);
    }
}

const STORAGE_KEY = 'freudRuler_v2';
// Thay ƒë·ªïi: Bi·∫øn ƒë·ªông, kh√¥ng c√≤n l√† h·∫±ng s·ªë
let MS_COUNTDOWN = 7*24*60*60*1000; // M·∫∑c ƒë·ªãnh, s·∫Ω b·ªã ghi ƒë√® b·ªüi Admin
let SYSTEM_START_TIME = 0; // L∆∞u m·ªëc th·ªùi gian Admin ƒë·∫∑t
const MIN_VALUE = -10000, MAX_VALUE = 10000;
let audioEnabled = true;

const LED = document.getElementById('led');
const slider = document.getElementById('slider');
const ruler = document.getElementById('ruler');
const countdownEl = document.getElementById('countdown');
const totalEl = document.getElementById('total');
const resetBtn = document.getElementById('resetBtn');
const helpBtn = document.getElementById('helpBtn');
let state = loadCurrentCycle(); // T·∫£i chu k·ª≥ ƒëang ch·∫°y d·ªü (n·∫øu c√≥)
state.finishedCycles = loadFinishedCycles(); // T·∫£i l·ªãch s·ª≠ Vƒ®NH VI·ªÑN
// √Çm thanh
// Ghi nh·∫≠n 1 l·∫ßn g·∫°t trong chu k·ª≥

// --- H√ÄM GI√öP: L·∫§Y NH√ÉN CHO M·ª®C ƒêI·ªÇM ---
// Tr·∫£ v·ªÅ object {key,label,emoji} d√πng kh·∫Øp n∆°i
function getCategoryFromValue(v) {
    const n = Number(v || 0);
    if (n <= -6667) return { key: 'bn_manh', label: 'B·∫£n nƒÉng m·∫°nh', emoji: 'üòà' };
    if (n <= -3334) return { key: 'bn_vua',  label: 'B·∫£n nƒÉng v·ª´a',  emoji: 'üî•' };
    if (n >= 6667)  return { key: 'sn_manh', label: 'Si√™u ng√£ m·∫°nh',  emoji: 'üòá' };
    if (n >= 3334)  return { key: 'sn_vua',  label: 'Si√™u ng√£ v·ª´a',   emoji: 'üïäÔ∏è' };
    return { key: 'ego', label: 'B·∫£n ng√£', emoji: 'üë§' };
}

function logEntry(value) {
    const now = new Date();
    const cat = getCategoryFromValue(value);
    const entry = {
        value: value,
        dir: cat.label,
        time: now.toLocaleTimeString('vi-VN'),
        date: now.toLocaleDateString('vi-VN')
    };

    state.entries.push(entry);
    saveCurrentCycle();
}

function playBeep(freq=880, dur=0.12, vol=0.15){
  if(!audioEnabled) return;
  const ctx = new (window.AudioContext||window.webkitAudioContext)();
  const o = ctx.createOscillator(); const g = ctx.createGain();
  o.type='sine'; o.frequency.value=freq; g.gain.value=vol;
  o.connect(g); g.connect(ctx.destination);
  o.start(); o.stop(ctx.currentTime+dur);
}

// Chuy·ªÉn value <-> y
function getInnerH() {
  return ruler.clientHeight; 
}

function valueToY(value) {
  const innerH = ruler.clientHeight;          
  const sliderH = slider.offsetHeight || 20;  

  const top = sliderH / 2;
  const bottom = innerH - sliderH / 2;

  const ratio = (value - MIN_VALUE) / (MAX_VALUE - MIN_VALUE);
  const centerY = top + ratio * (bottom - top);
  return centerY - sliderH / 2;
}

function yToValue(centerY) {
  const innerH = ruler.clientHeight;
  const sliderH = slider.offsetHeight || 20;

  const top = sliderH / 2;
  const bottom = innerH - sliderH / 2;

  const c = Math.min(bottom, Math.max(top, centerY));
  const ratio = (c - top) / (bottom - top); // 0..1

  // FIX NG∆Ø·ª¢C CHI·ªÄU ‚Üí kh√¥ng c√≤n l·ªói 10000/-10000 sai v·ªã tr√≠
  return Math.round(MAX_VALUE - ratio * (MAX_VALUE - MIN_VALUE));
}

function clamp(v,a,b){return Math.min(Math.max(v,a),b);}

// LED helpers
function LED_setClass(cls) {
  LED.className = 'led ' + cls;
}
function LED_clear() {
  LED.className = 'led';
  LED.style.background = '#222';
  LED.style.opacity = '1';
  // lo·∫°i b·ªè t·∫•t c·∫£ class hi·ªáu ·ª©ng c√≥ th·ªÉ c√≤n s√≥t
  LED.classList.remove('led-red-alert','pulse','pulse-amber','purple','blue','red','green','amber');
}


// Tick & label
function renderTicks() {
  ruler.querySelectorAll('.tick,.label').forEach(n => n.remove());

  const tickCount = 21;
  const innerHeight = ruler.clientHeight - 1;
  const spacing = innerHeight / (tickCount - 1);

  for (let i = 0; i < tickCount; i++) {
    const t = document.createElement('div');
    t.className = 'tick';
    t.style.top = (i * spacing) + 'px';
    ruler.appendChild(t);
  }
}



// --- Thay th·∫ø: initSlider() (PHI√äN B·∫¢N S·ª¨A) ---
let dragging = false;
let dragOffset = 0;
let moved = false;
let startY = 0;
let currentValue = null;

// Bi·∫øn c·ªù b·ªï sung (ƒë·∫∑t c·∫°nh n∆°i b·∫°n khai b√°o currentValue)
let suppressNextClick = false;
let pendingConfirmTimer = null;   // <-- h·∫πn ghi sau khi ng·ª´ng k√©o
let lastConfirmAt = 0;            // <-- b·∫£o v·ªá ch·ªëng double-confirm qu√° nhanh
// --- LOGIC ONLINE & ƒê·ªíNG B·ªò ---

// 1. H√†m t·∫°o ID chu·∫©n t·ª´ t√™n (x√≥a d·∫•u, n·ªëi li·ªÅn)
function sanitizeId(str) {
    return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "")
              .replace(/[^a-zA-Z0-9]/g, "").toLowerCase();
}

// 2. H√†m ƒë·∫©y d·ªØ li·ªáu l√™n Server
function syncDataToServer() {
    if (!db || !USER_ID) return;
    
    // L·∫•y to√†n b·ªô d·ªØ li·ªáu quan tr·ªçng
    const allData = {
        profile: USER_INFO,
        lastActive: firebase.database.ServerValue.TIMESTAMP, // Th·ªùi gian c·∫≠p nh·∫≠t cu·ªëi
        currentStatus: 'online', // ƒêang online
        currentCycle: state,     // Chu k·ª≥ ƒëang ch·∫°y
        history: loadFinishedCycles() // L·∫•y to√†n b·ªô l·ªãch s·ª≠ (Chu k·ª≥ 1, 2...)
    };

    // G·ª≠i l√™n path: users/[USER_ID]
    db.ref('users/' + USER_ID).update(allData).then(() => {
        console.log("‚úÖ ƒê√£ ƒë·ªìng b·ªô l√™n m√¢y!");
    }).catch(err => console.error("L·ªói ƒë·ªìng b·ªô:", err));
}

// 3. H√†m theo d√µi tr·∫°ng th√°i (Online/Offline)
function initPresence() {
    if (!db || !USER_ID) return;
    
    const userStatusRef = db.ref('users/' + USER_ID + '/currentStatus');
    const lastSeenRef = db.ref('users/' + USER_ID + '/lastActive');
    const connectedRef = db.ref('.info/connected');

    connectedRef.on('value', (snap) => {
        if (snap.val() === false) return;
        
        // Khi m·∫•t k·∫øt n·ªëi th√¨ set status = offline v√† l∆∞u gi·ªù
        userStatusRef.onDisconnect().set('offline');
        lastSeenRef.onDisconnect().set(firebase.database.ServerValue.TIMESTAMP);
        
        // Khi ƒëang k·∫øt n·ªëi th√¨ set status = online
        userStatusRef.set('online');
        lastSeenRef.set(firebase.database.ServerValue.TIMESTAMP);
    });
}

// 4. X·ª≠ l√Ω ƒêƒÉng nh·∫≠p
const loginModal = document.getElementById('loginModal');
const btnLogin = document.getElementById('btnLogin');

if (!USER_ID) {
    // N·∫øu ch∆∞a c√≥ ID -> Hi·ªán Modal b·∫Øt bu·ªôc nh·∫≠p
    loginModal.style.display = 'flex';
} else {
    // ƒê√£ c√≥ -> Ch·∫°y t√≠nh nƒÉng online
    initPresence();
    syncDataToServer(); // ƒê·ªìng b·ªô ngay khi v√†o
}
// H√†m ·∫©n hi·ªán tr∆∞·ªùng nh·∫≠p li·ªáu d·ª±a tr√™n lo·∫°i ƒë·ªëi t∆∞·ª£ng
function toggleUserFields() {
    const type = document.getElementById('inpUserType').value;
    const studentDiv = document.getElementById('studentFields');
    const residentDiv = document.getElementById('residentFields');

    if (type === 'student') {
        studentDiv.style.display = 'block';
        residentDiv.style.display = 'none';
    } else {
        studentDiv.style.display = 'none';
        residentDiv.style.display = 'block';
    }
}
btnLogin.onclick = () => {
    // 1. L·∫•y d·ªØ li·ªáu chung
    const type = document.getElementById('inpUserType').value;
    const name = document.getElementById('inpName').value.trim();
    const gender = document.getElementById('inpGender').value;

    // 2. L·∫•y d·ªØ li·ªáu ri√™ng
    const cls = document.getElementById('inpClass').value.trim();
    const school = document.getElementById('inpSchool').value.trim();
    const phone = document.getElementById('inpPhone').value.trim();
    const address = document.getElementById('inpAddress').value.trim();

    // 3. Validation (Ki·ªÉm tra d·ªØ li·ªáu)
    if (!name || !gender) {
        alert("Vui l√≤ng nh·∫≠p H·ªç t√™n v√† ch·ªçn Gi·ªõi t√≠nh!");
        return;
    }

    let uniquePart = ""; // Ph·∫ßn d√πng ƒë·ªÉ t·∫°o ID duy nh·∫•t
    let finalProfile = {}; // Object l∆∞u th√¥ng tin

    if (type === 'student') {
        // Logic cho H·ªçc sinh
        if (!cls || !school) {
            alert("H·ªçc sinh vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß L·ªõp v√† Tr∆∞·ªùng!");
            return;
        }
        uniquePart = sanitizeId(cls) + "_" + sanitizeId(school);
        
        finalProfile = {
            fullName: name,
            gender: gender,
            userType: 'H·ªçc sinh',
            className: cls,   // Gi·ªØ field n√†y ƒë·ªÉ Admin c≈© v·∫´n hi·ªán L·ªõp
            schoolName: school,
            birthYear: ''     // B·ªè tr·ªëng ho·∫∑c ƒë·ªÉ chu·ªói r·ªóng
        };

    } else {
        // Logic cho Ng∆∞·ªùi d√¢n
        if (!phone || !address) {
            alert("Vui l√≤ng nh·∫≠p S·ªë ƒëi·ªán tho·∫°i v√† ƒê·ªãa ch·ªâ!");
            return;
        }
        uniquePart = sanitizeId(phone); // D√πng SƒêT l√†m ID duy nh·∫•t

        finalProfile = {
            fullName: name,
            gender: gender,
            userType: 'Ng∆∞·ªùi d√¢n',
            className: 'Ng∆∞·ªùi d√¢n', // ƒê·ªÉ hi·ªÉn th·ªã tr√™n Admin cho d·ªÖ hi·ªÉu
            phone: phone,
            address: address,
            birthYear: '' 
        };
    }

    // 4. T·∫°o ID v√† L∆∞u
    // ID = ten_uniquePart (VD: nguyenvanan_12a1_thptchuyen ho·∫∑c nguyenvanb_0912345678)
    const rawId = sanitizeId(name) + "_" + uniquePart;
    
    USER_ID = rawId;
    USER_INFO = finalProfile;
    
    // L∆∞u v√†o localStorage vƒ©nh vi·ªÖn
    localStorage.setItem('FREUD_USER_ID', USER_ID);
    localStorage.setItem('FREUD_USER_INFO', JSON.stringify(USER_INFO));
    
    // ·∫®n modal v√† b·∫Øt ƒë·∫ßu ƒë·ªìng b·ªô
    loginModal.style.display = 'none';
    initPresence();
    syncDataToServer();
    
    alert("‚úÖ ƒê√£ k√≠ch ho·∫°t h·ªì s∆° th√†nh c√¥ng!");
};

function initSlider(){
  renderTicks();
  requestAnimationFrame(()=> placeSliderAtValue(0));

  // pointerdown
  slider.addEventListener('pointerdown', e=>{
    // N·∫øu ƒëang c√≥ 1 pending confirm (v·ª´a h·∫πn), hu·ª∑ n√≥: ng∆∞·ªùi d√πng t∆∞∆°ng t√°c l·∫°i
    if (pendingConfirmTimer) {
      clearTimeout(pendingConfirmTimer);
      pendingConfirmTimer = null;
    }

    dragging = true;
    moved = false;
    slider.setPointerCapture(e.pointerId);
    slider.style.cursor = 'grabbing';

    startY = e.clientY;
    const sliderTop = parseFloat(slider.style.top) || 0;
    dragOffset = e.clientY - (ruler.getBoundingClientRect().top + sliderTop);
  });

  // pointermove
  document.addEventListener('pointermove', e=>{
    if(!dragging) return;

    // ch·ªâ coi l√† "k√©o" khi di chuy·ªÉn > 10px
    if (Math.abs(e.clientY - startY) > 10) {
      moved = true;
    }

    const sliderHeight = slider.getBoundingClientRect().height;
    const rect = ruler.getBoundingClientRect();

    const minY = 0;
    const maxY = ruler.clientHeight - sliderHeight;

    let y = e.clientY - rect.top - dragOffset;
    y = clamp(y, minY, maxY);

    slider.style.top = y + 'px';

    // c·∫≠p nh·∫≠t currentValue ƒë·ªÉ l∆∞u khi pointerup ho·∫∑c khi h·∫πn confirm
    const centerY = y + slider.offsetHeight / 2;
    currentValue = yToValue(centerY);
  });

  // pointerup
  document.addEventListener('pointerup', e=>{
    // lu√¥n reset tr·∫°ng th√°i k√©o
    dragging = false;
    slider.style.cursor = 'grab';

    // N·∫øu l√† K√âO (moved === true) ‚Üí KH√îNG G·ªåI confirmEntry NGAY.
    // Thay b·∫±ng: h·∫πn 1 l·∫ßn confirm sau 450ms n·∫øu kh√¥ng c√≥ t∆∞∆°ng t√°c l·∫°i.
    if (moved) {
      // ƒë·∫£m b·∫£o currentValue c√≥ gi√° tr·ªã ƒë√∫ng (d·ª± ph√≤ng)
      if (typeof currentValue === 'undefined' || currentValue === null) {
        const y = slider.offsetTop + slider.offsetHeight/2;
        currentValue = yToValue(y);
      }

      // clear c≈© n·∫øu c√≥
      if (pendingConfirmTimer) {
        clearTimeout(pendingConfirmTimer);
        pendingConfirmTimer = null;
      }

      

      // reset moved sau 600ms ƒë·ªÉ tr√°nh va ch·∫°m v·ªõi click handler
      setTimeout(()=> { moved = false; }, 600);

    } else {
      // kh√¥ng ph·∫£i k√©o (ch·ªâ nh·∫•n) ‚Üí click handler s·∫Ω x·ª≠ l√Ω
    }
  });

  // click
  slider.addEventListener('click', e=>{
    // N·∫øu v·ª´a c√≥ pendingConfirm (s·∫Øp ghi) th√¨ h√£y hu·ª∑ pending v√† kh√¥ng ghi ·ªü click,
    // ho·∫∑c n·∫øu pending ƒë√£ ch·∫°y th√¨ suppressNextClick s·∫Ω ch·∫∑n click.
    if (pendingConfirmTimer) {
      // Ng∆∞·ªùi d√πng click ngay sau khi th·∫£ ‚Äî kh·∫£ nƒÉng h·ªç mu·ªën click thay v√¨ ghi t·ª± ƒë·ªông.
      // T·ªët nh·∫•t l√† hu·ª∑ pending v√† x·ª≠ l√Ω click nh∆∞ 1 nh·∫•n (ghi ngay l·∫≠p t·ª©c).
      clearTimeout(pendingConfirmTimer);
      pendingConfirmTimer = null;
      // ti·∫øp t·ª•c x·ª≠ l√Ω ti·∫øp (kh√¥ng return) ‚Üí s·∫Ω g·ªçi confirmEntry() ·ªü d∆∞·ªõi
    }

    // N·∫øu v·ª´a b·ªã suppress (v·ª´a ghi ·ªü pending) ‚Üí b·ªè qua click
    if (suppressNextClick) {
      e.stopPropagation();
      e.preventDefault();
      return;
    }

    // N·∫øu c√≥ k√©o (moved = true) ‚Üí KH√îNG t√≠nh ƒëi·ªÉm (k√©o ƒë√£ l√™n l·ªãch x·ª≠ l√Ω)
    if (moved) {
      e.stopPropagation();
      return;
    }

    // Kh√¥ng k√©o ‚Üí l√† NH·∫§N ‚Üí t√≠nh ƒëi·ªÉm ngay
    confirmEntry();
  });
}




// ƒê·∫∑t slider theo value
function placeSliderAtValue(v){
  slider.style.top = valueToY(v) + 'px';
}

// Khi nh·∫•n confirm

function confirmEntry(){
  if(state.status!=='running'){
    alert('Nh·∫•n Reset ƒë·ªÉ ƒë∆∞a T·ªïng ƒëi·ªÉm v·ªÅ 0 v√† b·∫Øt ƒë·∫ßu l·∫°i chu k√¨ 1 tu·∫ßn t·ª± ph·∫£n t∆∞.');
    return;
  }

  const rect = ruler.getBoundingClientRect();
  const sliderRect = slider.getBoundingClientRect();
  // centerY t√≠nh theo kh√¥ng gian N·ªòI B·ªò c·ªßa ruler (client space)
  const y = slider.offsetTop + slider.offsetHeight/2;

  const v = yToValue(y);
// ---------- HI·ªÜN ƒêI·ªÇM T·ª®C TH·ªúI (show instant score) - S·ª¨A: ƒë·ªìng b·ªô m√†u v·ªõi LED ----------
let inst = document.getElementById('instantScore');

// danh s√°ch class m√†u text (t∆∞∆°ng ·ª©ng ƒë√£ c√≥ trong CSS)
const instantColorClasses = ['color-purple','color-red','color-green','color-blue','color-amber'];

// mapping category -> class v√† m√†u d·ª± ph√≤ng (inline)
const instantMap = {
  'bn_manh': { cls: 'color-purple', color: '#8e44ad' },
  'bn_vua' : { cls: 'color-red',    color: '#e74c3c' },
  'ego'    : { cls: 'color-green',  color: '#2ecc71' },
  'sn_vua' : { cls: 'color-blue',   color: '#2980b9' },
  'sn_manh': { cls: 'color-amber',  color: '#FFD700' }
};

// 1. T·∫°o ph·∫ßn t·ª≠ n·∫øu ch∆∞a c√≥
if(!inst){
  inst = document.createElement('div');
  inst.id = 'instantScore';

  // CSS cho √¥ n·ªïi trong su·ªët (gi·ªØ nguy√™n c√°c style b·∫°n mu·ªën)
  inst.style.position = 'absolute';
  inst.style.fontWeight = '800';
  inst.style.fontSize = '35px';
  inst.style.lineHeight = '1';
  inst.style.padding = '0';
  inst.style.background = 'transparent';
  inst.style.pointerEvents = 'none';
  inst.style.zIndex = '100';
  inst.style.transition = 'all 0.6s ease-out';
  inst.style.whiteSpace = 'nowrap';
  inst.style.opacity = '0';

  // ch√∫ √Ω g·∫Øn v√†o ruler ƒë·ªÉ to·∫° ƒë·ªô ƒÉn theo slider
  document.getElementById('ruler').appendChild(inst);
}

// 2. T√≠nh to√°n v·ªã tr√≠: N·∫±m ngay tr√™n ƒë·∫ßu slider
const currentSliderTop = parseFloat(slider.style.top) || slider.offsetTop;
inst.style.left = '50%';
inst.style.transform = 'translateX(-50%)';
inst.style.top = (currentSliderTop - 35) + 'px';

// 3. N·ªôi dung hi·ªÉn th·ªã + ƒë·ªìng b·ªô m√†u
const cat = getCategoryFromValue(v);
inst.textContent = (v > 0 ? '+' : '') + v + ' ' + cat.emoji;

// remove m·ªçi class m√†u c≈© r·ªìi √°p class m·ªõi (d·ª±ng tr√™n CSS b·∫°n ƒë√£ c√≥)
inst.classList.remove(...instantColorClasses);
const cfg = instantMap[cat.key] || instantMap['ego'];
if (cfg && cfg.cls) inst.classList.add(cfg.cls);

// fallback inline color (n·∫øu CSS b·ªã ghi ƒë√®)
if (cfg && cfg.color) {
  inst.style.color = cfg.color;
} else {
  inst.style.color = '#004080';
}

// (tu·ª≥ ch·ªçn) ƒëi·ªÅu ch·ªânh text-shadow ƒë·ªÉ ch·ªØ d·ªÖ ƒë·ªçc tr√™n n·ªÅn s√°ng khi m√†u v√†ng
if (cat.key === 'sn_manh') {
  inst.style.textShadow = '0 1px 2px rgba(0,0,0,0.6)';
} else {
  inst.style.textShadow = '0 2px 4px rgba(255,255,255,0.8), 0 0 10px #fff';
}

// 4. K√≠ch ho·∫°t hi·ªáu ·ª©ng bay l√™n (gi·ªØ logic c≈©)
inst.style.display = 'block';
inst.style.opacity = '1';
inst.style.transition = 'none';
inst.style.top = (currentSliderTop - 35) + 'px';
void inst.offsetWidth;
inst.style.transition = 'all 0.6s ease-out';
inst.style.top = (currentSliderTop - 80) + 'px';
inst.style.opacity = '0';

// 5. D·ªçn d·∫πp sau khi animation xong
if (inst._hideTimeout) clearTimeout(inst._hideTimeout);
inst._hideTimeout = setTimeout(()=> {
  inst.style.display = 'none';
}, 1000);
// ---------- K·∫æT TH√öC PH·∫¶N HI·ªÇN TH·ªä ƒêI·ªÇM T·ª®C TH·ªúI ----------


  // L∆∞u entry v·ªõi nh√£n chi ti·∫øt
  state.entries.push({
    ts: Date.now(),
    value: v,
    dir: getCategoryFromValue(v).label,
    time: new Date().toLocaleTimeString('vi-VN'),
    date: new Date().toLocaleDateString('vi-VN')
  });
  saveCurrentCycle();

  flashLedForValue(v);
  playBeep();
  slider.style.transition='top 0.25s ease';
  setTimeout(()=>slider.style.transition='',300);
}

// Thay th·∫ø flashWhite() b·∫±ng flashLedForValue(value)
// Nh√°y LED v·ªõi m√†u t∆∞∆°ng ·ª©ng m·ªói l·∫ßn ghi ƒëi·ªÉm t·ª©c th·ªùi
function flashLedForValue(value) {
  // ƒë·∫£m b·∫£o x√≥a m·ªçi l·ªõp/hi·ªáu ·ª©ng tr∆∞·ªõc
  LED.classList.remove('red','amber','green','pulse','led-red-alert','pulse-amber','purple','blue');
  LED.style.transition = 'none';

  // x√°c ƒë·ªãnh lo·∫°i d·ª±a tr√™n gi√° tr·ªã
  const cat = getCategoryFromValue(value);

  // g√°n m√†u + hi·ªáu ·ª©ng ng·∫Øn theo category
  switch (cat.key) {
    case 'bn_manh': // B·∫£n nƒÉng m·∫°nh -> t√≠m nh·∫•p nh√°y
      LED.classList.add('purple','pulse');
      LED.style.background = '#8e44ad';
      LED.style.animationDuration = '1.6s';
      break;
    case 'bn_vua': // B·∫£n nƒÉng v·ª´a -> ƒë·ªè nh·∫•p nh√°y
      LED.classList.add('red','pulse');
      LED.style.background = '#e74c3c';
      LED.style.animationDuration = '1.6s';
      break;
    case 'ego': // B·∫£n ng√£ -> xanh l√° tƒ©nh
      LED.classList.add('green');
      LED.style.background = '#2ecc71';
      // lo·∫°i b·ªè pulse n·∫øu c√≥
      LED.classList.remove('pulse','led-red-alert','pulse-amber');
      break;
    case 'sn_vua': // Si√™u ng√£ v·ª´a -> xanh d∆∞∆°ng nh·∫•p nh√°y
      LED.classList.add('blue','pulse');
      LED.style.background = '#2980b9';
      LED.style.animationDuration = '1.6s';
      break;
    case 'sn_manh': // Si√™u ng√£ m·∫°nh -> v√†ng/amber nh·∫•p nh√°y
      LED.classList.add('amber','pulse-amber');
      LED.style.background = '#FFD700';
      LED.style.animationDuration = '1.6s';
      break;
    default:
      // fallback: tr·∫Øng nh∆∞ c≈© (ch·ªâ ph√≤ng tr∆∞·ªùng h·ª£p)
      LED.style.background = '#ffffff';
      break;
  }

  // hi·ªÉn th·ªã s√°ng trong 120ms r·ªìi m·ªù d·∫ßn t∆∞∆°ng t·ª± logic tr∆∞·ªõc
  LED.style.opacity = '1';
  setTimeout(() => {
    LED.style.transition = 'opacity 0.15s';
    LED.style.opacity = '0.25';
  }, 120);

  // sau 250ms, reset LED v·ªÅ tr·∫°ng th√°i m·∫∑c ƒë·ªãnh (kh√¥ng ph√° finishCycle)
  setTimeout(() => {
    LED_clear();
    LED.style.opacity = '1';
  }, 250);
}


function updateCountdown() {
    // N·∫øu ch∆∞a nh·∫≠n ƒë∆∞·ª£c d·ªØ li·ªáu t·ª´ Admin th√¨ ch∆∞a l√†m g√¨
    if (!state.startTimestamp) {
        countdownEl.textContent = "ƒêang ƒë·ªìng b·ªô...";
        return;
    }

    const now = Date.now();
    const endTime = state.startTimestamp + MS_COUNTDOWN;
    const rem = endTime - now;

    // --- LOGIC M·ªöI: T·ª∞ ƒê·ªòNG K·∫æT TH√öC ---
    // N·∫øu h·∫øt gi·ªù V√Ä tr·∫°ng th√°i v·∫´n ƒëang l√† 'running' -> √âp bu·ªôc k·∫øt th√∫c ngay
    if (rem <= 0) {
        countdownEl.textContent = "00 ng√†y 00:00:00";
        if (state.status === 'running') {
            console.log("H·∫øt gi·ªù! T·ª± ƒë·ªông k·∫øt th√∫c chu k·ª≥.");
            finishCycle(); // T·ª± ƒë·ªông g·ªçi h√†m k·∫øt th√∫c
        }
        return;
    }

    // N·∫øu ƒëang ch·∫°y v√† c√≤n th·ªùi gian -> Hi·ªÉn th·ªã ƒë·∫øm ng∆∞·ª£c
    if (state.status === 'finished') {
         countdownEl.textContent = "ƒê√£ k·∫øt th√∫c";
         return;
    }

    // T√≠nh to√°n hi·ªÉn th·ªã
    let remaining = rem;
    const days = Math.floor(remaining / (24 * 60 * 60 * 1000));
    remaining %= 24 * 60 * 60 * 1000;
    const hours = Math.floor(remaining / (60 * 60 * 1000));
    remaining %= 60 * 60 * 1000;
    const minutes = Math.floor(remaining / (60 * 1000));
    const seconds = Math.floor((remaining % (60 * 1000)) / 1000);

    countdownEl.textContent =
        `${days} ng√†y ` +
        `${String(hours).padStart(2, '0')}:` +
        `${String(minutes).padStart(2, '0')}:` +
        `${String(seconds).padStart(2, '0')}`;
}
function finishCycle(){
    console.log("[finishCycle] start - state before finish:", state);

    state.status = 'finished';

    // T√≠nh ƒëi·ªÉm trung b√¨nh (1 ch·ªØ s·ªë th·∫≠p ph√¢n)
    const entries = Array.isArray(state.entries) ? state.entries : [];
    let avgScore = 0;
    if (entries.length > 0) {
        const sum = entries.reduce((s,e) => s + (Number(e.value) || 0), 0);
        avgScore = Math.round((sum / entries.length) * 10) / 10; // 1 decimal
    } else {
        avgScore = 0.0;
    }

  // --- LED & √¢m thanh theo quy ƒë·ªãnh m·ªõi ---
LED.className = 'led'; // reset l·ªõp
LED.style.background = ''; // reset m√†u inline
LED.style.opacity = '1';
LED.classList.remove('led-red-alert','pulse','pulse-amber','purple','blue','red','green','amber');

const sndAmber = document.getElementById('sndAmber');
const sndRed   = document.getElementById('sndRed');
const sndGreen = document.getElementById('sndGreen');
const sndBn    = document.getElementById('sndBannangnhe');   // bannangnhe.mp3
const sndSieu  = document.getElementById('sndSieunganhe');  // sieunganhe.mp3

// Quy t·∫Øc:
// [-10000 .. -6667] -> TIM (nh·∫•p nh√°y) + alert-red
// [-6666  .. -3334] -> ƒê·ªé (tƒ©nh)       + bannangnhe.mp3
// [-3333  .. 3333 ] -> XANH L√Å (tƒ©nh)  + success.mp3
// [3334   .. 6666 ] -> XANH D∆Ø∆†NG (nh·∫•p nh√°y) + sieunganhe.mp3
// [6667   .. 10000] -> CAM (nh·∫•p nh√°y) + alert-amber.mp3

if (avgScore <= -6667) {
    // t√≠m nh·∫•p nh√°y + play alert-red
    LED.classList.add('purple','pulse');
    LED.style.background = '#8e44ad';
    LED.style.animationDuration = '0.4s';
    if (sndRed) { sndRed.currentTime = 0; sndRed.loop = true;sndRed.play().catch(()=>{}); }
} else if (avgScore <= -3334) {
    // ƒë·ªè+ play bannangnhe
    LED.classList.add('red','pulse');
    LED.style.background = '#e74c3c';
    LED.style.animationDuration = '0.8s';
    if (sndBn) { sndBn.currentTime = 0; sndBn.loop = true;sndBn.play().catch(()=>{}); }
} else if (avgScore <= 3333) {
    // xanh l√° tƒ©nh + success
    LED.classList.add('green');
    LED.style.background = '#2ecc71';
    LED.classList.remove('pulse','led-red-alert','pulse-amber');
    if (sndGreen) { sndGreen.currentTime = 0; sndGreen.loop = true;sndGreen.play().catch(()=>{}); }
} else if (avgScore <= 6666) {
    // xanh d∆∞∆°ng nh·∫•p nh√°y + sieunganhe
    LED.classList.add('blue','pulse');
    LED.style.background = '#2980b9';
    LED.style.animationDuration = '1.6s';
    if (sndSieu) { sndSieu.currentTime = 0; sndSieu.loop = true;sndSieu.play().catch(()=>{}); }
} else {
    // >=6667 : v√†ng nh·∫•p nh√°y + alert-amber
    LED.classList.add('amber','pulse-amber');
    LED.style.background = '#FFD700';
    LED.style.animationDuration = '0.8s';
    if (sndAmber) { sndAmber.currentTime = 0; sndAmber.loop = true; sndAmber.play().catch(()=>{}); }
}


    // Hi·ªÉn th·ªã ƒêi·ªÉm trung b√¨nh (format +1 decimal)
    const avgEl = document.getElementById('avg');
    const avgBox = document.getElementById('avgScore');

    if (avgEl) {
        avgEl.classList.remove('hidden');
        avgEl.textContent = (avgScore > 0 ? '+' : '') + avgScore.toFixed(1);
    }
    if (avgBox) avgBox.style.display = 'block';

    // ·∫®n v√πng "Th·ªùi gian c√≤n l·∫°i" (g√≥c d∆∞·ªõi tr√°i)
    if (countdownEl && countdownEl.parentElement) {
        countdownEl.parentElement.style.display = 'none';
    }

   // => Thay th·∫ø popup n·ªïi b·∫±ng hi·ªÉn th·ªã NGAY c·∫°nh "ƒêi·ªÉm trung b√¨nh"
// Thay th·∫ø IIFE showTrendInline c≈© b·∫±ng ƒëo·∫°n n√†y
// Hi·ªÉn th·ªã Trend: ch√®n v√†o #statusRight ƒë·ªÉ lu√¥n s√°t m√©p ph·∫£i
// Hi·ªÉn th·ªã Trend: ch√®n v√†o #statusRight ƒë·ªÉ lu√¥n s√°t m√©p ph·∫£i
(function showTrendInline() {
  const trendText = interpretScore(avgScore);
  const avgBoxEl = document.getElementById('avgScore');
  const statusRight = document.getElementById('statusRight');

  // hi·ªán avg ·ªü tr√°i (ch·ªâ hi·ªÉn th·ªã khi k·∫øt th√∫c chu k·ª≥)
  if (avgBoxEl) {
    avgBoxEl.style.display = 'inline-flex';
    avgBoxEl.style.visibility = 'visible';
  }

  if (statusRight) {
    // d·ªçn s·∫°ch v√† ch√®n ph·∫ßn t·ª≠ trend m·ªõi
    statusRight.innerHTML = '';
    const inline = document.createElement('span');
    inline.id = 'avgTrendInline';
    inline.textContent = trendText;
    // ƒë·∫£m b·∫£o cƒÉn gi·ªØa n·∫øu CSS ch∆∞a ƒë∆∞·ª£c n·∫°p/override
    inline.style.display = 'inline-flex';
    inline.style.alignItems = 'center';
    inline.style.lineHeight = '1';
    statusRight.appendChild(inline);
  } else {
    // fallback: ch√®n nh·∫π v√†o avgBox, kh√¥ng ch·ªìng l√™n n·ªôi dung
    if (avgBoxEl) {
      let inline = document.getElementById('avgTrendInline');
      if (!inline) {
        inline = document.createElement('span');
        inline.id = 'avgTrendInline';
        inline.style.display = 'inline-flex';
        inline.style.alignItems = 'center';
        inline.style.marginLeft = '8px';
        avgBoxEl.appendChild(inline);
      }
      inline.textContent = trendText;
    }
  }
})();


    // T·∫°o b·∫£n ghi chu k·ª≥ ho√†n ch·ªânh (l∆∞u avgScore thay v√¨ total)
    const finishedCycle = {
        cycleId: Date.now(),
        startTime: state.startTimestamp,
        endTime: Date.now(),
        avgScore: avgScore,
        entries: entries.slice(),
        // TH√äM ƒêO·∫†N N√ÄY: Kh·ªüi t·∫°o object ch·ª©a ph·∫£n t∆∞
        feedback: {
            q1: "", // B·ªëi c·∫£nh/S·ª± ki·ªán
            q2: "", // Xung ƒë·ªôt n·ªôi t√¢m
            q3: "", // B√†i h·ªçc/Insight
            r1: 0,  // Kh·∫£ d·ª•ng (Usability)
            r2: 0,  // Hi·ªáu qu·∫£ nh·∫≠n th·ª©c (Effectiveness)
            r3: 0   // T√°c ƒë·ªông h√†nh vi (Impact)
        }
    };

    if(!Array.isArray(state.finishedCycles)) state.finishedCycles = loadFinishedCycles() || [];
    state.finishedCycles.unshift(finishedCycle);
    saveFinishedCycles(state.finishedCycles);

    console.log("[finishCycle] saved finishedCycles length =", state.finishedCycles.length);

    // X√≥a chu k·ª≥ hi·ªán t·∫°i kh·ªèi localStorage
    localStorage.removeItem(CURRENT_CYCLE_KEY);

    // Reset current state (idle)
    state.status = 'idle';
    state.startTimestamp = null;
    state.entries = [];
    saveCurrentCycle();
}



function startCycle(){
  state = { status:'running', startTimestamp: Date.now(), entries: [] , finishedCycles: state.finishedCycles || [] };
  LED_clear();
  const avgBox = document.getElementById('avgScore');
  if(avgBox) avgBox.style.display = 'none';

  // PH·ª§C H·ªíI v√πng "Th·ªùi gian c√≤n l·∫°i" (g√≥c d∆∞·ªõi tr√°i)
  if (countdownEl && countdownEl.parentElement) {
      countdownEl.parentElement.style.display = 'block';
      countdownEl.textContent = '--';
  }

  // X√≥a ph·∫ßn hi·ªÉn th·ªã khuynh h∆∞·ªõng c≈© (n·∫øu c√≥) v√† d·ªçn v√πng ph·∫£i
  const oldTrend = document.getElementById('avgTrendInline');
  if (oldTrend) oldTrend.remove();
  const statusRight = document.getElementById('statusRight');
  if (statusRight) statusRight.innerHTML = '';


  placeSliderAtValue(0);
  saveCurrentCycle();
}


/*resetBtn.onclick = () => {

  // ---- D·ª™NG NGAY T·∫§T C·∫¢ √ÇM THANH ----
 const audios = ['sndAmber','sndRed','sndGreen','sndBannangnhe','sndSieunganhe'];

  audios.forEach(id => {
    const a = document.getElementById(id);
    if (a) {
      a.pause();
      a.currentTime = 0;
      // reload src ƒë·ªÉ c√°c tr√¨nh duy·ªát ch·∫Øc ch·∫Øn d·ª´ng
      a.src = a.src;
    }
  });
 document.getElementById('avgScore').style.display = 'none';
startCycle();


  // ---- RESET B√åNH TH∆Ø·ªúNG ----
  startCycle();
};
*/
const helpContent ='<strong>üéØ ƒê·ªäNH NGHƒ®A BA T·∫¶NG T√ÇM L√ù</strong>\n<strong>1) B·∫¢N NƒÇNG (Id)  ‚Äì T·∫¶NG NƒÇNG L∆Ø·ª¢NG NGUY√äN TH·ª¶Y üí•- ƒê√îI KHI L√Ä √ÅC QU·ª∂ üëø! TH√ö T√çNH üê∫!</strong> \nB·∫£n nƒÉng l√† ph·∫ßn s√¢u nh·∫•t v√† nguy√™n th·ªßy nh·∫•t c·ªßa con ng∆∞·ªùi:  \nCh·ª©a c√°c nhu c·∫ßu sinh h·ªçc: ƒÉn, ng·ªß, sinh t·ªìn... üçñüò¥ \nCh·ª©a c√°c c·∫£m x√∫c th√¥: gi·∫≠n d·ªØ, h·∫≠n th√π, ham mu·ªën, chi·∫øm h·ªØu, ghen tu√¥ng... üò°üî• \nKh√¥ng bi·∫øt ƒë√∫ng ‚Äì sai ‚öñÔ∏è \nKh√¥ng bi·∫øt ƒë·∫°o ƒë·ª©c hay ph√°p lu·∫≠t \nCh·ªâ mu·ªën th·ªèa m√£n ngay l·∫≠p t·ª©c ‚è© \nHo·∫°t ƒë·ªông theo Nguy√™n t·∫Øc Kho√°i c·∫£m üòã \nB·∫£n nƒÉng l√† ƒë·ªông c∆° th√¥, m·∫°nh m·∫Ω nh∆∞ng thi·∫øu ki·ªÉm so√°t. \nB·∫£n nƒÉng kh√¥ng x·∫•u.\nN√≥ l√† ƒë·ªông c∆° s·ªëng, th√∫c ƒë·∫©y s√°ng t·∫°o, s·ª©c m·∫°nh, sinh l·ª±c. Nh∆∞ng n·∫øu kh√¥ng ƒë∆∞·ª£c ƒëi·ªÅu ti·∫øt, n√≥ d·ªÖ tr·ªü th√†nh xung l·ª±c m·∫•t ki·ªÉm so√°t.\n‚Üí C·∫ßn B·∫£n ng√£ ƒëi·ªÅu ti·∫øt v√† Si√™u ng√£ ƒë·ªãnh h∆∞·ªõng. \n\n<strong>2) B·∫¢N NG√É (Ego) üß†ü¶∞üë§‚Äì CON NG∆Ø·ªúI TH·ª∞C T·∫æ</strong> \nB·∫£n ng√£ h√¨nh th√†nh ƒë·ªÉ gi√∫p con ng∆∞·ªùi th√≠ch nghi v·ªõi th·ª±c t·∫°i: \n- ƒê√°nh gi√° h·∫≠u qu·∫£, c√¢n nh·∫Øc tr∆∞·ªõc khi l√†m üí° \n- T√¨m c√°ch th·ªèa m√£n B·∫£n nƒÉng m√† kh√¥ng g√¢y r·∫Øc r·ªëi \n- Nh·∫≠n di·ªán lu·∫≠t l·ªá, gi·ªõi h·∫°n, r·ªßi ro üåç \n- L·∫≠p k·∫ø ho·∫°ch ‚Äì t·ªï ch·ª©c ‚Äì ki·ªÉm so√°t h√†nh vi üìÖüïπÔ∏è \nB·∫£n ng√£ v·∫≠n h√†nh theo Nguy√™n t·∫Øc Hi·ªán th·ª±c: ƒëi·ªÅu g√¨ c√≥ th·ªÉ ‚Äì ƒëi·ªÅu g√¨ ƒë∆∞·ª£c ph√©p ‚Äì ƒëi·ªÅu g√¨ n√™n l√†m.\nB·∫£n ng√£ l√† b·ªô ƒëi·ªÅu ph·ªëi trung t√¢m: \n- Gi·∫£m b·ªõt y√™u c·∫ßu b·ªëc ƒë·ªìng c·ªßa B·∫£n nƒÉng \n- Gi·∫£m s·ª± kh·∫Øt khe qu√° m·ª©c c·ªßa Si√™u ng√£ \n- Gi·ªØ cho c√° nh√¢n s·ªëng c√¢n b·∫±ng ‚Äì l√Ω tr√≠ ‚Äì th√≠ch nghi v·ªõi ƒë·ªùi s·ªëng th·ª±c t·∫ø \n\n<strong>3) SI√äU NG√É (Superego) üïäÔ∏è‚Äì H·ªÜ TH·ªêNG ƒê·∫†O ƒê·ª®C & L√ù T∆Ø·ªûNG - THI√äN TH·∫¶N üòá‚ú®</strong> \nSi√™u ng√£ g·ªìm <strong>C√°i T√¥i L√Ω t∆∞·ªüng</strong> (h√¨nh ·∫£nh ƒë·∫πp nh·∫•t m√† b·∫£n th√¢n mu·ªën tr·ªü th√†nh) v√† <strong>L∆∞∆°ng t√¢m</strong> (c·∫£m gi√°c t·ªôi l·ªói khi l√†m ƒëi·ªÅu sai tr√°i, t·ª± h√†o khi l√†m ƒëi·ªÅu ƒë√∫ng).\nSi√™u ng√£ ƒë∆∞·ª£c t·∫°o n√™n t·ª´: gi√°o d·ª•c üìö, vƒÉn h√≥a ‚Äì x√£ h·ªôi üåè, s·ª± h∆∞·ªõng thi·ªán ‚Äì mong mu·ªën tr·ªü n√™n t·ªët ƒë·∫πp h∆°n üïäÔ∏èüòá. \nN√≥ v·∫≠n h√†nh theo Nguy√™n t·∫Øc ƒê·∫°o ƒë·ª©c/L√Ω t∆∞·ªüng: \n- ƒê·∫∑t ra ti√™u chu·∫©n ƒë√∫ng ‚Äì sai ‚öñÔ∏è \n- T·∫°o c·∫£m gi√°c t·ªôi l·ªói khi l√†m sai üíî \n- T·∫°o c·∫£m gi√°c t·ª± h√†o khi l√†m ƒë√∫ng üåà \n- Lu√¥n mu·ªën ƒë·∫°t s·ª± ho√†n h·∫£o üèÜ \nSi√™u ng√£ l√† ng∆∞·ªùi gi√°m s√°t n·ªôi t√¢m: \n‚Üí Khuy·∫øn kh√≠ch ƒëi·ªÅu t·ªët \n‚Üí NgƒÉn h√†nh vi sai \n‚Üí Nh∆∞ng ƒë√¥i khi khi·∫øn b·∫°n nghi√™m kh·∫Øc qu√° m·ª©c v·ªõi b·∫£n th√¢n \n\n<strong>üìè 3 NGUY√äN T·∫ÆC ƒê·ªÇ G·∫†T TH∆Ø·ªöC ƒê√öNG</strong> \n<strong>1) ƒê·ªòNG C∆† üöÄ</strong> \nM·ª•c ƒë√≠ch th·∫≠t s·ª± c·ªßa b·∫°n...? \nPh·ª•c v·ª• b·∫£n th√¢n hay ng∆∞·ªùi kh√°c...? \nXu·∫•t ph√°t t·ª´ c·∫£m x√∫c, l√Ω tr√≠ hay ƒë·∫°o ƒë·ª©c...? \n\n<strong>2) B·∫¢N CH·∫§T KH√ÅCH QUAN üßê</strong> \nTheo ph√°p lu·∫≠t ‚Äì vƒÉn h√≥a ‚Äì ƒë·∫°o ƒë·ª©c - x√£ h·ªôi hi·ªán t·∫°i n∆°i b·∫°n s·ªëng, h√†nh vi ƒë√≥ g√¢y h·∫°i hay g√¢y l·ª£i...? \nH·∫≠u qu·∫£ n·∫∑ng hay nh·∫π...? L√¢u d√†i hay nh·∫•t th·ªùi‚Ä¶?\nNg∆∞·ªùi b√¨nh th∆∞·ªùng s·∫Ω ƒë√°nh gi√° th·∫ø n√†o?\n\n<strong>3) ƒê·ªíNG C·∫¢M ü§ù</strong>\nTheo suy nghƒ© c·ªßa b·∫°n: Ng∆∞·ªùi ƒë·ªëi di·ªán s·∫Ω c·∫£m th·∫•y g√¨ khi b·∫°n l√†m nh∆∞ v·∫≠y (h·∫°nh ph√∫c, b√¨nh an, vui v·∫ª, ƒë∆∞·ª£c l·ª£i, ƒëau kh·ªï, b·∫•t h·∫°nh, t·ªïn th∆∞∆°ng‚Ä¶)? \nT√°c ƒë·ªông nh·∫•t th·ªùi hay d√†i h·∫°n...? \n\n‚û°Ô∏è V·ªõi m·ªói nguy√™n t·∫Øc, n·∫øu h√†nh vi khuynh h∆∞·ªõng b√™n n√†o th√¨ g·∫°t v·ªÅ b√™n ƒë√≥ m·ªôt ƒëo·∫°n. V·ªã tr√≠ cu·ªëi c√πng c·ªßa thanh g·∫°t = k·∫øt qu·∫£ sau khi g·∫°t d·ªìn v∆∞·ª£t qua 3 nguy√™n t·∫Øc. Ho·∫∑c c√≥ th·ªÉ nh√¨n nh·∫≠n chung 3 nguy√™n t·∫Øc r·ªìi g·∫°t th∆∞·ªõc 1 l·∫ßn sau ƒë√≥ cho ph√π h·ª£p.\n\n‚ùì N·∫æU KH√îNG X√ÅC ƒê·ªäNH ƒê∆Ø·ª¢C 1 NGUY√äN T·∫ÆC? \nV√≠ d·ª•: Ch∆∞a r√µ ƒë·ªông c∆°, kh√¥ng bi·∫øt lu·∫≠t, kh√¥ng nghƒ© ƒë∆∞·ª£c ƒë·∫øn c·∫£m x√∫c ng∆∞·ªùi kh√°c... \n‚û°Ô∏è Kh√¥ng g·∫°t nguy√™n t·∫Øc ƒë√≥ \n\n<strong>üß≠ KHI N√ÄO N√äN D√ôNG ‚Äì KHI N√ÄO KH√îNG N√äN D√ôNG</strong> \n<strong>‚úÖ D√ôNG KHI h√†nh vi c√≥:</strong> C·∫£m x√∫c, nh·∫≠n th·ª©c, √Ω th·ª©c r√µ r√†ng, li√™n quan ƒë·∫øn ƒë·∫°o ƒë·ª©c, c√≥ l·ª±a ch·ªçn, t√°c ƒë·ªông ƒë·∫øn ng∆∞·ªùi kh√°c, c√≥ xung ƒë·ªôt n·ªôi t√¢m, ƒë·∫•u tranh gi·ªØa b·∫£n nƒÉng - l√Ω tr√≠ v√† ƒë·∫°o ƒë·ª©c... \nV√≠ d·ª•: Quy·∫øt ƒë·ªãnh n√≥i th·∫≠t hay n√≥i d·ªëi, tha th·ª© hay tr·∫£ ƒë≈©a, chia s·∫ª hay gi·ªØ l·ª£i √≠ch cho m√¨nh, n√≥i l·ªùi t·ª≠ t·∫ø hay l·ªùi l√†m t·ªïn th∆∞∆°ng‚Ä¶ \n\n<strong>‚ùå KH√îNG D√ôNG KHI:</strong>\n1) Ph·∫£n x·∫° sinh h·ªçc: gi·∫≠t m√¨nh, n√© v·∫≠t, co tay khi n√≥ng... \n2) C√¥ng vi·ªác k·ªπ thu·∫≠t ‚Äì logic thu·∫ßn t√∫y: gi·∫£i to√°n, vi·∫øt code, nghi√™n c·ª©u khoa h·ªçc \n3) Th√≥i quen v√¥ th·ª©c: ƒë√°nh rƒÉng, t·∫Øm, l∆∞·ªõt m·∫°ng x√£ h·ªôi theo ph·∫£n x·∫°... \n4) H√†nh vi t·∫≠p th·ªÉ ‚Äì x√£ h·ªôi h·ªçc: nghi l·ªÖ t√¥n gi√°o, bi·ªÉu t√¨nh, b·∫ßu c·ª≠, m·∫∑c ƒë·ªìng ph·ª•c... \n5) H√†nh vi si√™u th·ª©c / ngo√†i th·ªùi gian ‚Äì kh√¥ng gian: thi·ªÅn s√¢u, s√°ng t·∫°o ƒë·∫øn qu√™n m√¨nh, gi√°c ng·ªô, c·∫≠n t·ª≠... \n6) Ng∆∞·ªùi m·∫•t kh·∫£ nƒÉng t·ª± ch·ªß: lo·∫°n th·∫ßn, hoang t∆∞·ªüng, say r∆∞·ª£u ·∫£o gi√°c, ƒë·ªông kinh, b·ªã c∆∞·ª°ng b·ª©c - √©p bu·ªôc - ho√†n c·∫£nh chi ph·ªëi m·∫°nh... \n\n<strong>üîç L·ª∞A CH·ªåN G·∫†T TR∆Ø·ªöC HAY SAU H√ÄNH VI</strong> \nG·∫°t tr∆∞·ªõc khi l√†m: \n‚Üí Gi√∫p b·∫°n c√¢n nh·∫Øc k·ªπ h·∫≠u qu·∫£ \n‚Üí Gi·∫£m h√†nh vi b·ªëc ƒë·ªìng \nG·∫°t sau khi l√†m: \n‚Üí Gi√∫p b·∫°n hi·ªÉu m√¨nh h∆°n \n‚Üí TƒÉng kh·∫£ nƒÉng t·ª± ƒë√°nh gi√° \n\n<strong>‚öôÔ∏è C·∫§U H√åNH BAN ƒê·∫¶U (KHI RESET)</strong> \nThanh g·∫°t ƒë·∫∑t ·ªü ch√≠nh gi·ªØa ‚Üí t∆∞·ª£ng tr∆∞ng cho B·∫£n ng√£ ‚Äì tr·∫°ng th√°i c√¢n b·∫±ng ‚öñÔ∏è \nƒêi·ªÉm trung b√¨nh = 0 üéØ \nƒê√®n v√† √¢m thanh t·∫Øt üîï \n\n<strong>‚è≥ CHU K·ª≤ PH·∫¢N T∆Ø 168 GI·ªú (7 NG√ÄY)</strong> \nSau khi nh·∫•n <strong>Reset</strong> ‚Üí ƒë·ªìng h·ªì b·∫Øt ƒë·∫ßu ƒë·∫øm 168 gi·ªù \nTrong 7 ng√†y: \nG·∫°t th∆∞·ªõc kh√¥ng gi·ªõi h·∫°n s·ªë l·∫ßn \nM·ªói l·∫ßn nh·∫•n ‚Üí ƒëi·ªÉm ƒë∆∞·ª£c d√πng v√†o vi·ªác t√≠nh ƒêi·ªÉm trung b√¨nh üìä \n\n<strong>üéöÔ∏è C√ÅCH TH·ª®C GHI NH·∫¨N XU H∆Ø·ªöNG T√ÇM L√ù</strong> \nG·∫°t v·ªÅ ph√≠a B·∫£n nƒÉng (Id) ‚Üí ƒêi·ªÉm √¢m üíî \n‚Üí H√†nh vi thi√™n v·ªÅ c·∫£m x√∫c th√¥ ‚Äì thi·∫øu c√¢n nh·∫Øc \nG·∫°t v·ªÅ ph√≠a Si√™u ng√£ (Superego) ‚Üí ƒêi·ªÉm d∆∞∆°ng ‚ù§Ô∏è \n‚Üí H√†nh vi thi√™n v·ªÅ ƒë·∫°o ƒë·ª©c ‚Äì chu·∫©n m·ª±c ‚Äì tr√°ch nhi·ªám \nC√†ng s√°t hai c·ª±c ‚Üí m·ª©c ƒë·ªô c√†ng m·∫°nh \n\n<strong>üß† X√ÅC NH·∫¨N ƒêI·ªÇM</strong> \nKhi ·∫•n xu·ªëng tr√™n thanh g·∫°t: \nH·ªá th·ªëng l∆∞u l·∫°i ƒëi·ªÉm üóÉÔ∏è \nƒê√®n s√°ng 1 trong 5 m√†u üü£üî¥üü¢üîµ üü°t∆∞∆°ng ·ª©ng v·ªõi 5 kuynh h∆∞·ªõng h√†nh vi (b√™n d∆∞·ªõi)\nPh√°t ti·∫øng b√≠p nh·∫π üîä \n‚Üí B√°o hi·ªáu: ghi ƒëi·ªÉm th√†nh c√¥ng üéâ, ƒëi·ªÉm s·∫Ω ƒë∆∞·ª£c t√≠nh trong ƒëi·ªÉm trung b√¨nh xu·∫•t hi·ªán sau 168 gi·ªù. \nSau khi g·∫°t v√† t√≠ch ƒëi·ªÉm xong m·ªôt l·∫ßn, nh·∫•n n√∫t <strong>H·ªìi v·ªã</strong> ƒë·ªÉ ƒë∆∞a thanh g·∫°t v·ªÅ v·ªã tr√≠ g·ªëc ch√≠nh gi·ªØa ban ƒë·∫ßu, chu·∫©n b·ªã cho l·∫ßn g·∫°t ti·∫øp theo. \n\n<strong>üì£ B√ÅO C√ÅO T·ªîNG K·∫æT T√ÇM L√ù SAU 168 GI·ªú - 7 NG√ÄY - 1 TU·∫¶N</strong>\n‚ú® M·ªói m·ª©c ƒëi·ªÉm trung b√¨nh l√† m·ªôt ‚Äútr·∫°ng th√°i n·ªôi t√¢m ch·ªß ƒë·∫°o‚Äù k√®m hi·ªÉn th·ªã ƒë√®n ‚Äì √¢m thanh ‚Äì khuynh h∆∞·ªõng t√¢m l√Ω ‚ú®\n<strong>üü£ [-10000 ‚Üí -6667] ‚Äì B·∫¢N NƒÇNG M·∫†NH üòàüê∫üí•</strong>\nƒê√®n LED: üü£ M√†u t√≠m nh·∫•p nh√°y li√™n t·ª•c\n√Çm thanh: üö® C·∫£nh b√°o n·∫∑ng \n<strong>B·∫£n nƒÉng m·∫°nh</strong> üê∫üî•\nL√† tr·∫°ng th√°i con ng∆∞·ªùi h√†nh ƒë·ªông theo xung l·ª±c nguy√™n s∆°: ƒÉn üçñ, ng·ªß üò¥, kho√°i c·∫£m üí´, chi·∫øm h·ªØu üîí, th·ªëng tr·ªã ü¶Ö, n√© tr√°nh ƒëau ƒë·ªõn ‚ö°. L√Ω tr√≠ v√† ƒë·∫°o ƒë·ª©c l√∫c n√†y y·∫øu th·∫ø, khi·∫øn ta d·ªÖ b·ªëc ƒë·ªìng, gi·∫≠n d·ªØ üò†, tham lam üí∞, ghen t·ªã üí¢ v√† h√†nh ƒë·ªông thi·∫øu ki·ªÉm so√°t. NƒÉng l∆∞·ª£ng m·∫°nh nh∆∞ng n·∫øu kh√¥ng ƒë·ªãnh h∆∞·ªõng s·∫Ω d·∫´n ƒë·∫øn xung ƒë·ªôt n·ªôi t√¢m ho·∫∑c h√†nh vi sai l·ªách v·ªõi x√£ h·ªôi.\n\nL·ªùi khuy√™n üß≠:\n‚Ä¢ D·ª´ng l·∫°i 5 gi√¢y tr∆∞·ªõc khi ph·∫£n ·ª©ng ‚è≥\n‚Ä¢ Ghi nh·∫≠n c·∫£m x√∫c, kh√¥ng v·ªôi h√†nh ƒë·ªông üß†\n‚Ä¢ T·∫≠p th·ªÉ d·ª•c üèÉ, thi·ªÅn üßò ho·∫∑c vi·∫øt nh·∫≠t k√Ω üìì ƒë·ªÉ x·∫£ nƒÉng l∆∞·ª£ng th√¥\n\n<strong>üî¥ [-6666 ‚Üí -3334] ‚Äì B·∫¢N NƒÇNG V·ª™A</strong>‚ö°Ô∏èüò†üòã \nƒê√®n LED: üî¥ ƒê·ªè nh·∫•p nh√°y k·ªãch t√≠nh\n√Çm thanh: üéµ k·ªãch t√≠nh, b·∫•t ·ªïn\n<strong>B·∫£n nƒÉng v·ª´a</strong> üêæ‚öñÔ∏è\n·ªû m·ª©c n√†y, con ng∆∞·ªùi v·∫´n ch·ªãu ·∫£nh h∆∞·ªüng b·ªüi ham mu·ªën v√† nhu c·∫ßu t·ª± nhi√™n, nh∆∞ng ƒë√£ bi·∫øt ki·ªÅm ch·∫ø m·ªôt ph·∫ßn nh·ªù tr·∫£i nghi·ªám v√† √Ω th·ª©c h·∫≠u qu·∫£. C·∫£m x√∫c b·ªôc ph√°t kh√¥ng c√≤n chi ph·ªëi ho√†n to√†n: h·ªç bi·∫øt c√¢n nh·∫Øc s∆° b·ªô gi·ªØa c√°i mu·ªën v√† c√°i n√™n, bi·∫øt ch·ªù ƒë·ª£i ‚è≥, gi·ªØ b√¨nh tƒ©nh üòå v√† ƒë·∫∑t gi·ªõi h·∫°n cho b·∫£n th√¢n üöß. ƒê√¢y l√† m·ª©c b·∫£n nƒÉng h√†i h√≤a h∆°n, t·∫°o n·ªÅn t·∫£ng cho b·∫£n ng√£ v·∫≠n h√†nh.\n\nL·ªùi khuy√™n üß≠:\n‚Ä¢ ƒê·∫∑t ‚Äúv·∫°ch d·ª´ng‚Äù tr∆∞·ªõc khi h√†nh ƒë·ªông üö¶\n‚Ä¢ L·∫≠p m·ª•c ti√™u ng·∫Øn h·∫°n ƒë·ªÉ h∆∞·ªõng nƒÉng l∆∞·ª£ng v√†o vi·ªác c√≥ √≠ch üéØ\n‚Ä¢ Ph√¢n t√≠ch h·∫≠u qu·∫£ tr∆∞·ªõc c√°c quy·∫øt ƒë·ªãnh l·ªõn üß†\n\n<strong>üü¢ [-3333 ‚Üí +3333] ‚Äì B·∫¢N NG√É C√ÇN B·∫∞NG</strong> üë§üåà‚öñÔ∏èüß†\nƒê√®n LED: üü¢ Xanh l√° tƒ©nh ‚Äì √™m d·ªãu, ·ªïn ƒë·ªãnh\n√Çm thanh: üéâ Nh·∫°c ch√∫c m·ª´ng vui t∆∞∆°i\n<strong>B·∫£n ng√£</strong> üß†‚öôÔ∏è\nƒê√¢y l√† trung t√¢m ƒëi·ªÅu ph·ªëi t√¢m l√Ω, n∆°i con ng∆∞·ªùi bi·∫øt c√¢n b·∫±ng gi·ªØa nhu c·∫ßu b√™n trong v√† y√™u c·∫ßu x√£ h·ªôi. L√Ω tr√≠ ƒë√≥ng vai tr√≤ d·∫´n ƒë∆∞·ªùng: ph√¢n t√≠ch üîé, ƒë√°nh gi√° ‚öñÔ∏è, d·ª± ƒëo√°n üìà v√† ch·ªçn h√†nh vi ph√π h·ª£p ho√†n c·∫£nh. B·∫£n ng√£ kh√¥ng lo·∫°i b·ªè b·∫£n nƒÉng m√† ƒë·ªãnh h∆∞·ªõng n√≥ m·ªôt c√°ch th·ª±c t·∫ø v√† tr∆∞·ªüng th√†nh h∆°n. Ng∆∞·ªùi c√≥ b·∫£n ng√£ m·∫°nh hi·ªÉu r√µ gi·ªõi h·∫°n c·ªßa m√¨nh üöß, ki·ªÉm so√°t h√†nh vi, bi·∫øt tho·∫£ hi·ªáp ü§ù v√† h√†nh ƒë·ªông d·ª±a tr√™n m·ª•c ti√™u d√†i h·∫°n üéØ. ƒê√¢y l√† m·ª©c ·ªïn ƒë·ªãnh, gi√∫p s·ªëng t·ª± ch·ªß v√† l√Ω tr√≠ nh∆∞ng v·∫´n gi·ªØ tr·ªçn b·∫£n ch·∫•t con ng∆∞·ªùi.\n\nL·ªùi khuy√™n üß≠:\n‚Ä¢ Lu√¥n ki·ªÉm tra m·ª•c ti√™u d√†i h·∫°n tr∆∞·ªõc h√†nh ƒë·ªông ng·∫Øn h·∫°n üéØ‚û°Ô∏è‚ö°\n‚Ä¢ Gi·ªØ s·ª± linh ho·∫°t, bi·∫øt th√≠ch nghi khi c·∫ßn üåø\n‚Ä¢ R√®n k·ªπ nƒÉng ra quy·∫øt ƒë·ªãnh: vi·∫øt ‚Äì ph√¢n t√≠ch ‚Äì ch·ªçn ph∆∞∆°ng √°n t·ªëi ∆∞u ‚úçÔ∏èüìä‚úîÔ∏è\n\nTh√¥ng ƒëi·ªáp üåü: ƒê√¢y l√† m·ª•c ti√™u nh√¢n vƒÉn cao nh·∫•t c·ªßa th∆∞·ªõc ƒëo n√†y: gi√∫p b·∫°n s·ªëng h√†i h√≤a v·ªõi ch√≠nh m√¨nh v√† th·∫ø gi·ªõi.\n\n<strong>üîµ [3334 ‚Üí 6666] ‚Äì SI√äU NG√É V·ª™A Ô∏è‚ú®üíñüïäÔ∏è</strong>\nƒê√®n LED: üîµ Xanh d∆∞∆°ng nh·∫•p nh√°y nh·∫π ‚Äì tinh khi·∫øt\n√Çm thanh: üëº √Çm thanh thi√™n th·∫ßn trong tr·∫ªo\n<strong>Si√™u ng√£ v·ª´a</strong> ‚ú®‚öñÔ∏è\nƒê√¢y l√† m·ª©c m√† chu·∫©n m·ª±c ƒë·∫°o ƒë·ª©c, l√Ω t∆∞·ªüng v√† gi√° tr·ªã x√£ h·ªôi ƒë√£ hi·ªán di·ªán r√µ r√†ng trong suy nghƒ© v√† h√†nh ƒë·ªông. Con ng∆∞·ªùi bi·∫øt t·ª± ƒëi·ªÅu ch·ªânh d·ª±a v√†o l∆∞∆°ng t√¢m üíõ, ph√¢n bi·ªát ƒë√∫ng ‚Äì sai ‚úîÔ∏è‚ùå, c√≥ xu h∆∞·ªõng h∆∞·ªõng thi·ªán nh∆∞ng v·∫´n linh ho·∫°t, kh√¥ng qu√° kh·∫Øt khe v·ªõi b·∫£n th√¢n hay ng∆∞·ªùi kh√°c. Si√™u ng√£ v·ª´a mang l·∫°i s·ª± tr√°ch nhi·ªám, th·∫•u c·∫£m ü§ç v√† ƒë√°ng tin c·∫≠y, ƒë·ªìng th·ªùi tr√°nh ƒë∆∞·ª£c c·ª±c ƒëoan ƒë·∫°o ƒë·ª©c ho·∫∑c √°p ƒë·∫∑t ng∆∞·ªùi kh√°c. ƒê√¢y l√† d·∫•u hi·ªáu c·ªßa nh√¢n c√°ch tr∆∞·ªüng th√†nh v√† gi√° tr·ªã s·ªëng v·ªØng v√†ng.\nL·ªùi khuy√™n üß≠:\n‚Ä¢ Duy tr√¨ l√≤ng nh√¢n √°i nh∆∞ng nh·ªõ t√¥n tr·ªçng ranh gi·ªõi c√° nh√¢n üöß\n‚Ä¢ Tr√°nh c·ªë g·∫Øng ‚Äúc·ª©u‚Äù t·∫•t c·∫£ m·ªçi ng∆∞·ªùi ‚Äî h√£y ch·ªçn ƒë√∫ng n∆°i ƒë·ªÉ gi√∫p üéØ\n‚Ä¢ Ch·∫•p nh·∫≠n r·∫±ng kh√¥ng ai ho√†n h·∫£o, k·ªÉ c·∫£ ch√≠nh m√¨nh üåø\n\n<strong>üü° [6667 ‚Üí 10000] ‚Äì SI√äU NG√É M·∫†NH  ü§çüòáüåü</strong>\nƒê√®n LED: üü° V√†ng nh·∫•p nh√°y m·∫°nh ‚Äì n·ªïi b·∫≠t\n√Çm thanh: ‚ö†Ô∏è C·∫£nh b√°o\n<strong>Si√™u ng√£ m·∫°nh</strong>üåüüïäÔ∏è\nƒê√¢y l√† m·ª©c m√† chu·∫©n m·ª±c ƒë·∫°o ƒë·ª©c v√† l√Ω t∆∞·ªüng tr·ªü th√†nh trung t√¢m ƒë·ªãnh h∆∞·ªõng m·ªçi h√†nh vi. Con ng∆∞·ªùi s·ªëng theo nguy√™n t·∫Øc r√µ r√†ng üìú, ƒë·ªÅ cao nghƒ©a v·ª• v√† c√¥ng b·∫±ng ‚öñÔ∏è, s·∫µn s√†ng hy sinh nhu c·∫ßu c√° nh√¢n ƒë·ªÉ gi·ªØ ƒëi·ªÅu m√¨nh cho l√† ƒë√∫ng. Tuy nhi√™n, h·ªç d·ªÖ t·ª± ph√™ b√¨nh qu√° m·ª©c, c·∫£m th·∫•y t·ªôi l·ªói üòî, ho·∫∑c kh·∫Øt khe v·ªõi b·∫£n th√¢n v√† ng∆∞·ªùi kh√°c. Si√™u ng√£ m·∫°nh mang s·ª± trong s√°ng v√† chu·∫©n m·ª±c cao ‚ú®, nh∆∞ng n·∫øu thi·∫øu c√¢n b·∫±ng t·ª´ b·∫£n ng√£, c√≥ th·ªÉ d·∫´n ƒë·∫øn c·ª©ng nh·∫Øc ho·∫∑c √°p l·ª±c n·ªôi t√¢m.\n\nL·ªùi khuy√™n üß≠:\n‚Ä¢ Nh·∫π nh√†ng h∆°n v·ªõi ch√≠nh m√¨nh ‚Äì kh√¥ng ai ho√†n h·∫£o üåø\n‚Ä¢ Ch·∫•p nh·∫≠n l·ªói sai nh∆∞ m·ªôt ph·∫ßn t·ª± nhi√™n c·ªßa con ng∆∞·ªùi üíõ\n‚Ä¢ D√†nh th·ªùi gian cho nhu c·∫ßu c√° nh√¢n: ngh·ªâ ng∆°i üòå, th∆∞ gi√£n üéê, vui ch∆°i üéâ\nKhuy·∫øn ngh·ªã üí°: H√£y cho ph√©p b·∫£n th√¢n m·ªÅm m·∫°i h∆°n v√† ∆∞u ti√™n ch√≠nh m√¨nh nhi·ªÅu h∆°n ü§ç.\n\n----------------------------\n\nTh√¥ng ƒëi·ªáp cu·ªëi üåà:\nM·ªói con s·ªë ch·ªâ l√† s·ª± d·ªãch chuy·ªÉn nƒÉng l∆∞·ª£ng gi·ªØa B·∫£n nƒÉng ‚Äì B·∫£n ng√£ ‚Äì Si√™u ng√£.\nH·ªá th·ªëng kh√¥ng ph√°n x√©t, ch·ªâ soi chi·∫øu ƒë·ªÉ b·∫°n hi·ªÉu m√¨nh h∆°n, ƒëi·ªÅu ch·ªânh v√† ph√°t tri·ªÉn m·ªôt c√°ch h√†i h√≤a.\n\n<strong>üìÖ‚û°Ô∏èüß† THEO D√ïI L√ÇU D√ÄI & PH√ÅT TRI·ªÇN NH√ÇN C√ÅCH</strong>\nH·ªá th·ªëng ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ kh√¥ng ch·ªâ ƒëo l∆∞·ªùng t·ª©c th·ªùi m√† c√≤n l∆∞u tr·ªØ <strong>Nh·∫≠t k√Ω T√¢m l√Ω</strong> qua t·ª´ng chu k·ª≥ 7 ng√†y, gi√∫p ng∆∞·ªùi d√πng v√† nh√† nghi√™n c·ª©u quan s√°t s·ª± bi·∫øn chuy·ªÉn c·ªßa n·ªôi t√¢m theo th·ªùi gian:\n\n<strong>1. Quan s√°t d·ªØ li·ªáu ƒë·ªãnh l∆∞·ª£ng (S·ªë li·ªáu & Xu h∆∞·ªõng):</strong>\nTh√¥ng qua <strong>Nh·∫≠t k√Ω</strong>, ng∆∞·ªùi d√πng xem l·∫°i ƒë∆∞·ª£c c√°c chu k·ª≥ ƒë√£ ho√†n th√†nh v·ªõi c√°c ch·ªâ s·ªë c·ª• th·ªÉ:\n<strong>ƒêi·ªÉm trung b√¨nh:</strong> Con s·ªë t·ªïng k·∫øt ch√≠nh x√°c nh·∫•t xu h∆∞·ªõng t√¢m l√Ω ch·ªß ƒë·∫°o c·ªßa b·∫°n trong su·ªët 1 tu·∫ßn.\n\n<strong>M√†u s·∫Øc t√¢m l√Ω (5 v√πng m√†u):</strong> Nh·∫≠n di·ªán r√µ r√†ng b·∫£n th√¢n ƒëang thi√™n v·ªÅ v√πng n√†o:\nüü£üî¥ B·∫£n nƒÉng (T√≠m/ƒê·ªè - NƒÉng l∆∞·ª£ng th√¥/Xung ƒë·ªôt)\nüü¢ C√¢n b·∫±ng (Xanh l√° - ·ªîn ƒë·ªãnh/L√Ω tr√≠)\nüîµüü° Si√™u ng√£ (Xanh d∆∞∆°ng/V√†ng - ƒê·∫°o ƒë·ª©c/L√Ω t∆∞·ªüng)\n\n<strong>S·ª± d·ªãch chuy·ªÉn:</strong> So s√°nh gi·ªØa c√°c chu k·ª≥ ƒë·ªÉ th·∫•y s·ª± ti·∫øn b·ªô (V√≠ d·ª•: T·ª´ m√†u ƒê·ªè n√≥ng n·∫£y chuy·ªÉn sang m√†u Xanh l√° c√¢n b·∫±ng).\n\n<strong>2. Th·ª±c h√†nh ph·∫£n t∆∞ s√¢u (D·ªØ li·ªáu ƒë·ªãnh t√≠nh):</strong>\nSau m·ªói chu k·ª≥, h·ªá th·ªëng y√™u c·∫ßu ng∆∞·ªùi d√πng ƒëi·ªÅn v√†o phi·∫øu ph·∫£n t∆∞ t√¢m l√Ω g·ªìm 3 c√¢u h·ªèi c·ªët l√µi:\n<strong>S·ª± ki·ªán:</strong> ƒêi·ªÅu g√¨ ƒë√°ng nh·ªõ nh·∫•t trong tu·∫ßn ƒë√£ k√≠ch ho·∫°t c·∫£m x√∫c c·ªßa b·∫°n?\n<strong>Xung ƒë·ªôt n·ªôi t√¢m:</strong> Cu·ªôc ƒë·∫•u tranh gi·ªØa c√°i "T√¥i mu·ªën" (B·∫£n nƒÉng) v√† c√°i "T√¥i n√™n" (Si√™u ng√£) di·ªÖn ra nh∆∞ th·∫ø n√†o v·ªõi ƒëi·ªÅu ƒë√≥?\n<strong>B√†i h·ªçc:</strong> R√∫t ra kinh nghi·ªám t·ª´ ƒëi·ªÅu ƒë√≥ ƒë·ªÉ ƒëi·ªÅu ch·ªânh h√†nh vi cho tu·∫ßn ti·∫øp theo.\n\n<strong>3. ƒê√°nh gi√° hi·ªáu qu·∫£ c√¥ng c·ª•:</strong>\nƒê·ªÉ ph·ª•c v·ª• m·ª•c ƒë√≠ch nghi√™n c·ª©u khoa h·ªçc, ng∆∞·ªùi d√πng th·ª±c hi·ªán ƒë√°nh gi√° kh√°ch quan cu·ªëi m·ªói chu k·ª≥:\n<strong>Ch·∫•m ƒëi·ªÉm Sao (‚≠êÔ∏è):</strong>ƒê√°nh gi√° m·ª©c ƒë·ªô hi·ªáu qu·∫£ c·ªßa th∆∞·ªõc trong vi·ªác gi√∫p b·∫°n: Hi·ªÉu b·∫£n th√¢n, Thay ƒë·ªïi h√†nh vi v√† T√≠nh d·ªÖ s·ª≠ d·ª•ng.\n<strong>Bi·ªÉu t∆∞·ª£ng c·∫£m x√∫c (Emoji):</strong> ƒêo l∆∞·ªùng m·ª©c ƒë·ªô h√†i l√≤ng v·ªÅ c·∫£m x√∫c sau khi s·ª≠ d·ª•ng.\n\n<strong>4. Xu·∫•t b√°o c√°o d·ªØ li·ªáu:</strong>\nNg∆∞·ªùi d√πng c√≥ th·ªÉ nh·∫•n n√∫t <strong>"üìÑ Xu·∫•t file Word"</strong> ƒë·ªÉ t·∫£i v·ªÅ to√†n b·ªô h·ªì s∆° t√¢m l√Ω.\nFile b√°o c√°o bao g·ªìm: Nh·∫≠t k√Ω h√†nh vi chi ti·∫øt + ƒêi·ªÉm trung b√¨nh + N·ªôi dung ph·∫£n t∆∞ + D·ªØ li·ªáu ƒë√°nh gi√° theo 5 m·ª©c.\n\n<em><strong>üìù L∆∞u √Ω quan tr·ªçng:</strong> ƒê√¢y l√† ngu·ªìn c·ª© li·ªáu th·ª±c t·∫ø quan tr·ªçng nh·∫•t ƒë·ªÉ t√°c gi·∫£ ƒë∆∞a v√†o b√†i b√°o c√°o nghi√™n c·ª©u tham gia cu·ªôc thi KHKT c·∫•p Th√†nh ph·ªë, minh ch·ª©ng cho t√≠nh hi·ªáu qu·∫£ v√† th·ª±c ti·ªÖn c·ªßa s·∫£n ph·∫©m.</em>\n\n<strong>‚ö†Ô∏è C·∫¢NH B√ÅO & L∆ØU √ù QUAN TR·ªåNG</strong>\n<strong>1. Kh√¥ng ph·∫£i c√¥ng c·ª• ch·∫©n ƒëo√°n y t·∫ø / t√¢m l√Ω üß™üö´</strong> \nTh∆∞·ªõc ƒë∆∞·ª£c thi·∫øt k·∫ø d·ª±a tr√™n thuy·∫øt Ph√¢n t√¢m h·ªçc - v·ªën mang t√≠nh tri·∫øt h·ªçc nhi·ªÅu h∆°n khoa h·ªçc hi·ªán ƒë·∫°i (ch∆∞a ƒë∆∞·ª£c ki·ªÉm ch·ª©ng, thi·∫øu c∆° s·ªü khoa h·ªçc, mang t√≠nh ch·ªß quan cao, thi·∫øu t√≠nh ph·ªï qu√°t), ch·ªâ ƒë√≥ng vai tr√≤ l√† c√¥ng c·ª• gi√°o d·ª•c t·ª± ph·∫£n t∆∞ b·∫£n th√¢n v·ªÅ nh·ªØng xung ƒë·ªôt trong v·∫•n ƒë·ªÅ l·ª£i √≠ch, kh√¥ng ph·∫£i thi·∫øt b·ªã ch·∫©n ƒëo√°n ch√≠nh x√°c tuy·ªát ƒë·ªëi t√¢m l√Ω con ng∆∞·ªùi. T√¢m l√Ω con ng∆∞·ªùi v√¥ c√πng ph·ª©c t·∫°p: m·ªói c√° th·ªÉ l√† duy nh·∫•t, v√† kh√¥ng c√≥ ph√¢n lo·∫°i ‚Äút·ªët‚Äù hay ‚Äúx·∫•u‚Äù m·ªôt c√°ch tuy·ªát ƒë·ªëi. T√¢m l√Ω ch·ªãu ·∫£nh h∆∞·ªüng ƒë·ªìng th·ªùi t·ª´ di truy·ªÅn, c√°c ch·∫•t ho√° h·ªçc v√† ch·∫•t d·∫´n truy·ªÅn th·∫ßn kinh trong n√£o, m√¥i tr∆∞·ªùng s·ªëng, gi√°o d·ª•c, chu·∫©n m·ª±c x√£ h·ªôi, m·ª©c ƒë·ªô t·ª± ch·ªß, xung ƒë·ªôt n·ªôi t√¢m, c∆° ch·∫ø ph√≤ng v·ªá, tr∆∞·ªüng th√†nh t√¢m l√Ω, b·ªëi c·∫£nh x√£ h·ªôi, l·ªãch s·ª≠ c√° nh√¢n,... ch·ª© kh√¥ng ch·ªâ ƒë∆°n gi·∫£n l√† B·∫£n nƒÉng, B·∫£n ng√£ v√† Si√™u ng√£.\n\nKh√¥ng d√πng k·∫øt qu·∫£ ƒë·ªÉ thay th·∫ø ch·∫©n ƒëo√°n, t∆∞ v·∫•n hay tr·ªã li·ªáu chuy√™n m√¥n (b√°c sƒ©, nh√† t√¢m l√Ω, b√°c sƒ© t√¢m th·∫ßn). \n\nN·∫øu b·∫°n ho·∫∑c ng∆∞·ªùi th√¢n c√≥ d·∫•u hi·ªáu nghi√™m tr·ªçng (t·ª± h·∫°i, √Ω ƒë·ªãnh g√¢y h·∫°i ng∆∞·ªùi kh√°c, hoang t∆∞·ªüng, m·∫•t li√™n h·ªá v·ªõi th·ª±c t·∫°i), ngay l·∫≠p t·ª©c d·ª´ng s·ª≠ d·ª•ng th∆∞·ªõc v√† t√¨m tr·ª£ gi√∫p chuy√™n nghi·ªáp. \n\n<strong>2. Trung th·ª±c khi s·ª≠ d·ª•ng ‚Äî y·∫øu t·ªë then ch·ªët üîéüß≠</strong> \nK·∫øt qu·∫£ mang t√≠nh ch·ªß quan cao, ph·ª• thu·ªôc ho√†n to√†n v√†o c√°ch b·∫°n k√©o g·∫°t v√† c√°ch b·∫°n t·ª± ƒë√°nh gi√° theo 3 nguy√™n t·∫Øc. \nTrung th·ª±c tuy·ªát ƒë·ªëi v·ªõi ch√≠nh m√¨nh khi tr·∫£ l·ªùi (ƒë·ªông c∆°, kh√°ch quan, ƒë·ªìng c·∫£m) l√† ƒëi·ªÅu c·∫ßn thi·∫øt. \nN·∫øu c·ªë t√¨nh thao t√°c kh√¥ng th·∫≠t (ƒë·ªÉ "ƒë∆∞·ª£c ƒëi·ªÉm" ho·∫∑c ƒë·ªÉ ki·ªÉm tra thi·∫øt b·ªã), k·∫øt qu·∫£ s·∫Ω m·∫•t √Ω nghƒ©a v√† c√≥ th·ªÉ d·∫´n ƒë·∫øn hi·ªÉu sai v·ªÅ b·∫£n th√¢n. \n\n<strong>3. ƒêi·ªÉm s·ªë kh√¥ng b·∫±ng nh√¢n c√°ch con ng∆∞·ªùi ü´∂ </strong>\nM·ªôt hay nhi·ªÅu l·∫ßn ƒëi·ªÉm √¢m/d∆∞∆°ng kh√¥ng bi·∫øn b·∫°n th√†nh ‚Äúx·∫•u‚Äù hay ‚Äúth√°nh thi·ªán‚Äù. \nƒêi·ªÉm ch·ªâ n√≥i l√™n xu h∆∞·ªõng m·ªôt c√°ch t∆∞∆°ng ƒë·ªëi sau 7 ng√†y t·ªïng k·∫øt, kh√¥ng ƒë√°nh gi√° gi√° tr·ªã con ng∆∞·ªùi. \nH√£y ƒë·ªçc ƒëi·ªÉm nh∆∞ ch·ªâ s·ªë tham kh·∫£o ‚Äî b·∫Øt ƒë·∫ßu cu·ªôc ƒë·ªëi tho·∫°i v·ªõi ch√≠nh m√¨nh, kh√¥ng t·ª± bu·ªôc t·ªôi. \n\n<strong>4. Kh√¥ng d√πng th∆∞·ªõc ƒë·ªÉ ph√°n x√©t ng∆∞·ªùi kh√°c ho·∫∑c l√†m b·∫±ng ch·ª©ng ph√°p l√Ω ‚öñÔ∏è‚úã</strong> \nTuy·ªát ƒë·ªëi kh√¥ng d√πng th∆∞·ªõc l√†m c√¥ng c·ª• ƒë√°nh gi√°, k·∫øt lu·∫≠n, x√∫c ph·∫°m ho·∫∑c x·ª≠ l√Ω ng∆∞·ªùi kh√°c (gia ƒë√¨nh, ƒë·ªìng nghi·ªáp, h·ªçc sinh‚Ä¶). \nKh√¥ng d√πng k·∫øt qu·∫£ l√†m b·∫±ng ch·ª©ng trong c√°c tranh ch·∫•p, t·ªë t·ª•ng, quy·∫øt ƒë·ªãnh tuy·ªÉn ch·ªçn, sa th·∫£i, k·ª∑ lu·∫≠t ho·∫∑c c√°c v·∫•n ƒë·ªÅ ph√°p l√Ω. \n\n<strong>5. Tr√°nh d√πng trong tr·∫°ng th√°i c·∫£m x√∫c c·ª±c ƒë·ªô ho·∫∑c m·∫•t ki·ªÉm so√°t üåÄ</strong> \nKh√¥ng d√πng khi: say r∆∞·ª£u, b·ªã k√≠ch ƒë·ªông m·∫°nh, ho·∫£ng lo·∫°n, ƒëang trong c∆°n kh·ªßng ho·∫£ng, m·∫•t ng·ªß n·∫∑ng, d√πng ch·∫•t k√≠ch th√≠ch... \nNh·ªØng tr·∫°ng th√°i n√†y l√†m m√©o m√≥ nh·∫≠n th·ª©c ‚Üí k·∫øt qu·∫£ sai l·ªách, ƒë√¥i khi g√¢y h·∫≠u qu·∫£ c·∫£m x√∫c x·∫•u cho b·∫°n. \n\n<strong>6. Nh√≥m ng∆∞·ªùi kh√¥ng ph√π h·ª£p ho·∫∑c c·∫ßn th·∫≠n tr·ªçng ƒë·∫∑c bi·ªát ‚ö†Ô∏è</strong> \nNg∆∞·ªùi c√≥ r·ªëi lo·∫°n th·∫ßn kinh n·∫∑ng, r·ªëi lo·∫°n nh√¢n c√°ch n·∫∑ng, r·ªëi lo·∫°n t√¢m th·∫ßn, ·∫£o gi√°c, ƒë·ªông kinh c·∫ßn kh√¥ng d√πng th∆∞·ªõc ƒë·ªÉ t·ª± ƒë√°nh gi√°. \nTr·∫ª em d∆∞·ªõi ƒë·ªô tu·ªïi tr∆∞·ªüng th√†nh: ch·ªâ d√πng d∆∞·ªõi s·ª± gi√°m s√°t v√† gi·∫£i th√≠ch c·ªßa ng∆∞·ªùi l·ªõn/gi√°o vi√™n/chuy√™n gia. \nNg∆∞·ªùi ƒëang trong qu√° tr√¨nh ƒëi·ªÅu tr·ªã t√¢m l√Ω/thu·ªëc c·∫ßn h·ªèi √Ω ki·∫øn chuy√™n gia tr∆∞·ªõc khi d√πng. \n\n<strong>7. Nguy c∆° l·ªá thu·ªôc & t·ª± ph√°n x√©t ‚Äî d√πng th∆∞·ªõc c√≥ tr√°ch nhi·ªám üß≠ </strong>\nKh√¥ng n√™n d√πng th∆∞·ªõc l√†m b√°o c√°o gi√° tr·ªã b·∫£n th√¢n h√†ng ng√†y; n·∫øu l·∫°m d·ª•ng s·∫Ω t·∫°o th√≥i quen so s√°nh v√† l·ªá thu·ªôc v√†o ch·ªâ s·ªë. \nTr√°nh chuy·ªÉn vi·ªác ‚Äúl√†m t·ªët/kh√¥ng t·ªët‚Äù th√†nh √°p l·ª±c: con ng∆∞·ªùi ph√°t tri·ªÉn b·∫±ng t·∫≠p luy·ªán & b·ªëi c·∫£nh, kh√¥ng ph·∫£i ch·ªâ s·ªë. \n\n<strong>8. Quy·ªÅn ri√™ng t∆∞ & d·ªØ li·ªáu c√° nh√¢n üîê</strong> \nC·∫ßn minh b·∫°ch v·ªÅ vi·ªác l∆∞u tr·ªØ, ai c√≥ th·ªÉ truy c·∫≠p, th·ªùi gian l∆∞u v√† x√≥a d·ªØ li·ªáu qua file Word. \nKh√¥ng chia s·∫ª k·∫øt qu·∫£ v·ªõi ng∆∞·ªùi kh√°c n·∫øu b·∫°n ch∆∞a s·∫µn s√†ng ho·∫∑c ch∆∞a th√¥ng b√°o r√µ m·ª•c ƒë√≠ch. \n\n<strong>9. C√°ch ph·∫£n ·ª©ng khi k·∫øt qu·∫£ c·∫£nh b√°o (t√≠m/v√†ng) </strong>üö® \nƒê·ª´ng ho·∫£ng lo·∫°n ‚Äî coi ƒë√≥ l√† t√≠n hi·ªáu ƒë·ªÉ d·ª´ng, suy nghƒ© v√† h√†nh ƒë·ªông c√≥ tr√°ch nhi·ªám. \nL√†m ngay: d·ª´ng h√†nh ƒë·ªông, h√≠t th·ªü, ghi nh·∫≠t k√Ω ng·∫Øn, t√¨m ng∆∞·ªùi tin c·∫≠y ƒë·ªÉ tr√≤ chuy·ªán. \nN·∫øu k·∫øt qu·∫£ l·∫∑p l·∫°i li√™n t·ª•c v√† b·∫°n c·∫£m th·∫•y kh√≥ ki·ªÉm so√°t h√†nh vi ‚Üí t√¨m chuy√™n gia t√¢m l√Ω ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£. \n\n<strong>10. L∆∞u √Ω vƒÉn h√≥a & b·ªëi c·∫£nh x√£ h·ªôi üåê </strong>\nH√†nh vi ƒë∆∞·ª£c ƒë√°nh gi√° kh√°c nhau theo vƒÉn h√≥a, lu·∫≠t ph√°p v√† b·ªëi c·∫£nh. \nKhi di chuy·ªÉn gi·ªØa n·ªÅn vƒÉn h√≥a ho·∫∑c s·ªëng ·ªü n∆∞·ªõc kh√°c, kh√¥ng d√πng th∆∞·ªõc nh∆∞ m·ªôt ti√™u chu·∫©n tuy·ªát ƒë·ªëi m√† c·∫ßn tham kh·∫£o vƒÉn ho√°/lu·∫≠t ƒë·ªãa ph∆∞∆°ng. \n\n<strong>11. Khi n√†o c·∫ßn t√¨m gi√∫p ƒë·ª° chuy√™n nghi·ªáp ‚òéÔ∏è</strong> \nB·∫°n c√≥ xu h∆∞·ªõng t·ª± l√†m h·∫°i ho·∫∑c nghƒ© ng∆∞·ªùi kh√°c s·∫Ω b·ªã t·ªïn th∆∞∆°ng. \nK·∫øt qu·∫£ th∆∞·ªõc g√¢y c·∫£m x√∫c ti√™u c·ª±c k√©o d√†i (suy s·ª•p, tr·∫ßm c·∫£m). \nM·∫•t kh·∫£ nƒÉng l√†m vi·ªác, h·ªçc t·∫≠p ho·∫∑c duy tr√¨ c√°c m·ªëi quan h·ªá v√¨ h√†nh vi. \n‚Üí Li√™n h·ªá b√°c sƒ© t√¢m th·∫ßn / nh√† tr·ªã li·ªáu / ƒë∆∞·ªùng d√¢y n√≥ng kh·∫©n c·∫•p. \n\n<strong>üí¨ L·ªúI NH·∫ÆC CU·ªêI</strong> \n> ‚ÄúTh∆∞·ªõc kh√¥ng d√πng ƒë·ªÉ ph√°n x√©t ‚Äì m√† ƒë·ªÉ ph·∫£n t∆∞.‚Äù \nH√£y d√πng n√≥ nh∆∞ g∆∞∆°ng soi n·ªôi t√¢m ƒë·ªÉ s·ªëng t·ªânh th·ª©c h∆°n m·ªói ng√†y.'
;

helpBtn.onclick = () => {
  document.getElementById('helpText').innerHTML = helpContent;
  document.getElementById('helpModal').style.display = 'block';
};


document.getElementById('closeHelp').onclick = () => {
  document.getElementById('helpModal').style.display = 'none';
};

initSlider();
setInterval(updateCountdown,200);
updateCountdown();


function revertSlider() {
  placeSliderAtValue(0);
}
document.getElementById('revBtn').onclick = revertSlider;
function formatFullTime(ts) {
  const d = new Date(ts);
  return d.toLocaleString('vi-VN', { hour12: false }); 
}

// DI·ªÑN GI·∫¢I NHANH CHO M·ª®C T·ª™NG GI√Å TR·ªä (d√πng ·ªü m·ªôt s·ªë ch·ªó hi·ªÉn th·ªã)
function interpretLevel(v) {
  const cat = getCategoryFromValue(v);
  return "‚Üí " + cat.label + " " + cat.emoji;
}

function formatDateTime(ts) {
    const d = new Date(ts);
    const date = d.toLocaleDateString('vi-VN');
    const time = d.toLocaleTimeString('vi-VN', { hour12: false });
    return { date, time };
}

// Di·ªÖn gi·∫£i ƒëi·ªÉm trung b√¨nh (5 m·ª©c)
function interpretScore(avg) {
    if (avg <= -6667) return "‚ö†Ô∏èB·∫£n nƒÉng m·∫°nh üòàüí•";
    if (avg <= -3334) return "B·∫£n nƒÉng v·ª´a üòãüò§üî•";
    if (avg >= 6667)  return "‚ö†Ô∏èSi√™u ng√£ m·∫°nh üòáü§ç";
    if (avg >= 3334)  return "Si√™u ng√£ v·ª´a ‚ú®üëºüïäÔ∏è";
    return "B·∫£n ng√£ c√¢n b·∫±ng ‚öñÔ∏èüë§‚úÖ";
}

// --- HELPER: Render Sao (Widget) ---
function renderStarWidget(idx, type, val) {
    let h = `<div class="stars" id="stars-${idx}-${type}">`;
    for(let i=1; i<=5; i++) {
        let cls = i <= val ? 'active' : '';
        h += `<span class="star ${cls}" onclick="setRating(${idx}, '${type}', ${i})">‚òÖ</span>`;
    }
    h += `</div>`;
    return h;
}

// ============================================================
// KHU V·ª∞C X·ª¨ L√ù NH·∫¨T K√ù & L∆ØU TR·ªÆ (ƒê√É S·ª¨A L·ªñI & T·ªêI ∆ØU)
// ============================================================

// 1. KHAI B√ÅO BI·∫æN TO√ÄN C·ª§C (ƒê·ªÉ tr√°nh l·ªói kh√¥ng t√¨m th·∫•y bi·∫øn)
window.tempRatings = {}; 
window.tempEmojis = {};

// 2. H√ÄM SET RATING (SAO)
window.setRating = function(cIdx, type, val) {
    if(!window.tempRatings[cIdx]) window.tempRatings[cIdx] = {};
    window.tempRatings[cIdx][type] = val;
    
    // Update UI ngay l·∫≠p t·ª©c
    const box = document.getElementById(`stars-${cIdx}-${type}`);
    if(box) {
        const stars = box.querySelectorAll('.star');
        stars.forEach((s, i) => {
            if(i < val) s.classList.add('active');
            else s.classList.remove('active');
        });
    }
};

// 3. H√ÄM SET EMOJI
window.setEmoji = function(cIdx, type, val) {
    if (!window.tempEmojis[cIdx]) window.tempEmojis[cIdx] = {};
    window.tempEmojis[cIdx][type] = val;

    // C·∫≠p nh·∫≠t giao di·ªán
    const container = document.getElementById(`emoji-${cIdx}-${type}`);
    if (container) {
        const btns = container.querySelectorAll('.emoji-btn');
        btns.forEach((btn, i) => {
            if (i + 1 === val) btn.classList.add('selected');
            else btn.classList.remove('selected');
        });
    }
};

// --- HELPER: Render Sao (Widget) ---
function renderStarWidget(idx, type, val) {
    let h = `<div class="stars" id="stars-${idx}-${type}">`;
    for(let i=1; i<=5; i++) {
        let cls = i <= val ? 'active' : '';
        h += `<span class="star ${cls}" onclick="window.setRating(${idx}, '${type}', ${i})">‚òÖ</span>`;
    }
    h += `</div>`;
    return h;
}

// --- HELPER: Render Sao (K·∫øt qu·∫£ tƒ©nh) ---
function renderStarStatic(val) {
    let s = "";
    for(let i=1; i<=5; i++) s += (i<=val ? "‚òÖ" : "‚òÜ");
    return `<span style="color:#f1c40f; font-size:16px;">${s}</span> <small>(${val}/5)</small>`;
}

// --- HELPER: Render Emoji Widget ---
const EMOJI_SCALE = ['üò°', '‚òπÔ∏è', 'üòê', 'üôÇ', 'üòç'];
const EMOJI_LABELS = ['R·∫•t kh√¥ng h√†i l√≤ng', 'Kh√¥ng h√†i l√≤ng', 'B√¨nh th∆∞·ªùng', 'H√†i l√≤ng', 'R·∫•t h√†i l√≤ng'];

function renderEmojiWidget(idx, type, currentVal) {
    let html = `<div class="emoji-group" id="emoji-${idx}-${type}">`;
    EMOJI_SCALE.forEach((icon, i) => {
        const val = i + 1;
        const isSelected = val === currentVal ? 'selected' : '';
        html += `<span class="emoji-btn ${isSelected}" title="${EMOJI_LABELS[i]}" onclick="window.setEmoji(${idx}, '${type}', ${val})">${icon}</span>`;
    });
    html += `</div>`;
    return html;
}

function renderEmojiResult(val) {
    if (!val || val < 1) return "Ch∆∞a ƒë√°nh gi√°";
    const icon = EMOJI_SCALE[val - 1];
    const text = EMOJI_LABELS[val - 1];
    return `<span class="emoji-result">${icon} ${text}</span>`;
}


// 4. H√ÄM L∆ØU D·ªÆ LI·ªÜU (QUAN TR·ªåNG: C√ì TRY-CATCH ƒê·ªÇ B√ÅO L·ªñI)
window.saveFeedback = function(index) {
    console.log("ƒêang c·ªë g·∫Øng l∆∞u d·ªØ li·ªáu cho index:", index); // Debug

    try {
        // L·∫•y c√°c ph·∫ßn t·ª≠ DOM
        const q1El = document.getElementById(`q1-${index}`);
        const q2El = document.getElementById(`q2-${index}`);
        const q3El = document.getElementById(`q3-${index}`);

        // Ki·ªÉm tra xem ph·∫ßn t·ª≠ c√≥ t·ªìn t·∫°i kh√¥ng (Tr√°nh l·ªói null)
        if (!q1El || !q2El || !q3El) {
            alert(`L·ªói h·ªá th·ªëng: Kh√¥ng t√¨m th·∫•y √¥ nh·∫≠p li·ªáu (ID: q1-${index}). Vui l√≤ng ƒë√≥ng Nh·∫≠t k√Ω v√† m·ªü l·∫°i.`);
            return;
        }

        const q1 = q1El.value.trim();
        const q2 = q2El.value.trim();
        const q3 = q3El.value.trim();
        
        // L·∫•y d·ªØ li·ªáu ƒëi·ªÉm ƒë√°nh gi√° t·ª´ bi·∫øn t·∫°m
        const rt = window.tempRatings[index] || {};
        const em = window.tempEmojis[index] || {};

        // --- VALIDATION (KI·ªÇM TRA D·ªÆ LI·ªÜU) ---
        if(!rt.r1 || !rt.r2 || !rt.r3) {
            alert("‚ö†Ô∏è Vui l√≤ng ch·∫•m ƒëi·ªÉm SAO (‚≠ê) cho c·∫£ 3 ti√™u ch√≠ ƒë√°nh gi√°.");
            return;
        }

        if(!em.satResult || !em.satTool) {
            alert("‚ö†Ô∏è Vui l√≤ng ch·ªçn bi·ªÉu t∆∞·ª£ng c·∫£m x√∫c (Emoji) ƒë·ªÉ ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng.");
            return;
        }
        
        if(!q1 || !q2 || !q3) {
            alert("‚ö†Ô∏è Vui l√≤ng vi·∫øt ƒë·∫ßy ƒë·ªß n·ªôi dung cho c·∫£ 3 c√¢u h·ªèi ph·∫£n t∆∞.");
            return;
        }

        // --- L∆ØU V√ÄO STATE ---
        // ƒê·∫£m b·∫£o m·∫£ng finishedCycles t·ªìn t·∫°i
        if (!state.finishedCycles || !state.finishedCycles[index]) {
            alert("L·ªói d·ªØ li·ªáu: Chu k·ª≥ kh√¥ng t·ªìn t·∫°i trong b·ªô nh·ªõ.");
            return;
        }

        state.finishedCycles[index].feedback = {
            q1, q2, q3,
            r1: rt.r1, r2: rt.r2, r3: rt.r3,
            satResult: em.satResult, 
            satTool: em.satTool      
        };
        
        // L∆∞u xu·ªëng LocalStorage
        saveFinishedCycles(state.finishedCycles);
        
        // Ph√°t √¢m thanh th√†nh c√¥ng (n·∫øu c√≥)
        if(document.getElementById('sndGreen')) {
            document.getElementById('sndGreen').play().catch(()=>{});
        }

        alert("‚úÖ ƒê√£ l∆∞u th√†nh c√¥ng v√†o Nh·∫≠t k√Ω!");
        
        // T·∫£i l·∫°i giao di·ªán ƒë·ªÉ hi·ªÉn th·ªã tr·∫°ng th√°i "ƒê√£ l∆∞u"
        showReview(); 

    } catch (e) {
        console.error("L·ªói khi l∆∞u:", e);
        alert("‚ùå C√≥ l·ªói x·∫£y ra khi l∆∞u: " + e.message);
    }
};

// ==========================================================
// H√ÄM HI·ªÇN TH·ªä REVIEW (ƒê√É S·ª¨A L·ªñI INDEX L·ªÜCH PHA)
// ==========================================================
window.showReview = function() {
    state.finishedCycles = loadFinishedCycles() || [];
    
    // Reset bi·∫øn t·∫°m m·ªói l·∫ßn m·ªü
    window.tempRatings = {}; 
    window.tempEmojis = {};
    
    const box = document.getElementById('reviewContent');
    document.getElementById('reviewModal').style.display = 'block';

    let html = '';

    // 1. HEADER: CHU K·ª≤ ƒêANG CH·∫†Y (Gi·ªØ nguy√™n)
    if (state.status === 'running') {
        const entries = state.entries || [];
        const count = entries.length;
        const sum = entries.reduce((a,b)=>a+(Number(b.value)||0),0);
        const currentCycleNumber = (state.finishedCycles || []).length + 1;

        html += `<div style="background:#e3f2fd; padding:12px; border-radius:8px; margin-bottom:20px; border:1px dashed #2196f3; color:#0d47a1;">
            <h3 style="margin:0 0 5px 0;">‚è≥ Chu k·ª≥ ${currentCycleNumber} ƒêang di·ªÖn ra</h3>
            <div style="font-size:14px;">
                B·∫Øt ƒë·∫ßu: <b>${state.startTimestamp ? formatDateTime(state.startTimestamp).time + ' ' + formatDateTime(state.startTimestamp).date : 'N/A'}</b><br>
                T·ªïng ƒëi·ªÉm hi·ªán t·∫°i: <b>${sum>0?'+':''}${sum}</b> | S·ªë l·∫ßn g·∫°t hi·ªán t·∫°i: <b>${count}</b> 
            </div>
        </div>`;
    }

    html += `<h3 style="color:#004080; border-bottom:2px solid #eee; padding-bottom:8px;">üìú Nh·∫≠t k√Ω T√¢m l√Ω</h3>`;

    // T√¨m ƒëo·∫°n n√†y trong h√†m window.showReview v√† thay th·∫ø:

    if (!state.finishedCycles || state.finishedCycles.length === 0) {
        // X√≥a ƒëi·ªÅu ki·ªán ki·ªÉm tra state.status ƒë·ªÉ lu√¥n hi·ªán th√¥ng b√°o
        html += `<div style="text-align:center; padding: 30px 10px; color:#666;">
                    <div style="font-size: 40px; margin-bottom: 10px;">üì≠</div>
                    <p style="margin:0">Ch∆∞a c√≥ chu k·ª≥ n√†o ƒë√£ ho√†n th√†nh ƒë∆∞·ª£c l∆∞u.</p>
                 </div>`;
        
        box.innerHTML = html;
        return;
    }

    // 2. B·∫¢NG T·ªîNG K·∫æT (SUMMARY TABLE)
    // S·ª≠a l·∫°i logic duy·ªát m·∫£ng ƒë·ªÉ ƒë·ªìng b·ªô v·ªõi ph·∫ßn d∆∞·ªõi
    let summaryHtml = `
        <div style="display:flex; align-items:center; gap:10px; margin-bottom:15px; padding-left: 5px;">
            <h4 style="color:#4a148c; margin:0; font-size: 16px; font-weight: 700; letter-spacing: 0.5px; text-transform: uppercase; border-left: 4px solid #7b1fa2; padding-left: 10px;">üìì T·ªîNG K·∫æT L·ªäCH S·ª¨</h4>
        </div>
        <div style="overflow-x:auto; box-shadow: 0 8px 20px rgba(123, 31, 162, 0.15); background: #ffffff; border: 1px solid #e1bee7;">
        <table style="width:100%; min-width:600px; border-collapse:collapse; font-family: system-ui, -apple-system, sans-serif;">
            <thead>
                <tr style="background: linear-gradient(135deg, #4a148c 0%, #7b1fa2 100%); color:#ffffff;">
                    <th style="padding:14px 10px; text-align:center; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">Chu k·ª≥</th>
                    <th style="padding:14px 10px; text-align:center; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">ƒêi·ªÉm TB</th>
		    <th style="padding:14px 10px; text-align:center; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">Khuynh h∆∞·ªõng</th>
                    <th style="padding:14px 10px; text-align:center; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">T·ªïng ƒëi·ªÉm</th>
		    <th style="padding:14px 10px; text-align:center; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">S·ªë l·∫ßn g·∫°t</th>
                    <th style="padding:14px 10px; text-align:center; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">Th·ªùi gian</th>
                </tr>
            </thead>
            <tbody>
    `;

    // T·∫°o c√°c d√≤ng cho b·∫£ng (Map -> Reverse -> Join) ƒë·ªÉ ƒë·∫£m b·∫£o th·ª© t·ª± c≈© nh·∫•t ·ªü d∆∞·ªõi c√πng ho·∫∑c tr√™n c√πng tu·ª≥ √Ω
    // ·ªû ƒë√¢y ta mu·ªën hi·ªÉn th·ªã danh s√°ch: Chu k·ª≥ 1 (C≈©) -> Chu k·ª≥ N (M·ªõi) trong b·∫£ng
    const tableRows = state.finishedCycles.map((cycle, realIndex) => {
    // realIndex ch√≠nh l√† ch·ªâ m·ª•c th·ª±c trong m·∫£ng state.finishedCycles
    // V√¨ unshift (m·ªõi nh·∫•t index 0), n√™n s·ªë th·ª© t·ª± Chu k·ª≥ = T·ªïng s·ªë - Index hi·ªán t·∫°i
    const cycleNum = state.finishedCycles.length - realIndex; 
    
    const avgScore = cycle.avgScore;
    const totalScore = cycle.totalScore || cycle.entries.reduce((a,b)=>a+(Number(b.value)||0),0);
    const startObj = formatDateTime(cycle.startTime);

    // üí° LOGIC X√ÅC ƒê·ªäNH M√ÄU S·∫ÆC & ICON ƒê∆Ø·ª¢C GI·ªÆ NGUY√äN (v√† d√πng cho √¥ Khuynh h∆∞·ªõng)
    let scoreColor = '#2ecc71'; // Ego/C√¢n b·∫±ng
    let icon = 'üë§';
    let trendLabel = 'B·∫£n ng√£'; // Th√™m nh√£n ƒë·ªÉ hi·ªÉn th·ªã ch·ªØ

    if (avgScore <= -6667) { 
        scoreColor = '#8e44ad'; // B·∫£n nƒÉng m·∫°nh (T√≠m)
        icon = 'üòà'; 
        trendLabel = 'B·∫£n nƒÉng m·∫°nh';
    }
    else if (avgScore <= -3334) { 
        scoreColor = '#e74c3c'; // B·∫£n nƒÉng v·ª´a (ƒê·ªè)
        icon = 'üî•'; 
        trendLabel = 'B·∫£n nƒÉng v·ª´a';
    }
    else if (avgScore >= 6667) { 
        scoreColor = '#FFD700'; // Si√™u ng√£ m·∫°nh (V√†ng)
        icon = 'üòá'; 
        trendLabel = 'Si√™u ng√£ m·∫°nh';
    }
    else if (avgScore >= 3334) { 
        scoreColor = '#2980b9'; // Si√™u ng√£ v·ª´a (Xanh d∆∞∆°ng)
        icon = 'üïäÔ∏è'; 
        trendLabel = 'Si√™u ng√£ v·ª´a';
    }

    return `
        <tr style="background-color:${cycleNum % 2 === 0 ? '#f9f9f9' : '#ffffff'};">
            <td style="padding:8px; border:1px solid #ddd; text-align:center; font-weight:bold;">${cycleNum}</td>
            <td style="padding:8px; border:1px solid #ddd; text-align:center; font-weight:bold; color:${scoreColor};">
                ${avgScore > 0 ? '+' : ''}${avgScore.toFixed(1)}
            </td>
            <td style="padding:8px; border:1px solid #ddd; text-align:center; font-weight: bold; color:${scoreColor};">
                ${icon} ${trendLabel} 
            </td>
            <td style="padding:8px; border:1px solid #ddd; text-align:center;">${totalScore > 0 ? '+' : ''}${totalScore}</td>
            <td style="padding:8px; border:1px solid #ddd; text-align:center;">${cycle.entries.length}</td>
            <td style="padding:8px; border:1px solid #ddd; text-align:center; font-size:12px;">${startObj.time} ${startObj.date}</td>
        </tr>
    `;
});

    // ƒê·∫£o ng∆∞·ª£c m·∫£ng rows ƒë·ªÉ hi·ªÉn th·ªã Chu k·ª≥ 1 l√™n ƒë·∫ßu b·∫£ng (ho·∫∑c b·ªè .reverse() n·∫øu mu·ªën m·ªõi nh·∫•t l√™n ƒë·∫ßu)
    summaryHtml += tableRows.reverse().join(''); 
    
    summaryHtml += `</tbody></table></div><hr style="border:0; border-top:1px dashed #ccc; margin:20px 0;">`;
    html += summaryHtml;

    // 3. DANH S√ÅCH CHI TI·∫æT (QUAN TR·ªåNG: S·ª¨A L·ªñI LOGIC ·ªû ƒê√ÇY)
    // Thay v√¨ d√πng .reverse().forEach v√† t√≠nh to√°n index ph·ª©c t·∫°p, ta d√πng .map() tr·ª±c ti·∫øp
    // realIndex s·∫Ω lu√¥n lu√¥n ƒë√∫ng v·ªõi v·ªã tr√≠ trong m·∫£ng state.finishedCycles
    
    const cardHtmlList = state.finishedCycles.map((cycle, realIndex) => {
        const cycleNum = state.finishedCycles.length - realIndex;
        const startObj = formatDateTime(cycle.startTime);
        const fb = cycle.feedback || {};
        const isDone = (fb.r1 > 0); 

        // Logic m√†u s·∫Øc
        const v = cycle.avgScore;
        let scoreClass = 'color-green';
        let iconTrend = 'üë§';
        if (v <= -6667) { scoreClass = 'color-purple'; iconTrend = 'üòà'; }
        else if (v <= -3334) { scoreClass = 'color-red'; iconTrend = 'üî•'; }
        else if (v >= 6667) { scoreClass = 'color-amber'; iconTrend = 'üòá'; }
        else if (v >= 3334) { scoreClass = 'color-blue'; iconTrend = 'üïäÔ∏è'; }

        let card = `<div class="cycle-card ${scoreClass}">`;
        
        // Header Card
        card += `<div class="card-header">
            <div class="header-left">
                <strong>Chu k·ª≥ ${cycleNum}</strong> <span style="font-size:13px; color:#777;"><span class="neutral-text">(t·ª´ ${startObj.time} ${startObj.date})</span></span>
            </div>
            <div class="header-right ${scoreClass}">
                ${iconTrend} ${cycle.avgScore > 0 ? '+' : ''}${cycle.avgScore.toFixed(1)}
            </div>
           </div>`;

        // Table Logs
        card += `<div class="log-container"><table class="log-table">
                    <thead><tr><th>Th·ªùi gian</th><th>ƒêi·ªÉm</th><th>Khuynh h∆∞·ªõng</th></tr></thead>
                    <tbody>`;
        
        const entries = cycle.entries || [];
        if(entries.length === 0) {
            card += `<tr><td colspan="3" style="text-align:center; padding:10px;">Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>`;
        } else {
            entries.forEach(e => {
               const val = Number(e.value||0);
               const info = getCategoryFromValue(val);
               let pColor = '#2ecc71';
               if (val <= -6667) pColor = '#8e44ad';
               else if (val <= -3334) pColor = '#e74c3c';
               else if (val >= 6667) pColor = '#FFD700';
               else if (val >= 3334) pColor = '#2980b9';

               const tStr = e.time || (e.ts ? formatDateTime(e.ts).time : '');
               const dStr = e.date || (e.ts ? formatDateTime(e.ts).date : '');

               card += `<tr>
                    <td><strong>${tStr}</strong><br><span style="font-size:11px; color:#888;">${dStr}</span></td>
                    <td style="font-weight:bold; color:${pColor}">${val>0?'+':''}${val}</td>
                    <td>${info.emoji} ${info.label}</td>
                </tr>`;
            });
        }
        card += `</tbody></table></div>`;

        // Ph·∫ßn Ph·∫£n t∆∞
        card += `<div class="feedback-area">`;
        if (isDone) {
            // ƒê√É L∆ØU
            card += `<div class="saved-data">
                <div style="margin-bottom:8px; border-bottom:1px solid #c3e6cb; padding-bottom:5px;">‚úÖ <b>D·ªØ li·ªáu ƒë√£ l∆∞u</b></div>
                <div class="saved-item"><span class="saved-label">üìù S·ª± ki·ªán ƒë√°ng nh·ªõ nh·∫•t:</span> ${fb.q1}</div>
                <div class="saved-item"><span class="saved-label">‚öîÔ∏è Xung ƒë·ªôt n·ªôi t√¢m:</span> ${fb.q2}</div>
                <div class="saved-item"><span class="saved-label">üí° B√†i h·ªçc:</span> ${fb.q3}</div>
                <hr style="border-top:1px dashed #abc; margin:10px 0;">
                <div class="saved-item">üì± Giao di·ªán d·ªÖ d√πng: ${renderStarStatic(fb.r1)}</div>
                <div class="saved-item">üß† Gi√∫p hi·ªÉu b·∫£n th√¢n: ${renderStarStatic(fb.r2)}</div>
                <div class="saved-item">ü¶ã Gi√∫p thay ƒë·ªïi h√†nh vi: ${renderStarStatic(fb.r3)}</div>
                <div style="margin-top:6px; padding-top:6px; border-top:1px dotted #c3e6cb">
                    <div class="saved-item">üòä H√†i l√≤ng k·∫øt qu·∫£: ${renderEmojiResult(fb.satResult)}</div>
                    <div class="saved-item">üìè H√†i l√≤ng c√¢y th∆∞·ªõc: ${renderEmojiResult(fb.satTool)}</div>
                </div>
            </div>`;
        } else {
            // CH∆ØA L∆ØU -> HI·ªÜN FORM V·ªöI ID CHU·∫®N X√ÅC
            card += `<div style="margin-bottom:10px; color:#004080; font-weight:bold; display:flex; align-items:center; gap:6px;">
                        <span style="font-size:18px;">‚úçÔ∏è</span> Vi·∫øt Nh·∫≠t k√Ω 
                    </div>
                    <p style='text-align: center; color: #0d47a1; background: #f4f7fb; padding: 8px; border-radius: 4px; font-size: 13px; border-left: 5px solid #2196f3; line-height: 1.4;'>
                        <em>üî¨ H√£y th·∫≠t trung th·ª±c. D·ªØ li·ªáu ch√≠nh x√°c l√† ch√¨a kh√≥a cho k·∫øt qu·∫£ nghi√™n c·ª©u Khoa h·ªçc Kƒ© thu·∫≠t.</em>
                    </p>
            
            <label class="fb-label">1. S·ª± ki·ªán g√¨ ƒë√°ng nh·ªõ nh·∫•t ƒë√£ x·∫£y ra trong tu·∫ßn n√†y?</label>
            <textarea id="q1-${realIndex}" class="fb-input" rows="2" placeholder='V√≠ d·ª•: C√£i nhau v·ªõi b·∫°n b√®...'></textarea>
            
            <label class="fb-label">2. ƒê·∫•u tranh n·ªôi t√¢m (B·∫£n nƒÉng vs Si√™u ng√£)?</label>
            <textarea id="q2-${realIndex}" class="fb-input" rows="2" placeholder='V√≠ d·ª•: Mu·ªën m·∫Øng ch·ª≠i cho h·∫£ gi·∫≠n nh∆∞ng l∆∞∆°ng t√¢m c·∫Øn r·ª©t...'></textarea>

            <label class="fb-label">3. B√†i h·ªçc r√∫t ra?</label>
            <textarea id="q3-${realIndex}" class="fb-input" rows="2" placeholder='V√≠ d·ª•: C·∫ßn ki·ªÅm ch·∫ø c·∫£m x√∫c h∆°n...'></textarea>
            
            <div class="rating-box">
                <div style="font-size:12px; margin-bottom:5px; color:#666; font-style:italic;">ƒê√°nh gi√° hi·ªáu qu·∫£:</div>
                <div class="star-row"><span>üì± Giao di·ªán d·ªÖ d√πng</span> ${renderStarWidget(realIndex, 'r1', 0)}</div>
                <div class="star-row"><span>üß† Gi√∫p hi·ªÉu b·∫£n th√¢n</span> ${renderStarWidget(realIndex, 'r2', 0)}</div>
                <div class="star-row"><span>ü¶ã Gi√∫p thay ƒë·ªïi h√†nh vi</span> ${renderStarWidget(realIndex, 'r3', 0)}</div>

                <div class="emoji-section">
                    <div style="font-size:12px; margin-bottom:5px; color:#666; font-style:italic;">M·ª©c ƒë·ªô h√†i l√≤ng v·ªõi:</div>
                    <div class="emoji-row"><span>üìä K·∫øt qu·∫£</span> ${renderEmojiWidget(realIndex, 'satResult', 0)}</div>
                    <div class="emoji-row"><span>üìè Th∆∞·ªõc</span> ${renderEmojiWidget(realIndex, 'satTool', 0)}</div>
                </div>
            </div>
            <button class="btn-save-research" onclick="window.saveFeedback(${realIndex})">üíæ L∆ØU D·ªÆ LI·ªÜU V√ÄO NH·∫¨T K√ù</button>`;
        }
        
        card += `</div></div>`; // End feedback area & card
        return card;
    });

    // ƒê·∫£o ng∆∞·ª£c danh s√°ch th·∫ª HTML ƒë·ªÉ Chu k·ª≥ 1 (C≈© nh·∫•t) hi·ªÉn th·ªã tr√™n c√πng (ho·∫∑c b·ªè reverse n·∫øu mu·ªën ng∆∞·ª£c l·∫°i)
    // D√πng join('') ƒë·ªÉ g·ªôp th√†nh chu·ªói HTML
    html += cardHtmlList.reverse().join('');

    box.innerHTML = html;
};
// ƒê·∫£m b·∫£o g·∫Øn s·ª± ki·ªán m·ªü n√∫t
document.getElementById('reviewBtn').onclick = window.showReview;
// H√†m l∆∞u (Gi·ªØ nguy√™n logic c≈© nh∆∞ng c·∫≠p nh·∫≠t l·∫°i ID)
window.saveFeedback = function(index) {
    const q1 = document.getElementById(`q1-${index}`).value;
    const q2 = document.getElementById(`q2-${index}`).value;
    const q3 = document.getElementById(`q3-${index}`).value;
    
    // L·∫•y Sao
    const rt = tempRatings[index] || {};
    // L·∫•y Emoji (Th√™m m·ªõi)
    const em = tempEmojis[index] || {};

    // Ki·ªÉm tra d·ªØ li·ªáu
    if(!rt.r1 || !rt.r2 || !rt.r3) {
        alert("‚ö†Ô∏è Vui l√≤ng ch·∫•m ƒëi·ªÉm SAO cho c·∫£ 3 ti√™u ch√≠ KHKT.");
        return;
    }
    if(!em.satResult || !em.satTool) {
        alert("‚ö†Ô∏è Vui l√≤ng ch·ªçn bi·ªÉu t∆∞·ª£ng c·∫£m x√∫c (EMOJI) ƒë√°nh gi√° m·ª©c ƒë·ªô h√†i l√≤ng.");
        return;
    }
    if(!q1 || !q2 || !q3) {
        alert("‚ö†Ô∏è Vui l√≤ng vi·∫øt ƒë·ªß nh·∫≠t k√Ω.");
        return;
    }

    // L∆∞u t·∫•t c·∫£ v√†o c·∫•u tr√∫c feedback
    state.finishedCycles[index].feedback = {
        q1, q2, q3,
        r1: rt.r1, r2: rt.r2, r3: rt.r3,
        satResult: em.satResult, // L∆∞u ƒëi·ªÉm h√†i l√≤ng k·∫øt qu·∫£ (1-5)
        satTool: em.satTool      // L∆∞u ƒëi·ªÉm h√†i l√≤ng c√¥ng c·ª• (1-5)
    };
    
    saveFinishedCycles(state.finishedCycles);
    alert("‚úÖ ƒê√£ l∆∞u th√†nh c√¥ng!");
    showReview(); 
}
window.setRating = setRating;

document.getElementById('closeReview').onclick = () => {
  document.getElementById('reviewModal').style.display = 'none';
};

document.getElementById('reviewBtn').onclick = showReview;
// √Çm click n√∫t
const btnClickSound = new Audio("click.mp3");
btnClickSound.volume = 0.35; // ch·ªânh ƒë·ªô l·ªõn t·∫°i ƒë√¢y

function playBtnSound() {
    // reset v·ªÅ ƒë·∫ßu, tr√°nh b·ªã delay
    btnClickSound.currentTime = 0;
    btnClickSound.play().catch(()=>{});
}
// H√ÄM M·ªû KH√ìA √ÇM THANH CHO THI·∫æT B·ªä DI ƒê·ªòNG
let audioUnlocked = false;

function unlockAudio() {
    if (audioUnlocked) return;
    
    // Danh s√°ch t·∫•t c·∫£ c√°c ƒë·ªëi t∆∞·ª£ng Audio
  const audios = [
    document.getElementById('sndAmber'),
    document.getElementById('sndRed'),
    document.getElementById('sndGreen'),
    document.getElementById('sndBannangnhe'),
    document.getElementById('sndSieunganhe'),
    btnClickSound // ƒë·ªëi t∆∞·ª£ng ƒë√£ ƒë∆∞·ª£c khai b√°o
];

    // C·ªë g·∫Øng ph√°t v√† d·ª´ng ngay l·∫≠p t·ª©c t·∫•t c·∫£ c√°c √¢m thanh
    audios.forEach(audio => {
        if (audio) {
            // D√πng play().catch() ƒë·ªÉ tr√°nh l·ªói Uncaught Promise
            audio.play().then(() => {
                audio.pause();
                audio.currentTime = 0;
            }).catch(() => {});
        }
    });

    audioUnlocked = true;
    
    // X√≥a listener sau khi ƒë√£ m·ªü kh√≥a th√†nh c√¥ng
    document.removeEventListener('touchstart', unlockAudio);
    document.removeEventListener('click', unlockAudio);
}

// G·∫Øn s·ª± ki·ªán m·ªü kh√≥a v√†o t∆∞∆°ng t√°c ƒë·∫ßu ti√™n c·ªßa ng∆∞·ªùi d√πng
document.addEventListener('touchstart', unlockAudio, {once: true});
document.addEventListener('click', unlockAudio, {once: true});
// G·∫Øn v√†o t·∫•t c·∫£ c√°c n√∫t
document.addEventListener("DOMContentLoaded", () => {
    const btns = [
        document.getElementById("resetBtn"),
        document.getElementById("revBtn"),
        document.getElementById("helpBtn"),
        document.getElementById("reviewBtn"),
        document.getElementById("closeHelp"),
        document.getElementById("closeReview")
    ];

    btns.forEach(btn => {
        if (btn) {
            btn.addEventListener("click", playBtnSound);
        }
    });
});

</script>
<audio id="sndAmber" src="alert-amber.mp3" preload="auto"></audio>
<audio id="sndRed"   src="alert-red.mp3" preload="auto"></audio>
<audio id="sndGreen" src="success.mp3" preload="auto"></audio>

<!-- M·ªöI: hai √¢m thanh b·ªï sung -->
<audio id="sndBannangnhe" src="bannangnhe.mp3" preload="auto"></audio>
<audio id="sndSieunganhe" src="sieunganhe.mp3" preload="auto"></audio>


</body>
</html>

 



